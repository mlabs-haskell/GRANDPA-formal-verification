<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link href="coqdoc.css" rel="stylesheet" type="text/css" />
<title>Grandpa.Votes</title>
</head>

<body>

<div id="page">

<div id="header">
</div>

<div id="main">

<h1 class="libtitle">Library Grandpa.Votes</h1>

<div class="code">
<span class="id" title="keyword">Require</span> <a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Lists.List.html#"><span class="id" title="library">List</span></a>.<br/>
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span>  <a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Init.Nat.html#"><span class="id" title="library">Nat</span></a>.<br/>
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Program.Equality.html#"><span class="id" title="library">Coq.Program.Equality</span></a>.<br/>
<span class="id" title="keyword">Require</span> <a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Program.Wf.html#"><span class="id" title="library">Coq.Program.Wf</span></a>.<br/>
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.micromega.Lia.html#"><span class="id" title="library">Lia</span></a>.<br/>

<br/>
<span class="id" title="keyword">Require</span> <a class="idref" href="Grandpa.Dictionary.html#"><span class="id" title="library">Dictionary</span></a>.<br/>
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <a class="idref" href="Grandpa.Blocks.html#"><span class="id" title="library">Blocks</span></a>.<br/>
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <a class="idref" href="Grandpa.ListFacts.html#"><span class="id" title="library">ListFacts</span></a>.<br/>

<br/>
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <a class="idref" href="Grandpa.Sets.html#"><span class="id" title="library">Sets</span></a>.<br/>

<br/>
<span class="id" title="keyword">Open</span> <span class="id" title="keyword">Scope</span> <span class="id" title="var">bool</span>.<br/>
<span class="id" title="keyword">Open</span> <span class="id" title="keyword">Scope</span> <span class="id" title="var">blocks_scope</span>.<br/>

<br/>
</div>

<div class="doc">
<a id="lab6"></a><h1 class="section">Voters</h1>


<div class="paragraph"> </div>


<div class="paragraph"> </div>

Some requirements about a type that can represent voters:
<ul class="doclist">
<li> It must have infinite inhabitants.

</li>
<li> It must have decidable equality.

</li>
</ul>
This means, we can have any number of voters and we can 
distinguish between them. 
For this reason we choose to use naturals.

</div>
<div class="code">
<span class="id" title="keyword">Definition</span> <a id="Voter" class="idref" href="#Voter"><span class="id" title="definition">Voter</span></a> : <span class="id" title="keyword">Type</span> := <a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a>.<br/>

<br/>
</div>

<div class="doc">
  Note: Coq doesn't have a newtype syntax as 
   in Haskell, so we should use a variant.

</div>
<div class="code">

<br/>
<span class="id" title="keyword">Record</span> <a id="Voters" class="idref" href="#Voters"><span class="id" title="record">Voters</span></a> : <span class="id" title="keyword">Type</span> <br/>
&nbsp;&nbsp;:= {<a id="get_voters_dictionary" class="idref" href="#get_voters_dictionary"><span class="id" title="projection">get_voters_dictionary</span></a>: <a class="idref" href="Grandpa.Sets.html#DictionarySet"><span class="id" title="inductive">DictionarySet</span></a> <a class="idref" href="Grandpa.Votes.html#Voter"><span class="id" title="definition">Voter</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;<a id="round_number_of_voters" class="idref" href="#round_number_of_voters"><span class="id" title="projection">round_number_of_voters</span></a>: <a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a><br/>
&nbsp;&nbsp;}.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <a id="voters_to_list" class="idref" href="#voters_to_list"><span class="id" title="definition">voters_to_list</span></a> (<a id="voters:4" class="idref" href="#voters:4"><span class="id" title="binder">voters</span></a>:<a class="idref" href="Grandpa.Votes.html#Voters"><span class="id" title="record">Voters</span></a>)<br/>
&nbsp;&nbsp;:= <a class="idref" href="Grandpa.Sets.html#to_list"><span class="id" title="definition">Sets.to_list</span></a> (<a class="idref" href="Grandpa.Votes.html#get_voters_dictionary"><span class="id" title="projection">get_voters_dictionary</span></a> <a class="idref" href="Grandpa.Votes.html#voters:4"><span class="id" title="variable">voters</span></a>).<br/>

<br/>
<span class="id" title="keyword">Definition</span> <a id="voters_length" class="idref" href="#voters_length"><span class="id" title="definition">voters_length</span></a> (<a id="voters:5" class="idref" href="#voters:5"><span class="id" title="binder">voters</span></a>:<a class="idref" href="Grandpa.Votes.html#Voters"><span class="id" title="record">Voters</span></a>)<br/>
&nbsp;&nbsp;:= <br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Init.Datatypes.html#length"><span class="id" title="definition">length</span></a> (<a class="idref" href="Grandpa.Votes.html#voters_to_list"><span class="id" title="definition">voters_to_list</span></a> <a class="idref" href="Grandpa.Votes.html#voters:5"><span class="id" title="variable">voters</span></a>).<br/>

<br/>
<span class="id" title="keyword">Definition</span> <a id="voters_from_list" class="idref" href="#voters_from_list"><span class="id" title="definition">voters_from_list</span></a> (<a id="voters:6" class="idref" href="#voters:6"><span class="id" title="binder">voters</span></a>:<a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Init.Datatypes.html#list"><span class="id" title="inductive">list</span></a> <a class="idref" href="Grandpa.Votes.html#Voter"><span class="id" title="definition">Voter</span></a>) <br/>
&nbsp;&nbsp;(<a id="round_number_of_voters:7" class="idref" href="#round_number_of_voters:7"><span class="id" title="binder">round_number_of_voters</span></a>:<a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a>)<br/>
&nbsp;&nbsp;: <a class="idref" href="Grandpa.Votes.html#Voters"><span class="id" title="record">Voters</span></a><br/>
&nbsp;&nbsp;:= {| <a class="idref" href="Grandpa.Votes.html#get_voters_dictionary"><span class="id" title="projection">get_voters_dictionary</span></a>:= <a class="idref" href="Grandpa.Sets.html#from_list"><span class="id" title="definition">Sets.from_list</span></a> <a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Init.Nat.html#eqb"><span class="id" title="definition">Nat.eqb</span></a> <a class="idref" href="Grandpa.Votes.html#voters:6"><span class="id" title="variable">voters</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;<a class="idref" href="Grandpa.Votes.html#round_number_of_voters"><span class="id" title="projection">round_number_of_voters</span></a>:=<a class="idref" href="Grandpa.Votes.html#round_number_of_voters:7"><span class="id" title="variable">round_number_of_voters</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;|}.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <a id="voters_voters_and_list" class="idref" href="#voters_voters_and_list"><span class="id" title="definition">voters_voters_and_list</span></a> <br/>
&nbsp;&nbsp;(<a id="voters:8" class="idref" href="#voters:8"><span class="id" title="binder">voters</span></a>:<a class="idref" href="Grandpa.Votes.html#Voters"><span class="id" title="record">Voters</span></a>)<br/>
&nbsp;&nbsp;(<a id="ls:9" class="idref" href="#ls:9"><span class="id" title="binder">ls</span></a>:<a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Init.Datatypes.html#list"><span class="id" title="inductive">list</span></a> <a class="idref" href="Grandpa.Votes.html#Voter"><span class="id" title="definition">Voter</span></a>)<br/>
&nbsp;&nbsp;: <a class="idref" href="Grandpa.Votes.html#Voters"><span class="id" title="record">Voters</span></a> <br/>
&nbsp;&nbsp;:=<br/>
&nbsp;&nbsp;<a class="idref" href="Grandpa.Votes.html#voters_from_list"><span class="id" title="definition">voters_from_list</span></a> <a class="idref" href="Grandpa.Votes.html#ls:9"><span class="id" title="variable">ls</span></a> <a class="idref" href="Grandpa.Votes.html#voters:8"><span class="id" title="variable">voters</span></a>.(<a class="idref" href="Grandpa.Votes.html#round_number_of_voters"><span class="id" title="projection">round_number_of_voters</span></a>) .<br/>

<br/>
<span class="id" title="keyword">Definition</span> <a id="in_Voters" class="idref" href="#in_Voters"><span class="id" title="definition">in_Voters</span></a><br/>
&nbsp;&nbsp;(<a id="voter:10" class="idref" href="#voter:10"><span class="id" title="binder">voter</span></a> : <a class="idref" href="Grandpa.Votes.html#Voter"><span class="id" title="definition">Voter</span></a>) <br/>
&nbsp;&nbsp;(<a id="voters:11" class="idref" href="#voters:11"><span class="id" title="binder">voters</span></a>:<a class="idref" href="Grandpa.Votes.html#Voters"><span class="id" title="record">Voters</span></a>) <br/>
&nbsp;&nbsp;:=<br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Lists.List.html#In"><span class="id" title="definition">List.In</span></a> <a class="idref" href="Grandpa.Votes.html#voter:10"><span class="id" title="variable">voter</span></a> (<a class="idref" href="Grandpa.Votes.html#voters_to_list"><span class="id" title="definition">voters_to_list</span></a> <a class="idref" href="Grandpa.Votes.html#voters:11"><span class="id" title="variable">voters</span></a>).<br/>

<br/>
<span class="id" title="keyword">Definition</span> <a id="in_Voters_bool" class="idref" href="#in_Voters_bool"><span class="id" title="definition">in_Voters_bool</span></a>  <br/>
&nbsp;&nbsp;(<a id="voter:12" class="idref" href="#voter:12"><span class="id" title="binder">voter</span></a> : <a class="idref" href="Grandpa.Votes.html#Voter"><span class="id" title="definition">Voter</span></a>) (<a id="voters:13" class="idref" href="#voters:13"><span class="id" title="binder">voters</span></a>:<a class="idref" href="Grandpa.Votes.html#Voters"><span class="id" title="record">Voters</span></a>) <br/>
&nbsp;&nbsp;:= 0 <a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Init.Nat.html#6b7621b45fff0af5e2b2cbb2bc2d4e1d"><span class="id" title="notation">&lt;?</span></a> <a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Init.Nat.html#6b7621b45fff0af5e2b2cbb2bc2d4e1d"><span class="id" title="notation">(</span></a><a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Lists.List.html#count_occ"><span class="id" title="definition">List.count_occ</span></a> <a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Arith.PeanoNat.html#Nat.eq_dec"><span class="id" title="lemma">PeanoNat.Nat.eq_dec</span></a> (<a class="idref" href="Grandpa.Votes.html#voters_to_list"><span class="id" title="definition">voters_to_list</span></a> <a class="idref" href="Grandpa.Votes.html#voters:13"><span class="id" title="variable">voters</span></a>) <a class="idref" href="Grandpa.Votes.html#voter:12"><span class="id" title="variable">voter</span></a><a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Init.Nat.html#6b7621b45fff0af5e2b2cbb2bc2d4e1d"><span class="id" title="notation">)</span></a>.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <a id="calculate_max_bizantiners" class="idref" href="#calculate_max_bizantiners"><span class="id" title="definition">calculate_max_bizantiners</span></a><br/>
&nbsp;&nbsp;(<a id="voters:14" class="idref" href="#voters:14"><span class="id" title="binder">voters</span></a>:<a class="idref" href="Grandpa.Votes.html#Voters"><span class="id" title="record">Voters</span></a>)<br/>
&nbsp;&nbsp;:<a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a><br/>
&nbsp;&nbsp;:=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="total:15" class="idref" href="#total:15"><span class="id" title="binder">total</span></a>:= <a class="idref" href="Grandpa.Votes.html#voters:14"><span class="id" title="variable">voters</span></a>.(<a class="idref" href="Grandpa.Votes.html#round_number_of_voters"><span class="id" title="projection">round_number_of_voters</span></a>)<br/>
&nbsp;&nbsp;<span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Init.Nat.html#modulo"><span class="id" title="definition">Nat.modulo</span></a> <a class="idref" href="Grandpa.Votes.html#total:15"><span class="id" title="variable">total</span></a> 3 <span class="id" title="keyword">with</span> <br/>
&nbsp;&nbsp;| 0 ⇒ <a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Init.Nat.html#::nat_scope:x_'-'_x"><span class="id" title="notation">(</span></a><a class="idref" href="Grandpa.Votes.html#total:15"><span class="id" title="variable">total</span></a><a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Init.Nat.html#2e0d8202c5a48097752d760d3a1db6a7"><span class="id" title="notation">/</span></a>3<a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Init.Nat.html#::nat_scope:x_'-'_x"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Init.Nat.html#::nat_scope:x_'-'_x"><span class="id" title="notation">-</span></a>1<br/>
&nbsp;&nbsp;| <span class="id" title="var">_</span> ⇒ <a class="idref" href="Grandpa.Votes.html#total:15"><span class="id" title="variable">total</span></a><a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Init.Nat.html#2e0d8202c5a48097752d760d3a1db6a7"><span class="id" title="notation">/</span></a>3<br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span><br/>
&nbsp;&nbsp;.<br/>

<br/>
</div>

<div class="doc">
<a id="lab7"></a><h1 class="section">Votes</h1>


<div class="paragraph"> </div>

<a id="lab8"></a><h2 class="section">Vote</h2>


<div class="paragraph"> </div>

From the paper:

<div class="paragraph"> </div>

<pre>
  A vote is a block hash, together with some metadata such as round number 
  and the type of vote, such as prevote or precommit, all signed with a 
  voter’s private key
</pre>

<div class="paragraph"> </div>

Following the same approach as with the Blocks, we choose to replace the 
block hash with the real block. This makes proofs easier.

<div class="paragraph"> </div>

Round number would be added later when we add Time and Rounds, this 
  simplifies the work with a Vote.

<div class="paragraph"> </div>

We don't have types for votes, instead when needed, we distinguish
them by maintaining two different set of votes, one for precommits 
and other for prevotes.

<div class="paragraph"> </div>

However, we want to tie a Vote with a particular set of Voters 
and to ensure that the Vote is coherent.

</div>
<div class="code">

<br/>
<span class="id" title="keyword">Variant</span> <a id="Vote" class="idref" href="#Vote"><span class="id" title="inductive">Vote</span></a><br/>
&nbsp;&nbsp;(<a id="voters:16" class="idref" href="#voters:16"><span class="id" title="binder">voters</span></a>: <a class="idref" href="Grandpa.Votes.html#Voters"><span class="id" title="record">Voters</span></a>)<br/>
&nbsp;&nbsp;:<span class="id" title="keyword">Type</span> <br/>
&nbsp;&nbsp;:= <br/>
&nbsp;&nbsp;| <a id="VoteC" class="idref" href="#VoteC"><span class="id" title="constructor">VoteC</span></a> {<a id="m:19" class="idref" href="#m:19"><span class="id" title="binder">m</span></a>} (<a id="voter:20" class="idref" href="#voter:20"><span class="id" title="binder">voter</span></a> : <a class="idref" href="Grandpa.Votes.html#Voter"><span class="id" title="definition">Voter</span></a>) <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a id="is_voter:21" class="idref" href="#is_voter:21"><span class="id" title="binder">is_voter</span></a>: <a class="idref" href="Grandpa.Votes.html#in_Voters"><span class="id" title="definition">in_Voters</span></a> <a class="idref" href="Grandpa.Votes.html#voter:20"><span class="id" title="variable">voter</span></a> <a class="idref" href="Grandpa.Votes.html#voters:16"><span class="id" title="variable">voters</span></a> ) <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a id="block:22" class="idref" href="#block:22"><span class="id" title="binder">block</span></a>: <a class="idref" href="Grandpa.Blocks.html#Block"><span class="id" title="inductive">Block</span></a> <a class="idref" href="Grandpa.Votes.html#m:19"><span class="id" title="variable">m</span></a>) <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <a class="idref" href="Grandpa.Votes.html#Vote:17"><span class="id" title="inductive">Vote</span></a> <a class="idref" href="Grandpa.Votes.html#voters:16"><span class="id" title="variable">voters</span></a>.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <a id="vote_to_voter" class="idref" href="#vote_to_voter"><span class="id" title="definition">vote_to_voter</span></a> <br/>
&nbsp;&nbsp;{<a id="voters:23" class="idref" href="#voters:23"><span class="id" title="binder">voters</span></a>: <a class="idref" href="Grandpa.Votes.html#Voters"><span class="id" title="record">Voters</span></a> }<br/>
&nbsp;&nbsp;(<a id="vote:24" class="idref" href="#vote:24"><span class="id" title="binder">vote</span></a>: <a class="idref" href="Grandpa.Votes.html#Vote"><span class="id" title="inductive">Vote</span></a> <a class="idref" href="Grandpa.Votes.html#voters:23"><span class="id" title="variable">voters</span></a>)<br/>
&nbsp;&nbsp;: <a class="idref" href="Grandpa.Votes.html#Voter"><span class="id" title="definition">Voter</span></a><br/>
&nbsp;&nbsp;:=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="Grandpa.Votes.html#vote:24"><span class="id" title="variable">vote</span></a> <span class="id" title="keyword">with</span> <br/>
&nbsp;&nbsp;| <a class="idref" href="Grandpa.Votes.html#VoteC"><span class="id" title="constructor">VoteC</span></a> <span class="id" title="var">_</span> <span class="id" title="var">voter</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> ⇒ <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">voter</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <a id="vote_to_pair" class="idref" href="#vote_to_pair"><span class="id" title="definition">vote_to_pair</span></a> <br/>
&nbsp;&nbsp;{<a id="voters:26" class="idref" href="#voters:26"><span class="id" title="binder">voters</span></a>: <a class="idref" href="Grandpa.Votes.html#Voters"><span class="id" title="record">Voters</span></a>}<br/>
&nbsp;&nbsp;(<a id="vote:27" class="idref" href="#vote:27"><span class="id" title="binder">vote</span></a>:<a class="idref" href="Grandpa.Votes.html#Vote"><span class="id" title="inductive">Vote</span></a> <a class="idref" href="Grandpa.Votes.html#voters:26"><span class="id" title="variable">voters</span></a>)<br/>
&nbsp;&nbsp;: <a class="idref" href="Grandpa.Votes.html#Voter"><span class="id" title="definition">Voter</span></a> <a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Init.Datatypes.html#11c698c8685bb8ab1cf725545c085ac4"><span class="id" title="notation">×</span></a> <a class="idref" href="Grandpa.Blocks.html#AnyBlock"><span class="id" title="definition">AnyBlock</span></a> <br/>
&nbsp;&nbsp;:=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="Grandpa.Votes.html#vote:27"><span class="id" title="variable">vote</span></a> <span class="id" title="keyword">with</span> <br/>
&nbsp;&nbsp;| <a class="idref" href="Grandpa.Votes.html#VoteC"><span class="id" title="constructor">VoteC</span></a> <span class="id" title="var">_</span> <span class="id" title="var">voter</span> <span class="id" title="var">_</span> <span class="id" title="var">block</span> ⇒ <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><span class="id" title="var">voter</span> <a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Init.Specif.html#existT"><span class="id" title="constructor">existT</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">block</span><a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <a id="vote_to_block" class="idref" href="#vote_to_block"><span class="id" title="definition">vote_to_block</span></a>  <br/>
&nbsp;&nbsp;{<a id="voters:29" class="idref" href="#voters:29"><span class="id" title="binder">voters</span></a>: <a class="idref" href="Grandpa.Votes.html#Voters"><span class="id" title="record">Voters</span></a> }<br/>
&nbsp;&nbsp;(<a id="vote:30" class="idref" href="#vote:30"><span class="id" title="binder">vote</span></a>: <a class="idref" href="Grandpa.Votes.html#Vote"><span class="id" title="inductive">Vote</span></a> <a class="idref" href="Grandpa.Votes.html#voters:29"><span class="id" title="variable">voters</span></a> )<br/>
&nbsp;&nbsp;: <a class="idref" href="Grandpa.Blocks.html#AnyBlock"><span class="id" title="definition">AnyBlock</span></a><br/>
&nbsp;&nbsp;:=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="Grandpa.Votes.html#vote:30"><span class="id" title="variable">vote</span></a> <span class="id" title="keyword">with</span> <br/>
&nbsp;&nbsp;| <a class="idref" href="Grandpa.Votes.html#VoteC"><span class="id" title="constructor">VoteC</span></a> <span class="id" title="var">_</span> <span class="id" title="var">voter</span> <span class="id" title="var">_</span> <span class="id" title="var">block</span> ⇒ <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Init.Specif.html#existT"><span class="id" title="constructor">existT</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">block</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <a id="vote_eqb" class="idref" href="#vote_eqb"><span class="id" title="definition">vote_eqb</span></a> <br/>
&nbsp;&nbsp;{<a id="voters:32" class="idref" href="#voters:32"><span class="id" title="binder">voters</span></a>: <a class="idref" href="Grandpa.Votes.html#Voters"><span class="id" title="record">Voters</span></a>}<br/>
&nbsp;&nbsp;(<a id="vote1:33" class="idref" href="#vote1:33"><span class="id" title="binder">vote1</span></a> <a id="vote2:34" class="idref" href="#vote2:34"><span class="id" title="binder">vote2</span></a>: <a class="idref" href="Grandpa.Votes.html#Vote"><span class="id" title="inductive">Vote</span></a> <a class="idref" href="Grandpa.Votes.html#voters:32"><span class="id" title="variable">voters</span></a>)<br/>
&nbsp;&nbsp;: <a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Init.Datatypes.html#bool"><span class="id" title="inductive">bool</span></a><br/>
&nbsp;&nbsp;:=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="Grandpa.Votes.html#vote1:33"><span class="id" title="variable">vote1</span></a>,<a class="idref" href="Grandpa.Votes.html#vote2:34"><span class="id" title="variable">vote2</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| <a class="idref" href="Grandpa.Votes.html#VoteC"><span class="id" title="constructor">VoteC</span></a> <span class="id" title="var">_</span> <span class="id" title="var">voter1'</span> <span class="id" title="var">_</span> <span class="id" title="var">block1</span> , <a class="idref" href="Grandpa.Votes.html#VoteC"><span class="id" title="constructor">VoteC</span></a> <span class="id" title="var">_</span> <span class="id" title="var">voter2'</span> <span class="id" title="var">_</span> <span class="id" title="var">block2</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">voter1'</span> <a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Init.Nat.html#ad2ec4e405f68c46c0a176e3e94ae2e3"><span class="id" title="notation">=?</span></a> <span class="id" title="var">voter2'</span>)%<span class="id" title="var">nat</span> <a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Init.Datatypes.html#::bool_scope:x_'&amp;&amp;'_x"><span class="id" title="notation">&amp;&amp;</span></a> <a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Init.Datatypes.html#::bool_scope:x_'&amp;&amp;'_x"><span class="id" title="notation">(</span></a><span class="id" title="var">block1</span> <a class="idref" href="Grandpa.Blocks.html#0e3637cbd3059518acde0851b17b4840"><span class="id" title="notation">=?</span></a> <span class="id" title="var">block2</span><a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Init.Datatypes.html#::bool_scope:x_'&amp;&amp;'_x"><span class="id" title="notation">)</span></a><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
</div>

<div class="doc">
<a id="lab9"></a><h2 class="section">Votes</h2>

  As with <span class="inlinecode"><a class="idref" href="Grandpa.Votes.html#Voters"><span class="id" title="record">Voters</span></a></span>, we choose to use the newtype pattern here.

</div>
<div class="code">
<span class="id" title="keyword">Inductive</span> <a id="Votes" class="idref" href="#Votes"><span class="id" title="definition, inductive"><span id="Votes_rect" class="id"><span id="Votes_ind" class="id"><span id="Votes_rec" class="id"><span id="Votes_sind" class="id">Votes</span></span></span></span></span></a>  <br/>
&nbsp;&nbsp;(<a id="voters:37" class="idref" href="#voters:37"><span class="id" title="binder">voters</span></a>: <a class="idref" href="Grandpa.Votes.html#Voters"><span class="id" title="record">Voters</span></a>) <br/>
&nbsp;&nbsp;:<span class="id" title="keyword">Type</span> <br/>
&nbsp;&nbsp;:= <br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a id="VotesC" class="idref" href="#VotesC"><span class="id" title="constructor">VotesC</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a id="votes_list:40" class="idref" href="#votes_list:40"><span class="id" title="binder">votes_list</span></a>:<a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Init.Datatypes.html#list"><span class="id" title="inductive">list</span></a> (<a class="idref" href="Grandpa.Votes.html#Vote"><span class="id" title="inductive">Vote</span></a> <a class="idref" href="Grandpa.Votes.html#voters:37"><span class="id" title="variable">voters</span></a>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <a class="idref" href="Grandpa.Votes.html#Votes:38"><span class="id" title="inductive">Votes</span></a> <a class="idref" href="Grandpa.Votes.html#voters:37"><span class="id" title="variable">voters</span></a>.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <a id="votes_to_list" class="idref" href="#votes_to_list"><span class="id" title="definition">votes_to_list</span></a> <br/>
&nbsp;&nbsp;{<a id="voters:41" class="idref" href="#voters:41"><span class="id" title="binder">voters</span></a>: <a class="idref" href="Grandpa.Votes.html#Voters"><span class="id" title="record">Voters</span></a>} <br/>
&nbsp;&nbsp;(<a id="votes:42" class="idref" href="#votes:42"><span class="id" title="binder">votes</span></a>: <a class="idref" href="Grandpa.Votes.html#Votes"><span class="id" title="inductive">Votes</span></a> <a class="idref" href="Grandpa.Votes.html#voters:41"><span class="id" title="variable">voters</span></a>)<br/>
&nbsp;&nbsp;: <a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Init.Datatypes.html#list"><span class="id" title="inductive">list</span></a> (<a class="idref" href="Grandpa.Votes.html#Vote"><span class="id" title="inductive">Vote</span></a> <a class="idref" href="Grandpa.Votes.html#voters:41"><span class="id" title="variable">voters</span></a>)<br/>
&nbsp;&nbsp;:= <br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="Grandpa.Votes.html#votes:42"><span class="id" title="variable">votes</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| <a class="idref" href="Grandpa.Votes.html#VotesC"><span class="id" title="constructor">VotesC</span></a> <span class="id" title="var">_</span> <span class="id" title="var">l</span> ⇒ <span class="id" title="var">l</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <a id="votes_to_voters_list" class="idref" href="#votes_to_voters_list"><span class="id" title="definition">votes_to_voters_list</span></a> <br/>
&nbsp;&nbsp;{<a id="voters:44" class="idref" href="#voters:44"><span class="id" title="binder">voters</span></a>: <a class="idref" href="Grandpa.Votes.html#Voters"><span class="id" title="record">Voters</span></a>} <br/>
&nbsp;&nbsp;(<a id="votes:45" class="idref" href="#votes:45"><span class="id" title="binder">votes</span></a>: <a class="idref" href="Grandpa.Votes.html#Votes"><span class="id" title="inductive">Votes</span></a> <a class="idref" href="Grandpa.Votes.html#voters:44"><span class="id" title="variable">voters</span></a>)<br/>
&nbsp;&nbsp;: <a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Init.Datatypes.html#list"><span class="id" title="inductive">list</span></a> <a class="idref" href="Grandpa.Votes.html#Voter"><span class="id" title="definition">Voter</span></a><br/>
&nbsp;&nbsp;:= <a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Lists.List.html#map"><span class="id" title="definition">List.map</span></a> <a class="idref" href="Grandpa.Votes.html#vote_to_voter"><span class="id" title="definition">vote_to_voter</span></a> (<a class="idref" href="Grandpa.Votes.html#votes_to_list"><span class="id" title="definition">votes_to_list</span></a> <a class="idref" href="Grandpa.Votes.html#votes:45"><span class="id" title="variable">votes</span></a>).<br/>

<br/>
<span class="id" title="keyword">Definition</span> <a id="votes_to_pair_list" class="idref" href="#votes_to_pair_list"><span class="id" title="definition">votes_to_pair_list</span></a> <br/>
&nbsp;&nbsp;{<a id="voters:46" class="idref" href="#voters:46"><span class="id" title="binder">voters</span></a>: <a class="idref" href="Grandpa.Votes.html#Voters"><span class="id" title="record">Voters</span></a>} <br/>
&nbsp;&nbsp;(<a id="votes:47" class="idref" href="#votes:47"><span class="id" title="binder">votes</span></a>: <a class="idref" href="Grandpa.Votes.html#Votes"><span class="id" title="inductive">Votes</span></a> <a class="idref" href="Grandpa.Votes.html#voters:46"><span class="id" title="variable">voters</span></a> )<br/>
&nbsp;&nbsp;: <a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Init.Datatypes.html#list"><span class="id" title="inductive">list</span></a> (<a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a> <a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Init.Datatypes.html#11c698c8685bb8ab1cf725545c085ac4"><span class="id" title="notation">×</span></a> <a class="idref" href="Grandpa.Blocks.html#AnyBlock"><span class="id" title="definition">AnyBlock</span></a>)<br/>
&nbsp;&nbsp;:= <a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Lists.List.html#map"><span class="id" title="definition">List.map</span></a> <a class="idref" href="Grandpa.Votes.html#vote_to_pair"><span class="id" title="definition">vote_to_pair</span></a> (<a class="idref" href="Grandpa.Votes.html#votes_to_list"><span class="id" title="definition">votes_to_list</span></a> <a class="idref" href="Grandpa.Votes.html#votes:47"><span class="id" title="variable">votes</span></a>).<br/>

<br/>
<span class="id" title="keyword">Definition</span> <a id="voter_voted_in_votes" class="idref" href="#voter_voted_in_votes"><span class="id" title="definition">voter_voted_in_votes</span></a> <br/>
&nbsp;&nbsp;{<a id="voters:48" class="idref" href="#voters:48"><span class="id" title="binder">voters</span></a>: <a class="idref" href="Grandpa.Votes.html#Voters"><span class="id" title="record">Voters</span></a>} <br/>
&nbsp;&nbsp;(<a id="voter:49" class="idref" href="#voter:49"><span class="id" title="binder">voter</span></a>: <a class="idref" href="Grandpa.Votes.html#Voter"><span class="id" title="definition">Voter</span></a>)<br/>
&nbsp;&nbsp;(<a id="votes:50" class="idref" href="#votes:50"><span class="id" title="binder">votes</span></a>: <a class="idref" href="Grandpa.Votes.html#Votes"><span class="id" title="inductive">Votes</span></a> <a class="idref" href="Grandpa.Votes.html#voters:48"><span class="id" title="variable">voters</span></a>)<br/>
&nbsp;&nbsp;:=<br/>
&nbsp;&nbsp;0 <a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Init.Nat.html#6b7621b45fff0af5e2b2cbb2bc2d4e1d"><span class="id" title="notation">&lt;?</span></a> <a class="idref" href="Grandpa.ListFacts.html#count"><span class="id" title="definition">count</span></a> <a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Init.Nat.html#eqb"><span class="id" title="definition">Nat.eqb</span></a> <a class="idref" href="Grandpa.Votes.html#voter:49"><span class="id" title="variable">voter</span></a> (<a class="idref" href="Grandpa.Votes.html#votes_to_voters_list"><span class="id" title="definition">votes_to_voters_list</span></a> <a class="idref" href="Grandpa.Votes.html#votes:50"><span class="id" title="variable">votes</span></a>).<br/>

<br/>
</div>

<div class="doc">
   Since Votes is a wrap around a list, this function wraps <span class="inlinecode">++</span>.

</div>
<div class="code">
<span class="id" title="keyword">Definition</span> <a id="mergeVotes" class="idref" href="#mergeVotes"><span class="id" title="definition">mergeVotes</span></a> <br/>
&nbsp;&nbsp;{<a id="voters:51" class="idref" href="#voters:51"><span class="id" title="binder">voters</span></a>:<a class="idref" href="Grandpa.Votes.html#Voters"><span class="id" title="record">Voters</span></a> }<br/>
&nbsp;&nbsp;(<a id="votes1:52" class="idref" href="#votes1:52"><span class="id" title="binder">votes1</span></a> :<a class="idref" href="Grandpa.Votes.html#Votes"><span class="id" title="inductive">Votes</span></a> <a class="idref" href="Grandpa.Votes.html#voters:51"><span class="id" title="variable">voters</span></a>)<br/>
&nbsp;&nbsp;(<a id="votes2:53" class="idref" href="#votes2:53"><span class="id" title="binder">votes2</span></a> :<a class="idref" href="Grandpa.Votes.html#Votes"><span class="id" title="inductive">Votes</span></a> <a class="idref" href="Grandpa.Votes.html#voters:51"><span class="id" title="variable">voters</span></a>)<br/>
&nbsp;&nbsp;: <a class="idref" href="Grandpa.Votes.html#Votes"><span class="id" title="inductive">Votes</span></a> <a class="idref" href="Grandpa.Votes.html#voters:51"><span class="id" title="variable">voters</span></a><br/>
&nbsp;&nbsp;:=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="Grandpa.Votes.html#votes1:52"><span class="id" title="variable">votes1</span></a>, <a class="idref" href="Grandpa.Votes.html#votes2:53"><span class="id" title="variable">votes2</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="Grandpa.Votes.html#VotesC"><span class="id" title="constructor">VotesC</span></a> <span class="id" title="var">_</span> <span class="id" title="var">list1</span>, <a class="idref" href="Grandpa.Votes.html#VotesC"><span class="id" title="constructor">VotesC</span></a> <span class="id" title="var">_</span> <span class="id" title="var">list2</span> ⇒ <a class="idref" href="Grandpa.Votes.html#VotesC"><span class="id" title="constructor">VotesC</span></a> <span class="id" title="var">_</span> (<span class="id" title="var">list1</span> <a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Init.Datatypes.html#bc347c51eaf667706ae54503b26d52c6"><span class="id" title="notation">++</span></a> <span class="id" title="var">list2</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <a id="is_equivocate" class="idref" href="#is_equivocate"><span class="id" title="definition">is_equivocate</span></a>  <br/>
&nbsp;&nbsp;{<a id="voters:56" class="idref" href="#voters:56"><span class="id" title="binder">voters</span></a>: <a class="idref" href="Grandpa.Votes.html#Voters"><span class="id" title="record">Voters</span></a>}<br/>
&nbsp;&nbsp;(<a id="voter:57" class="idref" href="#voter:57"><span class="id" title="binder">voter</span></a>: <a class="idref" href="Grandpa.Votes.html#Voter"><span class="id" title="definition">Voter</span></a>)<br/>
&nbsp;&nbsp;(<a id="votes:58" class="idref" href="#votes:58"><span class="id" title="binder">votes</span></a>: <a class="idref" href="Grandpa.Votes.html#Votes"><span class="id" title="inductive">Votes</span></a> <a class="idref" href="Grandpa.Votes.html#voters:56"><span class="id" title="variable">voters</span></a>)<br/>
&nbsp;&nbsp;: <a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Init.Datatypes.html#bool"><span class="id" title="inductive">bool</span></a><br/>
&nbsp;&nbsp;:= 1 <a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Init.Nat.html#6b7621b45fff0af5e2b2cbb2bc2d4e1d"><span class="id" title="notation">&lt;?</span></a> <a class="idref" href="Grandpa.ListFacts.html#count"><span class="id" title="definition">count</span></a> <a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Init.Nat.html#eqb"><span class="id" title="definition">Nat.eqb</span></a> <a class="idref" href="Grandpa.Votes.html#voter:57"><span class="id" title="variable">voter</span></a> ( <a class="idref" href="Grandpa.Votes.html#votes_to_voters_list"><span class="id" title="definition">votes_to_voters_list</span></a> <a class="idref" href="Grandpa.Votes.html#votes:58"><span class="id" title="variable">votes</span></a>).<br/>

<br/>
</div>

<div class="doc">
The first element are the equivocate voters 
and the second one are the voters that only voted once.

</div>
<div class="code">

<br/>
<span class="id" title="keyword">Definition</span> <a id="split_voters_by_equivocation" class="idref" href="#split_voters_by_equivocation"><span class="id" title="definition">split_voters_by_equivocation</span></a> <br/>
&nbsp;&nbsp;{<a id="voters:59" class="idref" href="#voters:59"><span class="id" title="binder">voters</span></a>: <a class="idref" href="Grandpa.Votes.html#Voters"><span class="id" title="record">Voters</span></a>}<br/>
&nbsp;&nbsp;(<a id="votes:60" class="idref" href="#votes:60"><span class="id" title="binder">votes</span></a>: <a class="idref" href="Grandpa.Votes.html#Votes"><span class="id" title="inductive">Votes</span></a> <a class="idref" href="Grandpa.Votes.html#voters:59"><span class="id" title="variable">voters</span></a>)<br/>
&nbsp;&nbsp;: <a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Init.Datatypes.html#list"><span class="id" title="inductive">list</span></a> <a class="idref" href="Grandpa.Votes.html#Voter"><span class="id" title="definition">Voter</span></a> <a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Init.Datatypes.html#11c698c8685bb8ab1cf725545c085ac4"><span class="id" title="notation">×</span></a> <a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Init.Datatypes.html#list"><span class="id" title="inductive">list</span></a> <a class="idref" href="Grandpa.Votes.html#Voter"><span class="id" title="definition">Voter</span></a><br/>
&nbsp;&nbsp;:=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="voters_list:61" class="idref" href="#voters_list:61"><span class="id" title="binder">voters_list</span></a> := <a class="idref" href="Grandpa.Votes.html#voters_to_list"><span class="id" title="definition">voters_to_list</span></a> <a class="idref" href="Grandpa.Votes.html#voters:59"><span class="id" title="variable">voters</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Lists.List.html#partition"><span class="id" title="definition">List.partition</span></a>  (<span class="id" title="keyword">fun</span> <a id="voter:62" class="idref" href="#voter:62"><span class="id" title="binder">voter</span></a> ⇒ <a class="idref" href="Grandpa.Votes.html#is_equivocate"><span class="id" title="definition">is_equivocate</span></a> <a class="idref" href="Grandpa.Votes.html#voter:62"><span class="id" title="variable">voter</span></a> <a class="idref" href="Grandpa.Votes.html#votes:60"><span class="id" title="variable">votes</span></a>) <a class="idref" href="Grandpa.Votes.html#voters_list:61"><span class="id" title="variable">voters_list</span></a>.<br/>

<br/>
<span class="id" title="keyword">Section</span> <a id="Some" class="idref" href="#Some"><span class="id" title="section">Some</span></a>.<br/>

<br/>
</div>

<div class="doc">

<div class="paragraph"> </div>

  Sections are really useful to declare local variables 
   to avoid having big predicates.
   But sometimes we may need to close a section since 
   coq interprets in a erroneous way what we write.
   We immediately open a section again when this happens.

</div>
<div class="code">
<span class="id" title="keyword">Variable</span> <a id="Some.voters" class="idref" href="#Some.voters"><span class="id" title="variable">voters</span></a>: <a class="idref" href="Grandpa.Votes.html#Voters"><span class="id" title="record">Voters</span></a>.<br/>
<span class="id" title="keyword">Variable</span> <a id="Some.votes" class="idref" href="#Some.votes"><span class="id" title="variable">votes</span></a>: <a class="idref" href="Grandpa.Votes.html#Votes"><span class="id" title="inductive">Votes</span></a> <a class="idref" href="Grandpa.Votes.html#Some.voters"><span class="id" title="variable">voters</span></a>.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <a id="in_nat_list" class="idref" href="#in_nat_list"><span class="id" title="definition">in_nat_list</span></a> (<a id="n:65" class="idref" href="#n:65"><span class="id" title="binder">n</span></a>:<a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a>) (<a id="l:66" class="idref" href="#l:66"><span class="id" title="binder">l</span></a>:<a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Init.Datatypes.html#list"><span class="id" title="inductive">list</span></a> <a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a>) :<a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Init.Datatypes.html#bool"><span class="id" title="inductive">bool</span></a> := <br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Lists.List.html#find"><span class="id" title="definition">List.find</span></a> (<span class="id" title="keyword">fun</span> <a id="m:67" class="idref" href="#m:67"><span class="id" title="binder">m</span></a> ⇒ (<a class="idref" href="Grandpa.Votes.html#n:65"><span class="id" title="variable">n</span></a> <a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Init.Nat.html#ad2ec4e405f68c46c0a176e3e94ae2e3"><span class="id" title="notation">=?</span></a> <a class="idref" href="Grandpa.Votes.html#m:67"><span class="id" title="variable">m</span></a>)%<span class="id" title="var">nat</span>) <a class="idref" href="Grandpa.Votes.html#l:66"><span class="id" title="variable">l</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Init.Datatypes.html#None"><span class="id" title="constructor">None</span></a> ⇒ <a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Init.Datatypes.html#false"><span class="id" title="constructor">false</span></a><br/>
&nbsp;&nbsp;| <span class="id" title="var">_</span> ⇒ <a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Init.Datatypes.html#true"><span class="id" title="constructor">true</span></a><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <a id="filter_votes_by_voters_subset" class="idref" href="#filter_votes_by_voters_subset"><span class="id" title="definition">filter_votes_by_voters_subset</span></a> (<a id="subset:68" class="idref" href="#subset:68"><span class="id" title="binder">subset</span></a> : <a class="idref" href="Grandpa.Votes.html#Voters"><span class="id" title="record">Voters</span></a>) <br/>
&nbsp;&nbsp;: <a class="idref" href="Grandpa.Votes.html#Votes"><span class="id" title="inductive">Votes</span></a> <a class="idref" href="Grandpa.Votes.html#Some.voters"><span class="id" title="variable">voters</span></a><br/>
&nbsp;&nbsp;:= <br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="votes_list:69" class="idref" href="#votes_list:69"><span class="id" title="binder">votes_list</span></a> := <a class="idref" href="Grandpa.Votes.html#votes_to_list"><span class="id" title="definition">votes_to_list</span></a> <a class="idref" href="Grandpa.Votes.html#Some.votes"><span class="id" title="variable">votes</span></a><br/>
&nbsp;&nbsp;<span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="voters_as_nat_list:70" class="idref" href="#voters_as_nat_list:70"><span class="id" title="binder">voters_as_nat_list</span></a> := <a class="idref" href="Grandpa.Votes.html#voters_to_list"><span class="id" title="definition">voters_to_list</span></a> <a class="idref" href="Grandpa.Votes.html#subset:68"><span class="id" title="variable">subset</span></a><br/>
&nbsp;&nbsp;<span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="vote_predicate:72" class="idref" href="#vote_predicate:72"><span class="id" title="binder">vote_predicate</span></a> <a id="vote:71" class="idref" href="#vote:71"><span class="id" title="binder">vote</span></a> := <a class="idref" href="Grandpa.Votes.html#in_nat_list"><span class="id" title="definition">in_nat_list</span></a> (<a class="idref" href="Grandpa.Votes.html#vote_to_voter"><span class="id" title="definition">vote_to_voter</span></a> <a class="idref" href="Grandpa.Votes.html#vote:71"><span class="id" title="variable">vote</span></a>) <a class="idref" href="Grandpa.Votes.html#voters_as_nat_list:70"><span class="id" title="variable">voters_as_nat_list</span></a><br/>
&nbsp;&nbsp;<span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Grandpa.Votes.html#VotesC"><span class="id" title="constructor">VotesC</span></a> <a class="idref" href="Grandpa.Votes.html#Some.voters"><span class="id" title="variable">voters</span></a> (<a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Lists.List.html#filter"><span class="id" title="definition">List.filter</span></a> <a class="idref" href="Grandpa.Votes.html#vote_predicate:72"><span class="id" title="variable">vote_predicate</span></a>  <a class="idref" href="Grandpa.Votes.html#votes_list:69"><span class="id" title="variable">votes_list</span></a>).<br/>

<br/>
<span class="id" title="keyword">End</span> <a class="idref" href="Grandpa.Votes.html#Some"><span class="id" title="section">Some</span></a>.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <a id="is_safe" class="idref" href="#is_safe"><span class="id" title="definition">is_safe</span></a>  <br/>
&nbsp;&nbsp;{<a id="voters:73" class="idref" href="#voters:73"><span class="id" title="binder">voters</span></a>: <a class="idref" href="Grandpa.Votes.html#Voters"><span class="id" title="record">Voters</span></a> }<br/>
&nbsp;&nbsp;(<a id="votes:74" class="idref" href="#votes:74"><span class="id" title="binder">votes</span></a>: <a class="idref" href="Grandpa.Votes.html#Votes"><span class="id" title="inductive">Votes</span></a> <a class="idref" href="Grandpa.Votes.html#voters:73"><span class="id" title="variable">voters</span></a>)<br/>
&nbsp;&nbsp;:<a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Init.Datatypes.html#bool"><span class="id" title="inductive">bool</span></a><br/>
&nbsp;&nbsp;:=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="Grandpa.Votes.html#split_voters_by_equivocation"><span class="id" title="definition">split_voters_by_equivocation</span></a> <a class="idref" href="Grandpa.Votes.html#votes:74"><span class="id" title="variable">votes</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><span class="id" title="var">equivocate_voters</span><a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <span class="id" title="var">non_equivocate_voters</span><a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Init.Datatypes.html#length"><span class="id" title="definition">length</span></a> <span class="id" title="var">equivocate_voters</span> <a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Init.Nat.html#0f31f5c1c6b6a21a3a187247222bc9e4"><span class="id" title="notation">&lt;=?</span></a> <a class="idref" href="Grandpa.Votes.html#calculate_max_bizantiners"><span class="id" title="definition">calculate_max_bizantiners</span></a> <a class="idref" href="Grandpa.Votes.html#voters:73"><span class="id" title="variable">voters</span></a> <br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <a id="BlockDictionary" class="idref" href="#BlockDictionary"><span class="id" title="definition">BlockDictionary</span></a> := <a class="idref" href="Grandpa.Dictionary.html#Dictionary"><span class="id" title="inductive">Dictionary.Dictionary</span></a> <a class="idref" href="Grandpa.Blocks.html#AnyBlock"><span class="id" title="definition">AnyBlock</span></a> <a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a>.<br/>

<br/>
</div>

<div class="doc">
<a id="lab10"></a><h2 class="section">Vote count</h2>


<div class="paragraph"> </div>

<ul class="doclist">
<li> First we split the set of votes in two, one of votes 
  made by equivocate voters and other made by 
   non equivocate voters

</li>
<li> We count the total votes for all the block that 
  were votes (that is, we don't count the 
   blocks b such that   b &lt; b'
   when some voter voted for b' but not for b)

</li>
<li> Then we do a "flatten" it means for every 
  voted block b, if b' &lt; b
   then we add the votes for b to the votes for b'.

</li>
</ul>

</div>
<div class="code">

<br/>
<span class="id" title="keyword">Definition</span> <a id="aux_vote_update" class="idref" href="#aux_vote_update"><span class="id" title="definition">aux_vote_update</span></a> (<a id="old_votes:75" class="idref" href="#old_votes:75"><span class="id" title="binder">old_votes</span></a>: <a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Init.Datatypes.html#option"><span class="id" title="inductive">option</span></a> <a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a>) (<a id="new_votes:76" class="idref" href="#new_votes:76"><span class="id" title="binder">new_votes</span></a>:<a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a>)<br/>
&nbsp;&nbsp;:= <br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="Grandpa.Votes.html#old_votes:75"><span class="id" title="variable">old_votes</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Init.Datatypes.html#None"><span class="id" title="constructor">None</span></a> ⇒ <a class="idref" href="Grandpa.Votes.html#new_votes:76"><span class="id" title="variable">new_votes</span></a><br/>
&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <span class="id" title="var">v'</span> ⇒ <a class="idref" href="Grandpa.Votes.html#new_votes:76"><span class="id" title="variable">new_votes</span></a><a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Init.Nat.html#0dacc1786c5ba797d47dd85006231633"><span class="id" title="notation">+</span></a><span class="id" title="var">v'</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <a id="update_with_vote_to_block" class="idref" href="#update_with_vote_to_block"><span class="id" title="definition">update_with_vote_to_block</span></a> (<a id="d:78" class="idref" href="#d:78"><span class="id" title="binder">d</span></a>:<a class="idref" href="Grandpa.Votes.html#BlockDictionary"><span class="id" title="definition">BlockDictionary</span></a>)<br/>
&nbsp;&nbsp;(<a id="block:79" class="idref" href="#block:79"><span class="id" title="binder">block</span></a>:<a class="idref" href="Grandpa.Blocks.html#AnyBlock"><span class="id" title="definition">AnyBlock</span></a>)<br/>
&nbsp;&nbsp;: <a class="idref" href="Grandpa.Votes.html#BlockDictionary"><span class="id" title="definition">BlockDictionary</span></a><br/>
&nbsp;&nbsp;:= <a class="idref" href="Grandpa.Dictionary.html#update_with"><span class="id" title="definition">Dictionary.update_with</span></a> <a class="idref" href="Grandpa.Blocks.html#anyblock_eqb"><span class="id" title="definition">anyblock_eqb</span></a> <a class="idref" href="Grandpa.Votes.html#block:79"><span class="id" title="variable">block</span></a> 1 <a class="idref" href="Grandpa.Votes.html#aux_vote_update"><span class="id" title="definition">aux_vote_update</span></a> <a class="idref" href="Grandpa.Votes.html#d:78"><span class="id" title="variable">d</span></a>.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <a id="make_votes_dictionary" class="idref" href="#make_votes_dictionary"><span class="id" title="definition">make_votes_dictionary</span></a><br/>
&nbsp;&nbsp;(<a id="votes:80" class="idref" href="#votes:80"><span class="id" title="binder">votes</span></a>:<a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Init.Datatypes.html#list"><span class="id" title="inductive">list</span></a> <a class="idref" href="Grandpa.Blocks.html#AnyBlock"><span class="id" title="definition">AnyBlock</span></a>)(<a id="acc:81" class="idref" href="#acc:81"><span class="id" title="binder">acc</span></a>: <a class="idref" href="Grandpa.Votes.html#BlockDictionary"><span class="id" title="definition">BlockDictionary</span></a>)<br/>
&nbsp;&nbsp;: <a class="idref" href="Grandpa.Votes.html#BlockDictionary"><span class="id" title="definition">BlockDictionary</span></a><br/>
&nbsp;&nbsp;:=<br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Lists.List.html#fold_left"><span class="id" title="definition">List.fold_left</span></a> <br/>
&nbsp;&nbsp;<a class="idref" href="Grandpa.Votes.html#update_with_vote_to_block"><span class="id" title="definition">update_with_vote_to_block</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Grandpa.Votes.html#votes:80"><span class="id" title="variable">votes</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Grandpa.Votes.html#acc:81"><span class="id" title="variable">acc</span></a>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a id="make_votes_dictionary_step_empty" class="idref" href="#make_votes_dictionary_step_empty"><span class="id" title="lemma">make_votes_dictionary_step_empty</span></a><br/>
&nbsp;&nbsp;(<a id="votes:82" class="idref" href="#votes:82"><span class="id" title="binder">votes</span></a>:<a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Init.Datatypes.html#list"><span class="id" title="inductive">list</span></a> <a class="idref" href="Grandpa.Blocks.html#AnyBlock"><span class="id" title="definition">AnyBlock</span></a>) <a id="block:83" class="idref" href="#block:83"><span class="id" title="binder">block</span></a><br/>
&nbsp;&nbsp;: <a class="idref" href="Grandpa.Votes.html#make_votes_dictionary"><span class="id" title="definition">make_votes_dictionary</span></a> (<a class="idref" href="Grandpa.Votes.html#block:83"><span class="id" title="variable">block</span></a><a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Init.Datatypes.html#::list_scope:x_'::'_x"><span class="id" title="notation">::</span></a><a class="idref" href="Grandpa.Votes.html#votes:82"><span class="id" title="variable">votes</span></a>) <a class="idref" href="Grandpa.Dictionary.html#empty"><span class="id" title="definition">Dictionary.empty</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Grandpa.Votes.html#make_votes_dictionary"><span class="id" title="definition">make_votes_dictionary</span></a> <a class="idref" href="Grandpa.Votes.html#votes:82"><span class="id" title="variable">votes</span></a> (<a class="idref" href="Grandpa.Dictionary.html#from_list"><span class="id" title="definition">Dictionary.from_list</span></a> <a class="idref" href="Grandpa.Blocks.html#anyblock_eqb"><span class="id" title="definition">anyblock_eqb</span></a> (<a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="Grandpa.Votes.html#block:83"><span class="id" title="variable">block</span></a><a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a>1<a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a><a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Init.Datatypes.html#::list_scope:x_'::'_x"><span class="id" title="notation">::</span></a><a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Init.Datatypes.html#nil"><span class="id" title="constructor">nil</span></a>)%<span class="id" title="var">list</span>).<br/>

<br/>

<br/>
<span class="id" title="keyword">Definition</span> <a id="some_to_nat" class="idref" href="#some_to_nat"><span class="id" title="definition">some_to_nat</span></a> (<a id="x:84" class="idref" href="#x:84"><span class="id" title="binder">x</span></a>:<a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Init.Datatypes.html#option"><span class="id" title="inductive">option</span></a> <a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a>)<br/>
&nbsp;&nbsp;:= <br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="Grandpa.Votes.html#x:84"><span class="id" title="variable">x</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <span class="id" title="var">y</span> ⇒ <span class="id" title="var">y</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Init.Datatypes.html#None"><span class="id" title="constructor">None</span></a> ⇒ 0<br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a id="make_votes_dictionary_counts_right_aux" class="idref" href="#make_votes_dictionary_counts_right_aux"><span class="id" title="lemma">make_votes_dictionary_counts_right_aux</span></a> <br/>
&nbsp;&nbsp;(<a id="votes:86" class="idref" href="#votes:86"><span class="id" title="binder">votes</span></a>:<a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Init.Datatypes.html#list"><span class="id" title="inductive">list</span></a> <a class="idref" href="Grandpa.Blocks.html#AnyBlock"><span class="id" title="definition">AnyBlock</span></a>)<br/>
&nbsp;&nbsp;: <span class="id" title="keyword">∀</span> <a id="block:87" class="idref" href="#block:87"><span class="id" title="binder">block</span></a> <a id="votes_value:88" class="idref" href="#votes_value:88"><span class="id" title="binder">votes_value</span></a> <a id="d:89" class="idref" href="#d:89"><span class="id" title="binder">d</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Grandpa.Dictionary.html#lookup"><span class="id" title="definition">Dictionary.lookup</span></a> <a class="idref" href="Grandpa.Blocks.html#anyblock_eqb"><span class="id" title="definition">anyblock_eqb</span></a> <a class="idref" href="Grandpa.Votes.html#block:87"><span class="id" title="variable">block</span></a> (<a class="idref" href="Grandpa.Votes.html#make_votes_dictionary"><span class="id" title="definition">make_votes_dictionary</span></a> <a class="idref" href="Grandpa.Votes.html#votes:86"><span class="id" title="variable">votes</span></a> <a class="idref" href="Grandpa.Votes.html#d:89"><span class="id" title="variable">d</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="Grandpa.Votes.html#votes_value:88"><span class="id" title="variable">votes_value</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="Grandpa.Votes.html#votes_value:88"><span class="id" title="variable">votes_value</span></a> <a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Grandpa.ListFacts.html#count"><span class="id" title="definition">count</span></a> <a class="idref" href="Grandpa.Blocks.html#anyblock_eqb"><span class="id" title="definition">anyblock_eqb</span></a> <a class="idref" href="Grandpa.Votes.html#block:87"><span class="id" title="variable">block</span></a> <a class="idref" href="Grandpa.Votes.html#votes:86"><span class="id" title="variable">votes</span></a> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Init.Nat.html#0dacc1786c5ba797d47dd85006231633"><span class="id" title="notation">+</span></a> <a class="idref" href="Grandpa.Votes.html#some_to_nat"><span class="id" title="definition">some_to_nat</span></a> (<a class="idref" href="Grandpa.Dictionary.html#lookup"><span class="id" title="definition">Dictionary.lookup</span></a> <a class="idref" href="Grandpa.Blocks.html#anyblock_eqb"><span class="id" title="definition">anyblock_eqb</span></a> <a class="idref" href="Grandpa.Votes.html#block:87"><span class="id" title="variable">block</span></a> <a class="idref" href="Grandpa.Votes.html#d:89"><span class="id" title="variable">d</span></a>).<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a id="make_votes_dictionary_counts_right_aux2" class="idref" href="#make_votes_dictionary_counts_right_aux2"><span class="id" title="lemma">make_votes_dictionary_counts_right_aux2</span></a><br/>
&nbsp;&nbsp;(<a id="votes:90" class="idref" href="#votes:90"><span class="id" title="binder">votes</span></a>:<a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Init.Datatypes.html#list"><span class="id" title="inductive">list</span></a> <a class="idref" href="Grandpa.Blocks.html#AnyBlock"><span class="id" title="definition">AnyBlock</span></a>)<br/>
&nbsp;&nbsp;: <span class="id" title="keyword">∀</span> <a id="block:91" class="idref" href="#block:91"><span class="id" title="binder">block</span></a> <a id="d:92" class="idref" href="#d:92"><span class="id" title="binder">d</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Grandpa.Votes.html#some_to_nat"><span class="id" title="definition">some_to_nat</span></a> (<a class="idref" href="Grandpa.Dictionary.html#lookup"><span class="id" title="definition">Dictionary.lookup</span></a> <a class="idref" href="Grandpa.Blocks.html#anyblock_eqb"><span class="id" title="definition">anyblock_eqb</span></a> <a class="idref" href="Grandpa.Votes.html#block:91"><span class="id" title="variable">block</span></a> (<a class="idref" href="Grandpa.Votes.html#make_votes_dictionary"><span class="id" title="definition">make_votes_dictionary</span></a> <a class="idref" href="Grandpa.Votes.html#votes:90"><span class="id" title="variable">votes</span></a> <a class="idref" href="Grandpa.Votes.html#d:92"><span class="id" title="variable">d</span></a>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Grandpa.ListFacts.html#count"><span class="id" title="definition">count</span></a> <a class="idref" href="Grandpa.Blocks.html#anyblock_eqb"><span class="id" title="definition">anyblock_eqb</span></a> <a class="idref" href="Grandpa.Votes.html#block:91"><span class="id" title="variable">block</span></a> <a class="idref" href="Grandpa.Votes.html#votes:90"><span class="id" title="variable">votes</span></a> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Init.Nat.html#0dacc1786c5ba797d47dd85006231633"><span class="id" title="notation">+</span></a> <a class="idref" href="Grandpa.Votes.html#some_to_nat"><span class="id" title="definition">some_to_nat</span></a> (<a class="idref" href="Grandpa.Dictionary.html#lookup"><span class="id" title="definition">Dictionary.lookup</span></a> <a class="idref" href="Grandpa.Blocks.html#anyblock_eqb"><span class="id" title="definition">anyblock_eqb</span></a> <a class="idref" href="Grandpa.Votes.html#block:91"><span class="id" title="variable">block</span></a> <a class="idref" href="Grandpa.Votes.html#d:92"><span class="id" title="variable">d</span></a>).<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a id="make_votes_dictionary_counts_right" class="idref" href="#make_votes_dictionary_counts_right"><span class="id" title="lemma">make_votes_dictionary_counts_right</span></a><br/>
&nbsp;&nbsp;(<a id="votes:93" class="idref" href="#votes:93"><span class="id" title="binder">votes</span></a>:<a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Init.Datatypes.html#list"><span class="id" title="inductive">list</span></a> <a class="idref" href="Grandpa.Blocks.html#AnyBlock"><span class="id" title="definition">AnyBlock</span></a>)<br/>
&nbsp;&nbsp;: <span class="id" title="keyword">∀</span> (<a id="block:94" class="idref" href="#block:94"><span class="id" title="binder">block</span></a>:<a class="idref" href="Grandpa.Blocks.html#AnyBlock"><span class="id" title="definition">AnyBlock</span></a>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Grandpa.Votes.html#some_to_nat"><span class="id" title="definition">some_to_nat</span></a> (<a class="idref" href="Grandpa.Dictionary.html#lookup"><span class="id" title="definition">Dictionary.lookup</span></a> <a class="idref" href="Grandpa.Blocks.html#anyblock_eqb"><span class="id" title="definition">anyblock_eqb</span></a> <a class="idref" href="Grandpa.Votes.html#block:94"><span class="id" title="variable">block</span></a> (<a class="idref" href="Grandpa.Votes.html#make_votes_dictionary"><span class="id" title="definition">make_votes_dictionary</span></a> <a class="idref" href="Grandpa.Votes.html#votes:93"><span class="id" title="variable">votes</span></a> <a class="idref" href="Grandpa.Dictionary.html#empty"><span class="id" title="definition">Dictionary.empty</span></a>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Grandpa.ListFacts.html#count"><span class="id" title="definition">count</span></a> <a class="idref" href="Grandpa.Blocks.html#anyblock_eqb"><span class="id" title="definition">anyblock_eqb</span></a> <a class="idref" href="Grandpa.Votes.html#block:94"><span class="id" title="variable">block</span></a> <a class="idref" href="Grandpa.Votes.html#votes:93"><span class="id" title="variable">votes</span></a>.<br/>

<br/>
</div>

<div class="doc">
  A vote for <span class="inlinecode"><span class="id" title="var">B</span>:</span> <span class="inlinecode"><a class="idref" href="Grandpa.Blocks.html#Block"><span class="id" title="inductive">Block</span></a></span> <span class="inlinecode"><span class="id" title="var">n</span></span> is also a vote for <span class="inlinecode"><span class="id" title="var">B'</span>:<a class="idref" href="Grandpa.Blocks.html#Block"><span class="id" title="inductive">Block</span></a></span> <span class="inlinecode"><span class="id" title="var">n'</span></span> 
   as long as <span class="inlinecode"><span class="id" title="var">B'</span></span> <span class="inlinecode">≤</span> <span class="inlinecode"><span class="id" title="var">B</span></span>. 

</div>
<div class="code">
<span class="id" title="keyword">Fixpoint</span> <a id="flat_votes_aux" class="idref" href="#flat_votes_aux"><span class="id" title="definition">flat_votes_aux</span></a> {<a id="m:95" class="idref" href="#m:95"><span class="id" title="binder">m</span></a>}<br/>
&nbsp;&nbsp;(<a id="block:96" class="idref" href="#block:96"><span class="id" title="binder">block</span></a>:<a class="idref" href="Grandpa.Blocks.html#Block"><span class="id" title="inductive">Block</span></a> <a class="idref" href="Grandpa.Votes.html#m:95"><span class="id" title="variable">m</span></a>)<br/>
&nbsp;&nbsp;(<a id="voter_number:97" class="idref" href="#voter_number:97"><span class="id" title="binder">voter_number</span></a>:<a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a>)<br/>
&nbsp;&nbsp;(<a id="acc:98" class="idref" href="#acc:98"><span class="id" title="binder">acc</span></a>: <a class="idref" href="Grandpa.Votes.html#BlockDictionary"><span class="id" title="definition">BlockDictionary</span></a>): <a class="idref" href="Grandpa.Votes.html#BlockDictionary"><span class="id" title="definition">BlockDictionary</span></a><br/>
&nbsp;&nbsp;:=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="Grandpa.Votes.html#block:96"><span class="id" title="variable">block</span></a> <span class="id" title="keyword">with</span>  <br/>
&nbsp;&nbsp;| <a class="idref" href="Grandpa.Blocks.html#OriginBlock"><span class="id" title="constructor">OriginBlock</span></a> ⇒ <a class="idref" href="Grandpa.Votes.html#acc:98"><span class="id" title="variable">acc</span></a><br/>
&nbsp;&nbsp;| <a class="idref" href="Grandpa.Blocks.html#NewBlock"><span class="id" title="constructor">NewBlock</span></a> <span class="id" title="var">older_block</span> <span class="id" title="var">id</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="update_vote:104" class="idref" href="#update_vote:104"><span class="id" title="binder">update_vote</span></a> <a id="maybe_old_value:101" class="idref" href="#maybe_old_value:101"><span class="id" title="binder">maybe_old_value</span></a> <a id="v:102" class="idref" href="#v:102"><span class="id" title="binder">v</span></a> := <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="Grandpa.Votes.html#maybe_old_value:101"><span class="id" title="variable">maybe_old_value</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Init.Datatypes.html#None"><span class="id" title="constructor">None</span></a> ⇒ <a class="idref" href="Grandpa.Votes.html#v:102"><span class="id" title="variable">v</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <span class="id" title="var">v2</span> ⇒ <a class="idref" href="Grandpa.Votes.html#v:102"><span class="id" title="variable">v</span></a><a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Init.Nat.html#0dacc1786c5ba797d47dd85006231633"><span class="id" title="notation">+</span></a><span class="id" title="var">v2</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="updated_acc:105" class="idref" href="#updated_acc:105"><span class="id" title="binder">updated_acc</span></a> := <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Grandpa.Dictionary.html#update_with"><span class="id" title="definition">Dictionary.update_with</span></a> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Grandpa.Blocks.html#anyblock_eqb"><span class="id" title="definition">Blocks.anyblock_eqb</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Init.Specif.html#existT"><span class="id" title="constructor">existT</span></a> <span class="id" title="var">_</span> <a class="idref" href="Grandpa.Votes.html#m:95"><span class="id" title="variable">m</span></a> <a class="idref" href="Grandpa.Votes.html#block:96"><span class="id" title="variable">block</span></a>) <a class="idref" href="Grandpa.Votes.html#voter_number:97"><span class="id" title="variable">voter_number</span></a> <a class="idref" href="Grandpa.Votes.html#update_vote:104"><span class="id" title="variable">update_vote</span></a> <a class="idref" href="Grandpa.Votes.html#acc:98"><span class="id" title="variable">acc</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">in</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Grandpa.Votes.html#flat_votes_aux:99"><span class="id" title="definition">flat_votes_aux</span></a> <span class="id" title="var">older_block</span> <a class="idref" href="Grandpa.Votes.html#voter_number:97"><span class="id" title="variable">voter_number</span></a> <a class="idref" href="Grandpa.Votes.html#updated_acc:105"><span class="id" title="variable">updated_acc</span></a><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <a id="flat_votes_dictionary" class="idref" href="#flat_votes_dictionary"><span class="id" title="definition">flat_votes_dictionary</span></a> <br/>
&nbsp;&nbsp;(<a id="acc:106" class="idref" href="#acc:106"><span class="id" title="binder">acc</span></a>:<a class="idref" href="Grandpa.Votes.html#BlockDictionary"><span class="id" title="definition">BlockDictionary</span></a>) : <a class="idref" href="Grandpa.Votes.html#BlockDictionary"><span class="id" title="definition">BlockDictionary</span></a><br/>
&nbsp;&nbsp;:= <br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Lists.List.html#fold_right"><span class="id" title="definition">List.fold_right</span></a> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">fun</span> <a id="anyblock:107" class="idref" href="#anyblock:107"><span class="id" title="binder">anyblock</span></a> <a id="updated_dict:108" class="idref" href="#updated_dict:108"><span class="id" title="binder">updated_dict</span></a> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="Grandpa.Votes.html#anyblock:107"><span class="id" title="variable">anyblock</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><span class="id" title="var">block</span><a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a><span class="id" title="var">votes_for_block</span><a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;⇒ <a class="idref" href="Grandpa.Votes.html#flat_votes_aux"><span class="id" title="definition">flat_votes_aux</span></a> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Init.Specif.html#projT2"><span class="id" title="definition">projT2</span></a> <span class="id" title="var">block</span>) <span class="id" title="var">votes_for_block</span> <a class="idref" href="Grandpa.Votes.html#updated_dict:108"><span class="id" title="variable">updated_dict</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Grandpa.Dictionary.html#empty"><span class="id" title="definition">Dictionary.empty</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Grandpa.Dictionary.html#to_list"><span class="id" title="definition">Dictionary.to_list</span></a> <a class="idref" href="Grandpa.Votes.html#acc:106"><span class="id" title="variable">acc</span></a> ).<br/>

<br/>
</div>

<div class="doc">

<div class="paragraph"> </div>

  Takes a set of votes and returns a dictionary of blocks
   where the value for a block is the number of votes (already flattened)
   for that block.

<div class="paragraph"> </div>

  We have to use AnyBlock here since the Dictionary 
   contains blocks of different lengths.

</div>
<div class="code">
<span class="id" title="keyword">Definition</span> <a id="count_votes" class="idref" href="#count_votes"><span class="id" title="definition">count_votes</span></a> <br/>
&nbsp;&nbsp;{<a id="voters:110" class="idref" href="#voters:110"><span class="id" title="binder">voters</span></a>:<a class="idref" href="Grandpa.Votes.html#Voters"><span class="id" title="record">Voters</span></a>}<br/>
&nbsp;&nbsp;(<a id="votes:111" class="idref" href="#votes:111"><span class="id" title="binder">votes</span></a>: <a class="idref" href="Grandpa.Votes.html#Votes"><span class="id" title="inductive">Votes</span></a> <a class="idref" href="Grandpa.Votes.html#voters:110"><span class="id" title="variable">voters</span></a>): <a class="idref" href="Grandpa.Votes.html#BlockDictionary"><span class="id" title="definition">BlockDictionary</span></a><br/>
&nbsp;&nbsp;:=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="Grandpa.Votes.html#make_votes_dictionary"><span class="id" title="definition">make_votes_dictionary</span></a> (<a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Lists.List.html#map"><span class="id" title="definition">List.map</span></a> <a class="idref" href="Grandpa.Votes.html#vote_to_block"><span class="id" title="definition">vote_to_block</span></a> (<a class="idref" href="Grandpa.Votes.html#votes_to_list"><span class="id" title="definition">votes_to_list</span></a> <a class="idref" href="Grandpa.Votes.html#votes:111"><span class="id" title="variable">votes</span></a>)) <a class="idref" href="Grandpa.Dictionary.html#empty"><span class="id" title="definition">Dictionary.empty</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">out</span> ⇒ <a class="idref" href="Grandpa.Votes.html#flat_votes_dictionary"><span class="id" title="definition">flat_votes_dictionary</span></a> <span class="id" title="var">out</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a id="count_votes_nil_is_zero" class="idref" href="#count_votes_nil_is_zero"><span class="id" title="lemma">count_votes_nil_is_zero</span></a> <br/>
&nbsp;&nbsp;{<a id="voters:112" class="idref" href="#voters:112"><span class="id" title="binder">voters</span></a>:<a class="idref" href="Grandpa.Votes.html#Voters"><span class="id" title="record">Voters</span></a>}<br/>
&nbsp;&nbsp;(<a id="votes:113" class="idref" href="#votes:113"><span class="id" title="binder">votes</span></a>: <a class="idref" href="Grandpa.Votes.html#Votes"><span class="id" title="inductive">Votes</span></a> <a class="idref" href="Grandpa.Votes.html#voters:112"><span class="id" title="variable">voters</span></a>)<br/>
&nbsp;&nbsp;: <a class="idref" href="Grandpa.Votes.html#votes_to_list"><span class="id" title="definition">votes_to_list</span></a> <a class="idref" href="Grandpa.Votes.html#votes:113"><span class="id" title="variable">votes</span></a> <a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Init.Datatypes.html#nil"><span class="id" title="constructor">nil</span></a> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="Grandpa.Dictionary.html#to_list"><span class="id" title="definition">Dictionary.to_list</span></a> (<a class="idref" href="Grandpa.Votes.html#count_votes"><span class="id" title="definition">count_votes</span></a> <a class="idref" href="Grandpa.Votes.html#votes:113"><span class="id" title="variable">votes</span></a>) <a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Init.Datatypes.html#nil"><span class="id" title="constructor">nil</span></a>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a id="count_votes_works" class="idref" href="#count_votes_works"><span class="id" title="lemma">count_votes_works</span></a> <br/>
&nbsp;&nbsp;{<a id="block_number:114" class="idref" href="#block_number:114"><span class="id" title="binder">block_number</span></a>:<a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a>}<br/>
&nbsp;&nbsp;(<a id="block:115" class="idref" href="#block:115"><span class="id" title="binder">block</span></a>: <a class="idref" href="Grandpa.Blocks.html#Block"><span class="id" title="inductive">Block</span></a> <a class="idref" href="Grandpa.Votes.html#block_number:114"><span class="id" title="variable">block_number</span></a>)<br/>
&nbsp;&nbsp;{<a id="voters:116" class="idref" href="#voters:116"><span class="id" title="binder">voters</span></a>:<a class="idref" href="Grandpa.Votes.html#Voters"><span class="id" title="record">Voters</span></a>}<br/>
&nbsp;&nbsp;(<a id="votes:117" class="idref" href="#votes:117"><span class="id" title="binder">votes</span></a>:<a class="idref" href="Grandpa.Votes.html#Votes"><span class="id" title="inductive">Votes</span></a> <a class="idref" href="Grandpa.Votes.html#voters:116"><span class="id" title="variable">voters</span></a>)<br/>
&nbsp;&nbsp;:<br/>
&nbsp;&nbsp;<a class="idref" href="Grandpa.Votes.html#some_to_nat"><span class="id" title="definition">some_to_nat</span></a>(<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Grandpa.Dictionary.html#lookup"><span class="id" title="definition">Dictionary.lookup</span></a> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Grandpa.Blocks.html#anyblock_eqb"><span class="id" title="definition">anyblock_eqb</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Init.Specif.html#existT"><span class="id" title="constructor">existT</span></a> <span class="id" title="var">_</span> <a class="idref" href="Grandpa.Votes.html#block_number:114"><span class="id" title="variable">block_number</span></a> <a class="idref" href="Grandpa.Votes.html#block:115"><span class="id" title="variable">block</span></a>) <br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Grandpa.Votes.html#count_votes"><span class="id" title="definition">count_votes</span></a> <a class="idref" href="Grandpa.Votes.html#votes:117"><span class="id" title="variable">votes</span></a>)<br/>
&nbsp;&nbsp;)<br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a><a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Init.Datatypes.html#length"><span class="id" title="definition">length</span></a> (<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Lists.List.html#filter"><span class="id" title="definition">List.filter</span></a> (<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">fun</span> <a id="vote:118" class="idref" href="#vote:118"><span class="id" title="binder">vote</span></a> ⇒ <a class="idref" href="Grandpa.Blocks.html#is_prefix"><span class="id" title="definition">is_prefix</span></a> <a class="idref" href="Grandpa.Votes.html#block:115"><span class="id" title="variable">block</span></a> (<a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Init.Specif.html#projT2"><span class="id" title="definition">projT2</span></a> (<a class="idref" href="Grandpa.Votes.html#vote_to_block"><span class="id" title="definition">vote_to_block</span></a> <a class="idref" href="Grandpa.Votes.html#vote:118"><span class="id" title="variable">vote</span></a>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Grandpa.Votes.html#votes_to_list"><span class="id" title="definition">votes_to_list</span></a> <a class="idref" href="Grandpa.Votes.html#votes:117"><span class="id" title="variable">votes</span></a>) <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;).<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a id="voted_block_in_count_votes" class="idref" href="#voted_block_in_count_votes"><span class="id" title="lemma">voted_block_in_count_votes</span></a> <br/>
&nbsp;&nbsp;{<a id="voters:119" class="idref" href="#voters:119"><span class="id" title="binder">voters</span></a>:<a class="idref" href="Grandpa.Votes.html#Voters"><span class="id" title="record">Voters</span></a> }<br/>
&nbsp;&nbsp;(<a id="votes:120" class="idref" href="#votes:120"><span class="id" title="binder">votes</span></a>: <a class="idref" href="Grandpa.Votes.html#Votes"><span class="id" title="inductive">Votes</span></a> <a class="idref" href="Grandpa.Votes.html#voters:119"><span class="id" title="variable">voters</span></a>)<br/>
&nbsp;&nbsp;{<a id="voter:121" class="idref" href="#voter:121"><span class="id" title="binder">voter</span></a>:<a class="idref" href="Grandpa.Votes.html#Voter"><span class="id" title="definition">Voter</span></a> }<br/>
&nbsp;&nbsp;{<a id="is_voter:122" class="idref" href="#is_voter:122"><span class="id" title="binder">is_voter</span></a>: <a class="idref" href="Grandpa.Votes.html#in_Voters"><span class="id" title="definition">in_Voters</span></a> <a class="idref" href="Grandpa.Votes.html#voter:121"><span class="id" title="variable">voter</span></a> <a class="idref" href="Grandpa.Votes.html#voters:119"><span class="id" title="variable">voters</span></a>}<br/>
&nbsp;&nbsp;{<a id="block_number:123" class="idref" href="#block_number:123"><span class="id" title="binder">block_number</span></a>:<a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a>}<br/>
&nbsp;&nbsp;{<a id="block:124" class="idref" href="#block:124"><span class="id" title="binder">block</span></a>: <a class="idref" href="Grandpa.Blocks.html#Block"><span class="id" title="inductive">Block</span></a> <a class="idref" href="Grandpa.Votes.html#block_number:123"><span class="id" title="variable">block_number</span></a>}<br/>
&nbsp;&nbsp;(<a id="vote:125" class="idref" href="#vote:125"><span class="id" title="binder">vote</span></a>: <a class="idref" href="Grandpa.Votes.html#Vote"><span class="id" title="inductive">Vote</span></a> <a class="idref" href="Grandpa.Votes.html#voters:119"><span class="id" title="variable">voters</span></a>)<br/>
&nbsp;&nbsp;{<a id="vote_is:126" class="idref" href="#vote_is:126"><span class="id" title="binder">vote_is</span></a>: <a class="idref" href="Grandpa.Votes.html#vote:125"><span class="id" title="variable">vote</span></a> <a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Grandpa.Votes.html#VoteC"><span class="id" title="constructor">VoteC</span></a> <a class="idref" href="Grandpa.Votes.html#voters:119"><span class="id" title="variable">voters</span></a> <a class="idref" href="Grandpa.Votes.html#voter:121"><span class="id" title="variable">voter</span></a> <a class="idref" href="Grandpa.Votes.html#is_voter:122"><span class="id" title="variable">is_voter</span></a> <a class="idref" href="Grandpa.Votes.html#block:124"><span class="id" title="variable">block</span></a>}<br/>
&nbsp;&nbsp;(<a id="is_vote:127" class="idref" href="#is_vote:127"><span class="id" title="binder">is_vote</span></a> : <a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Lists.List.html#In"><span class="id" title="definition">List.In</span></a> <a class="idref" href="Grandpa.Votes.html#vote:125"><span class="id" title="variable">vote</span></a> (<a class="idref" href="Grandpa.Votes.html#votes_to_list"><span class="id" title="definition">votes_to_list</span></a> <a class="idref" href="Grandpa.Votes.html#votes:120"><span class="id" title="variable">votes</span></a>))<br/>
&nbsp;&nbsp;: <a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">∃</span></a> <a id="v:128" class="idref" href="#v:128"><span class="id" title="binder">v</span></a>:<a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">,</span></a> <a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Lists.List.html#In"><span class="id" title="definition">List.In</span></a> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Init.Specif.html#existT"><span class="id" title="constructor">existT</span></a> <span class="id" title="var">_</span> <a class="idref" href="Grandpa.Votes.html#block_number:123"><span class="id" title="variable">block_number</span></a> <a class="idref" href="Grandpa.Votes.html#block:124"><span class="id" title="variable">block</span></a><a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a><a class="idref" href="Grandpa.Votes.html#v:128"><span class="id" title="variable">v</span></a><a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Grandpa.Dictionary.html#to_list"><span class="id" title="definition">Dictionary.to_list</span></a> (<a class="idref" href="Grandpa.Votes.html#count_votes"><span class="id" title="definition">count_votes</span></a> <a class="idref" href="Grandpa.Votes.html#votes:120"><span class="id" title="variable">votes</span></a>)).<br/>

<br/>
</div>

<div class="doc">
  This is the core function implementing supermajority.

<div class="paragraph"> </div>

   From the paper: 

<div class="paragraph"> </div>

<pre>
A voter equivocates in a set of votes [S] if they have cast multiple different 
votes in [S] . We call a set [S] of votes safe if the number of voters 
who equivocate in [S] is at most [f] . We say that [S] has a [supermajority]
for a block [B] if the set of voters who either have a vote for 
blocks [&gt;= B] or equivocate in [S] has size at least [(n+f + 1)/2]. 
We count equivocations as votes for everything so that observing a vote 
is monotonic, meaning that if [S ⊂ T] then if [S] has a supermajority 
for [B] so does [T] , while being able to ignore yet more equivocating votes
from an equivocating voter.
</pre>

<div class="paragraph"> </div>

Our implementation aproach is as follows:

<div class="paragraph"> </div>

<ul class="doclist">
<li> Find the equivocate votes and the ones that aren't equivocate.

</li>
<li> Count the non equivocate votes for every block.

</li>
<li> Remove blocks that don't have at least <span class="inlinecode">(<span class="id" title="var">n</span>+<span class="id" title="var">f</span>+1)/2</span> votes.
      In this case <span class="inlinecode"><span class="id" title="var">n</span>:=<a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Init.Datatypes.html#length"><span class="id" title="definition">length</span></a></span> <span class="inlinecode"><a class="idref" href="Grandpa.Votes.html#Some.voters"><span class="id" title="variable">voters</span></a></span> and <span class="inlinecode"><span class="id" title="var">f</span>:=</span> <span class="inlinecode"></span>

</li>
</ul>

</div>
<div class="code">

<br/>
<span class="id" title="keyword">Definition</span> <a id="has_supermajority_predicate" class="idref" href="#has_supermajority_predicate"><span class="id" title="definition">has_supermajority_predicate</span></a> <br/>
&nbsp;&nbsp;(<a id="voters:129" class="idref" href="#voters:129"><span class="id" title="binder">voters</span></a>:<a class="idref" href="Grandpa.Votes.html#Voters"><span class="id" title="record">Voters</span></a>)<br/>
&nbsp;&nbsp;(<a id="number_of_equivocates:130" class="idref" href="#number_of_equivocates:130"><span class="id" title="binder">number_of_equivocates</span></a>:<a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a>)<br/>
&nbsp;&nbsp;(<a id="block_and_vote:131" class="idref" href="#block_and_vote:131"><span class="id" title="binder">block_and_vote</span></a>:<a class="idref" href="Grandpa.Blocks.html#AnyBlock"><span class="id" title="definition">AnyBlock</span></a><a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Init.Datatypes.html#11c698c8685bb8ab1cf725545c085ac4"><span class="id" title="notation">×</span></a><a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a>) : <a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Init.Datatypes.html#bool"><span class="id" title="inductive">bool</span></a>:= <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="Grandpa.Votes.html#block_and_vote:131"><span class="id" title="variable">block_and_vote</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><span class="id" title="var">_</span><a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <span class="id" title="var">number_of_votes</span><a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;⇒ <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Grandpa.Votes.html#voters:129"><span class="id" title="variable">voters</span></a>.(<a class="idref" href="Grandpa.Votes.html#round_number_of_voters"><span class="id" title="projection">round_number_of_voters</span></a>) <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Init.Nat.html#0dacc1786c5ba797d47dd85006231633"><span class="id" title="notation">+</span></a> <a class="idref" href="Grandpa.Votes.html#calculate_max_bizantiners"><span class="id" title="definition">calculate_max_bizantiners</span></a> <a class="idref" href="Grandpa.Votes.html#voters:129"><span class="id" title="variable">voters</span></a> <a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Init.Nat.html#0dacc1786c5ba797d47dd85006231633"><span class="id" title="notation">+</span></a>1 <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Init.Nat.html#6b7621b45fff0af5e2b2cbb2bc2d4e1d"><span class="id" title="notation">&lt;?</span></a> 2 <a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Init.Nat.html#ea2ff3d561159081cea6fb2e8113cc54"><span class="id" title="notation">×</span></a> <a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Init.Nat.html#ea2ff3d561159081cea6fb2e8113cc54"><span class="id" title="notation">(</span></a><span class="id" title="var">number_of_votes</span> <a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Init.Nat.html#0dacc1786c5ba797d47dd85006231633"><span class="id" title="notation">+</span></a> <a class="idref" href="Grandpa.Votes.html#number_of_equivocates:130"><span class="id" title="variable">number_of_equivocates</span></a><a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Init.Nat.html#ea2ff3d561159081cea6fb2e8113cc54"><span class="id" title="notation">)</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <a id="get_supermajority_blocks" class="idref" href="#get_supermajority_blocks"><span class="id" title="definition">get_supermajority_blocks</span></a> <br/>
&nbsp;&nbsp;{<a id="voters:133" class="idref" href="#voters:133"><span class="id" title="binder">voters</span></a>:<a class="idref" href="Grandpa.Votes.html#Voters"><span class="id" title="record">Voters</span></a>}<br/>
&nbsp;&nbsp;(<a id="T:134" class="idref" href="#T:134"><span class="id" title="binder">T</span></a> : <a class="idref" href="Grandpa.Votes.html#Votes"><span class="id" title="inductive">Votes</span></a> <a class="idref" href="Grandpa.Votes.html#voters:133"><span class="id" title="variable">voters</span></a>) <br/>
&nbsp;&nbsp;: <a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Init.Datatypes.html#list"><span class="id" title="inductive">list</span></a> (<a class="idref" href="Grandpa.Blocks.html#AnyBlock"><span class="id" title="definition">AnyBlock</span></a> <a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Init.Datatypes.html#11c698c8685bb8ab1cf725545c085ac4"><span class="id" title="notation">×</span></a> <a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a>)<br/>
&nbsp;&nbsp;:= <br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> (<a id="equivocate_voters:135" class="idref" href="#equivocate_voters:135"><span class="id" title="binder">equivocate_voters</span></a>, <a id="non_equivocate_voters:136" class="idref" href="#non_equivocate_voters:136"><span class="id" title="binder">non_equivocate_voters</span></a>) <br/>
&nbsp;&nbsp;&nbsp;&nbsp;:= <a class="idref" href="Grandpa.Votes.html#split_voters_by_equivocation"><span class="id" title="definition">split_voters_by_equivocation</span></a> <a class="idref" href="Grandpa.Votes.html#T:134"><span class="id" title="variable">T</span></a><br/>
&nbsp;&nbsp;<span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="number_of_equivocates:137" class="idref" href="#number_of_equivocates:137"><span class="id" title="binder">number_of_equivocates</span></a> := <a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Init.Datatypes.html#length"><span class="id" title="definition">length</span></a> <a class="idref" href="Grandpa.Votes.html#equivocate_voters:135"><span class="id" title="variable">equivocate_voters</span></a><br/>
&nbsp;&nbsp;<span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="count:138" class="idref" href="#count:138"><span class="id" title="binder">count</span></a>  <br/>
&nbsp;&nbsp;&nbsp;&nbsp;:= <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Grandpa.Votes.html#count_votes"><span class="id" title="definition">count_votes</span></a>  <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Grandpa.Votes.html#filter_votes_by_voters_subset"><span class="id" title="definition">filter_votes_by_voters_subset</span></a> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Grandpa.Votes.html#voters:133"><span class="id" title="variable">voters</span></a> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Grandpa.Votes.html#T:134"><span class="id" title="variable">T</span></a> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Grandpa.Votes.html#voters_from_list"><span class="id" title="definition">voters_from_list</span></a> <a class="idref" href="Grandpa.Votes.html#non_equivocate_voters:136"><span class="id" title="variable">non_equivocate_voters</span></a> <a class="idref" href="Grandpa.Votes.html#voters:133"><span class="id" title="variable">voters</span></a>.(<a class="idref" href="Grandpa.Votes.html#round_number_of_voters"><span class="id" title="projection">round_number_of_voters</span></a>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>
&nbsp;&nbsp;<span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="blocks_with_super_majority:139" class="idref" href="#blocks_with_super_majority:139"><span class="id" title="binder">blocks_with_super_majority</span></a> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;:= <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Lists.List.html#filter"><span class="id" title="definition">List.filter</span></a> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Grandpa.Votes.html#has_supermajority_predicate"><span class="id" title="definition">has_supermajority_predicate</span></a> <a class="idref" href="Grandpa.Votes.html#voters:133"><span class="id" title="variable">voters</span></a> <a class="idref" href="Grandpa.Votes.html#number_of_equivocates:137"><span class="id" title="variable">number_of_equivocates</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Grandpa.Dictionary.html#to_list"><span class="id" title="definition">Dictionary.to_list</span></a> <a class="idref" href="Grandpa.Votes.html#count:138"><span class="id" title="variable">count</span></a>)<br/>
&nbsp;&nbsp;<span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Grandpa.Votes.html#blocks_with_super_majority:139"><span class="id" title="variable">blocks_with_super_majority</span></a>.<br/>

<br/>
</div>

<div class="doc">
This definition doesn't take in account the repetitions of elements

</div>
<div class="code">

<br/>
<span class="id" title="keyword">Lemma</span> <a id="equivocates_are_voters_aux" class="idref" href="#equivocates_are_voters_aux"><span class="id" title="lemma">equivocates_are_voters_aux</span></a> {<a id="A:140" class="idref" href="#A:140"><span class="id" title="binder">A</span></a>} (<a id="l:141" class="idref" href="#l:141"><span class="id" title="binder">l</span></a> <a id="l1:142" class="idref" href="#l1:142"><span class="id" title="binder">l1</span></a> <a id="l2:143" class="idref" href="#l2:143"><span class="id" title="binder">l2</span></a>:<a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Init.Datatypes.html#list"><span class="id" title="inductive">list</span></a> <a class="idref" href="Grandpa.Votes.html#A:140"><span class="id" title="variable">A</span></a>) <a id="p:144" class="idref" href="#p:144"><span class="id" title="binder">p</span></a> <br/>
&nbsp;&nbsp;: <br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Lists.List.html#partition"><span class="id" title="definition">List.partition</span></a> <a class="idref" href="Grandpa.Votes.html#p:144"><span class="id" title="variable">p</span></a> <a class="idref" href="Grandpa.Votes.html#l:141"><span class="id" title="variable">l</span></a> <a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="Grandpa.Votes.html#l1:142"><span class="id" title="variable">l1</span></a><a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a><a class="idref" href="Grandpa.Votes.html#l2:143"><span class="id" title="variable">l2</span></a><a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a> <span class="id" title="keyword">∀</span> <a id="x:145" class="idref" href="#x:145"><span class="id" title="binder">x</span></a>, <a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Lists.List.html#In"><span class="id" title="definition">List.In</span></a> <a class="idref" href="Grandpa.Votes.html#x:145"><span class="id" title="variable">x</span></a> <a class="idref" href="Grandpa.Votes.html#l1:142"><span class="id" title="variable">l1</span></a> <br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="Grandpa.Votes.html#p:144"><span class="id" title="variable">p</span></a> <a class="idref" href="Grandpa.Votes.html#x:145"><span class="id" title="variable">x</span></a> <a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Init.Datatypes.html#true"><span class="id" title="constructor">true</span></a>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a id="equivocates_are_voters" class="idref" href="#equivocates_are_voters"><span class="id" title="lemma">equivocates_are_voters</span></a> <br/>
&nbsp;&nbsp;{<a id="voters:146" class="idref" href="#voters:146"><span class="id" title="binder">voters</span></a>:<a class="idref" href="Grandpa.Votes.html#Voters"><span class="id" title="record">Voters</span></a>}<br/>
&nbsp;&nbsp;(<a id="T:147" class="idref" href="#T:147"><span class="id" title="binder">T</span></a> : <a class="idref" href="Grandpa.Votes.html#Votes"><span class="id" title="inductive">Votes</span></a> <a class="idref" href="Grandpa.Votes.html#voters:146"><span class="id" title="variable">voters</span></a>) <br/>
&nbsp;&nbsp;{<a id="equivocate_voters:148" class="idref" href="#equivocate_voters:148"><span class="id" title="binder">equivocate_voters</span></a> <a id="non_equivocate_voters:149" class="idref" href="#non_equivocate_voters:149"><span class="id" title="binder">non_equivocate_voters</span></a>: <a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Init.Datatypes.html#list"><span class="id" title="inductive">list</span></a> <a class="idref" href="Grandpa.Votes.html#Voter"><span class="id" title="definition">Voter</span></a>}<br/>
&nbsp;&nbsp;{<a id="split_result:150" class="idref" href="#split_result:150"><span class="id" title="binder">split_result</span></a>: <a class="idref" href="Grandpa.Votes.html#split_voters_by_equivocation"><span class="id" title="definition">split_voters_by_equivocation</span></a> <a class="idref" href="Grandpa.Votes.html#T:147"><span class="id" title="variable">T</span></a> <a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="Grandpa.Votes.html#equivocate_voters:148"><span class="id" title="variable">equivocate_voters</span></a><a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a><a class="idref" href="Grandpa.Votes.html#non_equivocate_voters:149"><span class="id" title="variable">non_equivocate_voters</span></a><a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a>}<br/>
&nbsp;&nbsp;: <span class="id" title="keyword">∀</span> (<a id="voter:151" class="idref" href="#voter:151"><span class="id" title="binder">voter</span></a>:<a class="idref" href="Grandpa.Votes.html#Voter"><span class="id" title="definition">Voter</span></a>), <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Lists.List.html#In"><span class="id" title="definition">List.In</span></a> <a class="idref" href="Grandpa.Votes.html#voter:151"><span class="id" title="variable">voter</span></a> <a class="idref" href="Grandpa.Votes.html#equivocate_voters:148"><span class="id" title="variable">equivocate_voters</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Lists.List.html#In"><span class="id" title="definition">List.In</span></a> <a class="idref" href="Grandpa.Votes.html#voter:151"><span class="id" title="variable">voter</span></a> (<a class="idref" href="Grandpa.Votes.html#votes_to_voters_list"><span class="id" title="definition">votes_to_voters_list</span></a> <a class="idref" href="Grandpa.Votes.html#T:147"><span class="id" title="variable">T</span></a>).<br/>

<br/>
</div>

<div class="doc">
From the paper:

<div class="paragraph"> </div>

<pre>
We count equivocations as votes for everything so that observing a vote is 
monotonic, meaning that if [S ⊂ T] then if [S] has a supermajority 
for [B] so does [T] , while being able to ignore yet more equivocating votes 
from an equivocating voter.
</pre>

<div class="paragraph"> </div>

TODO: Really important

</div>
<div class="code">
<span class="id" title="keyword">Lemma</span> <a id="blocks_with_super_majority_are_related" class="idref" href="#blocks_with_super_majority_are_related"><span class="id" title="lemma">blocks_with_super_majority_are_related</span></a> <br/>
&nbsp;&nbsp;{<a id="voters:156" class="idref" href="#voters:156"><span class="id" title="binder">voters</span></a>:<a class="idref" href="Grandpa.Votes.html#Voters"><span class="id" title="record">Voters</span></a>}<br/>
&nbsp;&nbsp;(<a id="T:157" class="idref" href="#T:157"><span class="id" title="binder">T</span></a> : <a class="idref" href="Grandpa.Votes.html#Votes"><span class="id" title="inductive">Votes</span></a> <a class="idref" href="Grandpa.Votes.html#voters:156"><span class="id" title="variable">voters</span></a>) <br/>
&nbsp;&nbsp;(<a id="is_safe_t:158" class="idref" href="#is_safe_t:158"><span class="id" title="binder">is_safe_t</span></a>: <a class="idref" href="Grandpa.Votes.html#is_safe"><span class="id" title="definition">is_safe</span></a> <a class="idref" href="Grandpa.Votes.html#T:157"><span class="id" title="variable">T</span></a> <a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Init.Datatypes.html#true"><span class="id" title="constructor">true</span></a>)<br/>
&nbsp;&nbsp;: <span class="id" title="keyword">∀</span> (<a id="block1:159" class="idref" href="#block1:159"><span class="id" title="binder">block1</span></a> <a id="block2:160" class="idref" href="#block2:160"><span class="id" title="binder">block2</span></a>:<a class="idref" href="Grandpa.Blocks.html#AnyBlock"><span class="id" title="definition">AnyBlock</span></a>) (<a id="v1:161" class="idref" href="#v1:161"><span class="id" title="binder">v1</span></a> <a id="v2:162" class="idref" href="#v2:162"><span class="id" title="binder">v2</span></a>:<a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a>), <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Lists.List.html#In"><span class="id" title="definition">List.In</span></a> <a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="Grandpa.Votes.html#block1:159"><span class="id" title="variable">block1</span></a><a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a><a class="idref" href="Grandpa.Votes.html#v1:161"><span class="id" title="variable">v1</span></a><a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> (<a class="idref" href="Grandpa.Votes.html#get_supermajority_blocks"><span class="id" title="definition">get_supermajority_blocks</span></a> <a class="idref" href="Grandpa.Votes.html#T:157"><span class="id" title="variable">T</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Lists.List.html#In"><span class="id" title="definition">List.In</span></a> <a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="Grandpa.Votes.html#block2:160"><span class="id" title="variable">block2</span></a><a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a><a class="idref" href="Grandpa.Votes.html#v2:162"><span class="id" title="variable">v2</span></a><a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> (<a class="idref" href="Grandpa.Votes.html#get_supermajority_blocks"><span class="id" title="definition">get_supermajority_blocks</span></a> <a class="idref" href="Grandpa.Votes.html#T:157"><span class="id" title="variable">T</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="Grandpa.Blocks.html#81e660aade3f2d7ad6d955d42883c466"><span class="id" title="notation">(</span></a><a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Init.Specif.html#projT2"><span class="id" title="definition">projT2</span></a> <a class="idref" href="Grandpa.Votes.html#block1:159"><span class="id" title="variable">block1</span></a><a class="idref" href="Grandpa.Blocks.html#81e660aade3f2d7ad6d955d42883c466"><span class="id" title="notation">)</span></a> <a class="idref" href="Grandpa.Blocks.html#81e660aade3f2d7ad6d955d42883c466"><span class="id" title="notation">¬</span></a> <a class="idref" href="Grandpa.Blocks.html#81e660aade3f2d7ad6d955d42883c466"><span class="id" title="notation">(</span></a><a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Init.Specif.html#projT2"><span class="id" title="definition">projT2</span></a> <a class="idref" href="Grandpa.Votes.html#block2:160"><span class="id" title="variable">block2</span></a><a class="idref" href="Grandpa.Blocks.html#81e660aade3f2d7ad6d955d42883c466"><span class="id" title="notation">)</span></a>.<br/>

<br/>
<span class="id" title="keyword">Open</span> <span class="id" title="keyword">Scope</span> <span class="id" title="var">list</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a id="list_in_location" class="idref" href="#list_in_location"><span class="id" title="lemma">list_in_location</span></a> {<a id="A:163" class="idref" href="#A:163"><span class="id" title="binder">A</span></a>} (<a id="x:164" class="idref" href="#x:164"><span class="id" title="binder">x</span></a>:<a class="idref" href="Grandpa.Votes.html#A:163"><span class="id" title="variable">A</span></a>) <a id="l:165" class="idref" href="#l:165"><span class="id" title="binder">l</span></a> : <br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Lists.List.html#In"><span class="id" title="definition">List.In</span></a> <a class="idref" href="Grandpa.Votes.html#x:164"><span class="id" title="variable">x</span></a> <a class="idref" href="Grandpa.Votes.html#l:165"><span class="id" title="variable">l</span></a> <a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Init.Logic.html#::type_scope:x_'&lt;-&gt;'_x"><span class="id" title="notation">↔</span></a> <a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">∃</span></a> <a id="l1:166" class="idref" href="#l1:166"><span class="id" title="binder">l1</span></a> <a id="l2:167" class="idref" href="#l2:167"><span class="id" title="binder">l2</span></a><a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">,</span></a> <a class="idref" href="Grandpa.Votes.html#l:165"><span class="id" title="variable">l</span></a> <a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Grandpa.Votes.html#l1:166"><span class="id" title="variable">l1</span></a> <a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Init.Datatypes.html#bc347c51eaf667706ae54503b26d52c6"><span class="id" title="notation">++</span></a> <a class="idref" href="Grandpa.Votes.html#x:164"><span class="id" title="variable">x</span></a><a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Init.Datatypes.html#::list_scope:x_'::'_x"><span class="id" title="notation">::</span></a><a class="idref" href="Grandpa.Votes.html#l2:167"><span class="id" title="variable">l2</span></a>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a id="superset_has_subset_majority_blocks_aux1" class="idref" href="#superset_has_subset_majority_blocks_aux1"><span class="id" title="lemma">superset_has_subset_majority_blocks_aux1</span></a>  <a id="l:168" class="idref" href="#l:168"><span class="id" title="binder">l</span></a> <a id="p:169" class="idref" href="#p:169"><span class="id" title="binder">p</span></a> (<a id="b:170" class="idref" href="#b:170"><span class="id" title="binder">b</span></a>:<a class="idref" href="Grandpa.Blocks.html#AnyBlock"><span class="id" title="definition">AnyBlock</span></a>) : <br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">(</span></a><a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">∃</span></a> <a id="v:171" class="idref" href="#v:171"><span class="id" title="binder">v</span></a>:<a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a><a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">,</span></a> <a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Lists.List.html#In"><span class="id" title="definition">List.In</span></a> <a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="Grandpa.Votes.html#b:170"><span class="id" title="variable">b</span></a><a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a><a class="idref" href="Grandpa.Votes.html#v:171"><span class="id" title="variable">v</span></a><a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <a class="idref" href="Grandpa.Votes.html#l:168"><span class="id" title="variable">l</span></a> <a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">∧</span></a> <a class="idref" href="Grandpa.Votes.html#p:169"><span class="id" title="variable">p</span></a> <a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="Grandpa.Votes.html#b:170"><span class="id" title="variable">b</span></a><a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a><a class="idref" href="Grandpa.Votes.html#v:171"><span class="id" title="variable">v</span></a><a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a><a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Init.Datatypes.html#true"><span class="id" title="constructor">true</span></a> <a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">)</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">∃</span></a> <a id="v:172" class="idref" href="#v:172"><span class="id" title="binder">v</span></a>:<a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a><a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">,</span></a> <a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Lists.List.html#In"><span class="id" title="definition">List.In</span></a> <a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="Grandpa.Votes.html#b:170"><span class="id" title="variable">b</span></a><a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a><a class="idref" href="Grandpa.Votes.html#v:172"><span class="id" title="variable">v</span></a><a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> (<a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Lists.List.html#filter"><span class="id" title="definition">List.filter</span></a> <a class="idref" href="Grandpa.Votes.html#p:169"><span class="id" title="variable">p</span></a> <a class="idref" href="Grandpa.Votes.html#l:168"><span class="id" title="variable">l</span></a>).<br/>

<br/>
<span class="id" title="keyword">Definition</span> <a id="VotesIsSubset" class="idref" href="#VotesIsSubset"><span class="id" title="definition">VotesIsSubset</span></a>  <br/>
&nbsp;&nbsp;{<a id="voters:173" class="idref" href="#voters:173"><span class="id" title="binder">voters</span></a>:<a class="idref" href="Grandpa.Votes.html#Voters"><span class="id" title="record">Voters</span></a> }<br/>
&nbsp;&nbsp;(<a id="S:174" class="idref" href="#S:174"><span class="id" title="binder">S</span></a> : <a class="idref" href="Grandpa.Votes.html#Votes"><span class="id" title="inductive">Votes</span></a> <a class="idref" href="Grandpa.Votes.html#voters:173"><span class="id" title="variable">voters</span></a> )<br/>
&nbsp;&nbsp;(<a id="T:175" class="idref" href="#T:175"><span class="id" title="binder">T</span></a> : <a class="idref" href="Grandpa.Votes.html#Votes"><span class="id" title="inductive">Votes</span></a> <a class="idref" href="Grandpa.Votes.html#voters:173"><span class="id" title="variable">voters</span></a>) <br/>
&nbsp;&nbsp;:<span class="id" title="keyword">Prop</span><br/>
&nbsp;&nbsp;:=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">∀</span> (<a id="vote:176" class="idref" href="#vote:176"><span class="id" title="binder">vote</span></a>: <a class="idref" href="Grandpa.Votes.html#Vote"><span class="id" title="inductive">Vote</span></a> <a class="idref" href="Grandpa.Votes.html#voters:173"><span class="id" title="variable">voters</span></a>), <br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Grandpa.ListFacts.html#count"><span class="id" title="definition">count</span></a> <a class="idref" href="Grandpa.Votes.html#vote_eqb"><span class="id" title="definition">vote_eqb</span></a> <a class="idref" href="Grandpa.Votes.html#vote:176"><span class="id" title="variable">vote</span></a>  (<a class="idref" href="Grandpa.Votes.html#votes_to_list"><span class="id" title="definition">votes_to_list</span></a> <a class="idref" href="Grandpa.Votes.html#S:174"><span class="id" title="variable">S</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Init.Peano.html#cb53cf0ee22c036a03b4a9281c68b5a3"><span class="id" title="notation">≤</span></a> <a class="idref" href="Grandpa.ListFacts.html#count"><span class="id" title="definition">count</span></a> <a class="idref" href="Grandpa.Votes.html#vote_eqb"><span class="id" title="definition">vote_eqb</span></a> <a class="idref" href="Grandpa.Votes.html#vote:176"><span class="id" title="variable">vote</span></a> (<a class="idref" href="Grandpa.Votes.html#votes_to_list"><span class="id" title="definition">votes_to_list</span></a> <a class="idref" href="Grandpa.Votes.html#T:175"><span class="id" title="variable">T</span></a>))%<span class="id" title="var">nat</span>.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <a id="intersection" class="idref" href="#intersection"><span class="id" title="definition">intersection</span></a>  <br/>
&nbsp;&nbsp;{<a id="voters:177" class="idref" href="#voters:177"><span class="id" title="binder">voters</span></a>:<a class="idref" href="Grandpa.Votes.html#Voters"><span class="id" title="record">Voters</span></a> }<br/>
&nbsp;&nbsp;(<a id="S:178" class="idref" href="#S:178"><span class="id" title="binder">S</span></a> : <a class="idref" href="Grandpa.Votes.html#Votes"><span class="id" title="inductive">Votes</span></a> <a class="idref" href="Grandpa.Votes.html#voters:177"><span class="id" title="variable">voters</span></a>)<br/>
&nbsp;&nbsp;(<a id="T:179" class="idref" href="#T:179"><span class="id" title="binder">T</span></a> : <a class="idref" href="Grandpa.Votes.html#Votes"><span class="id" title="inductive">Votes</span></a> <a class="idref" href="Grandpa.Votes.html#voters:177"><span class="id" title="variable">voters</span></a>)<br/>
&nbsp;&nbsp;: <a class="idref" href="Grandpa.Votes.html#Votes"><span class="id" title="inductive">Votes</span></a> <a class="idref" href="Grandpa.Votes.html#voters:177"><span class="id" title="variable">voters</span></a>.<br/>
<span class="id" title="var">Admitted</span>.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <a id="difference" class="idref" href="#difference"><span class="id" title="definition">difference</span></a>  <br/>
&nbsp;&nbsp;{<a id="voters:180" class="idref" href="#voters:180"><span class="id" title="binder">voters</span></a>:<a class="idref" href="Grandpa.Votes.html#Voters"><span class="id" title="record">Voters</span></a>}<br/>
&nbsp;&nbsp;(<a id="S:181" class="idref" href="#S:181"><span class="id" title="binder">S</span></a> : <a class="idref" href="Grandpa.Votes.html#Votes"><span class="id" title="inductive">Votes</span></a> <a class="idref" href="Grandpa.Votes.html#voters:180"><span class="id" title="variable">voters</span></a>)<br/>
&nbsp;&nbsp;(<a id="T:182" class="idref" href="#T:182"><span class="id" title="binder">T</span></a> : <a class="idref" href="Grandpa.Votes.html#Votes"><span class="id" title="inductive">Votes</span></a> <a class="idref" href="Grandpa.Votes.html#voters:180"><span class="id" title="variable">voters</span></a>)<br/>
&nbsp;&nbsp;: <a class="idref" href="Grandpa.Votes.html#Votes"><span class="id" title="inductive">Votes</span></a> <a class="idref" href="Grandpa.Votes.html#voters:180"><span class="id" title="variable">voters</span></a>.<br/>
<span class="id" title="var">Admitted</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a id="is_votes_subset_transitive" class="idref" href="#is_votes_subset_transitive"><span class="id" title="lemma">is_votes_subset_transitive</span></a>  <br/>
&nbsp;&nbsp;{<a id="voters:183" class="idref" href="#voters:183"><span class="id" title="binder">voters</span></a>:<a class="idref" href="Grandpa.Votes.html#Voters"><span class="id" title="record">Voters</span></a>}<br/>
&nbsp;&nbsp;(<a id="S1:184" class="idref" href="#S1:184"><span class="id" title="binder">S1</span></a> <a id="S2:185" class="idref" href="#S2:185"><span class="id" title="binder">S2</span></a> <a id="S3:186" class="idref" href="#S3:186"><span class="id" title="binder">S3</span></a> : <a class="idref" href="Grandpa.Votes.html#Votes"><span class="id" title="inductive">Votes</span></a> <a class="idref" href="Grandpa.Votes.html#voters:183"><span class="id" title="variable">voters</span></a>)<br/>
&nbsp;&nbsp;(<a id="s1_s2:187" class="idref" href="#s1_s2:187"><span class="id" title="binder">s1_s2</span></a> : <a class="idref" href="Grandpa.Votes.html#VotesIsSubset"><span class="id" title="definition">VotesIsSubset</span></a> <a class="idref" href="Grandpa.Votes.html#S1:184"><span class="id" title="variable">S1</span></a> <a class="idref" href="Grandpa.Votes.html#S2:185"><span class="id" title="variable">S2</span></a>)<br/>
&nbsp;&nbsp;(<a id="s2_s3:188" class="idref" href="#s2_s3:188"><span class="id" title="binder">s2_s3</span></a> : <a class="idref" href="Grandpa.Votes.html#VotesIsSubset"><span class="id" title="definition">VotesIsSubset</span></a> <a class="idref" href="Grandpa.Votes.html#S2:185"><span class="id" title="variable">S2</span></a> <a class="idref" href="Grandpa.Votes.html#S3:186"><span class="id" title="variable">S3</span></a>)<br/>
&nbsp;&nbsp;: <a class="idref" href="Grandpa.Votes.html#VotesIsSubset"><span class="id" title="definition">VotesIsSubset</span></a> <a class="idref" href="Grandpa.Votes.html#S1:184"><span class="id" title="variable">S1</span></a> <a class="idref" href="Grandpa.Votes.html#S3:186"><span class="id" title="variable">S3</span></a>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a id="superset_has_subset_majority_blocks" class="idref" href="#superset_has_subset_majority_blocks"><span class="id" title="lemma">superset_has_subset_majority_blocks</span></a> <br/>
&nbsp;&nbsp;{<a id="voters:189" class="idref" href="#voters:189"><span class="id" title="binder">voters</span></a>:<a class="idref" href="Grandpa.Votes.html#Voters"><span class="id" title="record">Voters</span></a>}<br/>
&nbsp;&nbsp;(<a id="S:190" class="idref" href="#S:190"><span class="id" title="binder">S</span></a> : <a class="idref" href="Grandpa.Votes.html#Votes"><span class="id" title="inductive">Votes</span></a> <a class="idref" href="Grandpa.Votes.html#voters:189"><span class="id" title="variable">voters</span></a>) <br/>
&nbsp;&nbsp;(<a id="T:191" class="idref" href="#T:191"><span class="id" title="binder">T</span></a> : <a class="idref" href="Grandpa.Votes.html#Votes"><span class="id" title="inductive">Votes</span></a> <a class="idref" href="Grandpa.Votes.html#voters:189"><span class="id" title="variable">voters</span></a>) <br/>
&nbsp;&nbsp;(<a id="safe_proof:192" class="idref" href="#safe_proof:192"><span class="id" title="binder">safe_proof</span></a>: <a class="idref" href="Grandpa.Votes.html#is_safe"><span class="id" title="definition">is_safe</span></a> <a class="idref" href="Grandpa.Votes.html#T:191"><span class="id" title="variable">T</span></a>  <a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a><a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Init.Datatypes.html#true"><span class="id" title="constructor">true</span></a>)<br/>
&nbsp;&nbsp;(<a id="is_subset:193" class="idref" href="#is_subset:193"><span class="id" title="binder">is_subset</span></a>: <a class="idref" href="Grandpa.Votes.html#VotesIsSubset"><span class="id" title="definition">VotesIsSubset</span></a> <a class="idref" href="Grandpa.Votes.html#S:190"><span class="id" title="variable">S</span></a> <a class="idref" href="Grandpa.Votes.html#T:191"><span class="id" title="variable">T</span></a>)<br/>
&nbsp;&nbsp;: <span class="id" title="keyword">∀</span> <a id="anyblock:194" class="idref" href="#anyblock:194"><span class="id" title="binder">anyblock</span></a> <a id="anyblock_votes:195" class="idref" href="#anyblock_votes:195"><span class="id" title="binder">anyblock_votes</span></a>, <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Lists.List.html#In"><span class="id" title="definition">List.In</span></a> <a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="Grandpa.Votes.html#anyblock:194"><span class="id" title="variable">anyblock</span></a><a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a><a class="idref" href="Grandpa.Votes.html#anyblock_votes:195"><span class="id" title="variable">anyblock_votes</span></a><a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> (<a class="idref" href="Grandpa.Votes.html#get_supermajority_blocks"><span class="id" title="definition">get_supermajority_blocks</span></a>  <a class="idref" href="Grandpa.Votes.html#S:190"><span class="id" title="variable">S</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Init.Specif.html#e6a434cae860987d1c5f61b342cc9e57"><span class="id" title="notation">{</span></a><a id="anyblock_votes_in_t:196" class="idref" href="#anyblock_votes_in_t:196"><span class="id" title="binder">anyblock_votes_in_t</span></a> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Init.Specif.html#e6a434cae860987d1c5f61b342cc9e57"><span class="id" title="notation">&amp;</span></a> <a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Lists.List.html#In"><span class="id" title="definition">List.In</span></a> <a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="Grandpa.Votes.html#anyblock:194"><span class="id" title="variable">anyblock</span></a><a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a><a class="idref" href="Grandpa.Votes.html#anyblock_votes_in_t:196"><span class="id" title="variable">anyblock_votes_in_t</span></a><a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> (<a class="idref" href="Grandpa.Votes.html#get_supermajority_blocks"><span class="id" title="definition">get_supermajority_blocks</span></a>  <a class="idref" href="Grandpa.Votes.html#T:191"><span class="id" title="variable">T</span></a>)<a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Init.Specif.html#e6a434cae860987d1c5f61b342cc9e57"><span class="id" title="notation">}</span></a>.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <a id="has_supermajority" class="idref" href="#has_supermajority"><span class="id" title="definition">has_supermajority</span></a> <br/>
&nbsp;&nbsp;{<a id="voters:197" class="idref" href="#voters:197"><span class="id" title="binder">voters</span></a>:<a class="idref" href="Grandpa.Votes.html#Voters"><span class="id" title="record">Voters</span></a>}<br/>
&nbsp;&nbsp;(<a id="S:198" class="idref" href="#S:198"><span class="id" title="binder">S</span></a> : <a class="idref" href="Grandpa.Votes.html#Votes"><span class="id" title="inductive">Votes</span></a> <a class="idref" href="Grandpa.Votes.html#voters:197"><span class="id" title="variable">voters</span></a>)<br/>
&nbsp;&nbsp;: <a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Init.Datatypes.html#bool"><span class="id" title="inductive">bool</span></a><br/>
&nbsp;&nbsp;:= <br/>
&nbsp;&nbsp;0 <a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Init.Nat.html#6b7621b45fff0af5e2b2cbb2bc2d4e1d"><span class="id" title="notation">&lt;?</span></a> <a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Init.Datatypes.html#length"><span class="id" title="definition">length</span></a> (<a class="idref" href="Grandpa.Votes.html#get_supermajority_blocks"><span class="id" title="definition">get_supermajority_blocks</span></a>  <a class="idref" href="Grandpa.Votes.html#S:198"><span class="id" title="variable">S</span></a>) .<br/>

<br/>
<span class="id" title="keyword">Close</span> <span class="id" title="keyword">Scope</span> <span class="id" title="var">blocks_scope</span>.<br/>
</div>
</div>

<div id="footer">
<hr/><a href="index.html">Index</a><hr/>This page has been generated by <a href="http://coq.inria.fr/">coqdoc</a>
</div>

</div>

</body>
</html>