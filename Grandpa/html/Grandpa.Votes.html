<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link href="coqdoc.css" rel="stylesheet" type="text/css" />
<title>Grandpa.Votes</title>
</head>

<body>

<div id="page">

<div id="header">
</div>

<div id="main">

<h1 class="libtitle">Library Grandpa.Votes</h1>

<div class="code">
<span class="id" title="keyword">Require</span> <a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Lists.List.html#"><span class="id" title="library">List</span></a>.<br/>
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span>  <a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Nat.html#"><span class="id" title="library">Nat</span></a>.<br/>
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Program.Equality.html#"><span class="id" title="library">Coq.Program.Equality</span></a>.<br/>
<span class="id" title="keyword">Require</span> <a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Program.Wf.html#"><span class="id" title="library">Coq.Program.Wf</span></a>.<br/>
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.micromega.Lia.html#"><span class="id" title="library">Lia</span></a>.<br/>

<br/>
<span class="id" title="keyword">Require</span> <a class="idref" href="Grandpa.Dictionary.html#"><span class="id" title="library">Dictionary</span></a>.<br/>
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <a class="idref" href="Grandpa.Blocks.html#"><span class="id" title="library">Blocks</span></a>.<br/>
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <a class="idref" href="Grandpa.ListFacts.html#"><span class="id" title="library">ListFacts</span></a>.<br/>

<br/>
<span class="id" title="keyword">Open</span> <span class="id" title="keyword">Scope</span> <span class="id" title="var">bool</span>.<br/>
<span class="id" title="keyword">Open</span> <span class="id" title="keyword">Scope</span> <span class="id" title="var">blocks_scope</span>.<br/>

<br/>
</div>

<div class="doc">
<a id="lab6"></a><h1 class="section">Voters</h1>


<div class="paragraph"> </div>


<div class="paragraph"> </div>

Some requirements about a type that can represent voters:
<ul class="doclist">
<li> It must have infinite inhabitants.

</li>
<li> It must have decidable equality.

</li>
</ul>
This means, we can have any number of voters and we can 
distinguish between them. 
For this reason we choose to use naturals.

</div>
<div class="code">
<span class="id" title="keyword">Definition</span> <a id="Voter" class="idref" href="#Voter"><span class="id" title="definition">Voter</span></a> : <span class="id" title="keyword">Type</span> := <a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a>.<br/>

<br/>
</div>

<div class="doc">
  The bizantiners_number parameter isn't used 
   in the definition of the type, we 
   leave it open to any assumption. 
   Previously we had a constraint but 
   it wasn't useful and only complicate things.

<div class="paragraph"> </div>

  Ideally a Voters must be proper set, but we 
   don't want to complicate much the types.
  We may add a constraint in the constructor 
   to ensure that no voter is repeated in the 
   list, but it may complicate construction of 
   voters.

<div class="paragraph"> </div>

  Why not <span class="inlinecode"><span class="id" title="keyword">Definition</span></span> <span class="inlinecode"><a class="idref" href="Grandpa.Votes.html#Voters"><span class="id" title="inductive">Voters</span></a></span> <span class="inlinecode"><a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a></span> <span class="inlinecode">:=</span> <span class="inlinecode"><a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Datatypes.html#list"><span class="id" title="inductive">list</span></a></span> <span class="inlinecode"><a class="idref" href="Grandpa.Votes.html#Voter"><span class="id" title="definition">Voter</span></a></span>?
  this would be equivalent to <span class="inlinecode"><a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Datatypes.html#list"><span class="id" title="inductive">list</span></a></span> <span class="inlinecode"><a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a></span>. 
   We are going to work with multiple things 
   that are equivalent to <span class="inlinecode"><a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Datatypes.html#list"><span class="id" title="inductive">list</span></a></span> <span class="inlinecode"><a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a></span>. This 
   means we should use the newtype pattern here.

<div class="paragraph"> </div>

  Note: Coq doesn't have a newtype syntax as 
   in Haskell, so we should use a variant.

</div>
<div class="code">

<br/>
<span class="id" title="keyword">Variant</span> <a id="Unit" class="idref" href="#Unit"><span class="id" title="inductive">Unit</span></a> := | <a id="UnitC" class="idref" href="#UnitC"><span class="id" title="constructor">UnitC</span></a>.<br/>

<br/>
<span class="id" title="keyword">Variant</span> <a id="Voters" class="idref" href="#Voters"><span class="id" title="inductive">Voters</span></a> (<a id="bizantiners_number:3" class="idref" href="#bizantiners_number:3"><span class="id" title="binder">bizantiners_number</span></a>:<a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a>) : <span class="id" title="keyword">Type</span> <br/>
&nbsp;&nbsp;:= <br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a id="VotersC" class="idref" href="#VotersC"><span class="id" title="constructor">VotersC</span></a> (<a id="voters:6" class="idref" href="#voters:6"><span class="id" title="binder">voters</span></a>: <a class="idref" href="Grandpa.Dictionary.html#Dictionary"><span class="id" title="inductive">Dictionary.Dictionary</span></a> <a class="idref" href="Grandpa.Votes.html#Voter"><span class="id" title="definition">Voter</span></a> <a class="idref" href="Grandpa.Votes.html#Unit"><span class="id" title="inductive">Unit</span></a>) <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <a class="idref" href="Grandpa.Votes.html#Voters:4"><span class="id" title="inductive">Voters</span></a>  <a class="idref" href="Grandpa.Votes.html#bizantiners_number:3"><span class="id" title="variable">bizantiners_number</span></a> .<br/>

<br/>
<span class="id" title="keyword">Definition</span> <a id="voters_to_list" class="idref" href="#voters_to_list"><span class="id" title="definition">voters_to_list</span></a> {<a id="bizantiners_number:7" class="idref" href="#bizantiners_number:7"><span class="id" title="binder">bizantiners_number</span></a>} (<a id="voters:8" class="idref" href="#voters:8"><span class="id" title="binder">voters</span></a>:<a class="idref" href="Grandpa.Votes.html#Voters"><span class="id" title="inductive">Voters</span></a> <a class="idref" href="Grandpa.Votes.html#bizantiners_number:7"><span class="id" title="variable">bizantiners_number</span></a>)<br/>
&nbsp;&nbsp;:= <br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="Grandpa.Votes.html#voters:8"><span class="id" title="variable">voters</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| <a class="idref" href="Grandpa.Votes.html#VotersC"><span class="id" title="constructor">VotersC</span></a> <span class="id" title="var">_</span> <span class="id" title="var">d</span> ⇒ <a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Lists.List.html#map"><span class="id" title="definition">List.map</span></a> <a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Datatypes.html#fst"><span class="id" title="definition">fst</span></a> (<a class="idref" href="Grandpa.Dictionary.html#to_list"><span class="id" title="definition">Dictionary.to_list</span></a> <span class="id" title="var">d</span>)<br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <a id="voters_length" class="idref" href="#voters_length"><span class="id" title="definition">voters_length</span></a> {<a id="bizantiners_number:10" class="idref" href="#bizantiners_number:10"><span class="id" title="binder">bizantiners_number</span></a>} (<a id="voters:11" class="idref" href="#voters:11"><span class="id" title="binder">voters</span></a>:<a class="idref" href="Grandpa.Votes.html#Voters"><span class="id" title="inductive">Voters</span></a> <a class="idref" href="Grandpa.Votes.html#bizantiners_number:10"><span class="id" title="variable">bizantiners_number</span></a>)<br/>
&nbsp;&nbsp;:= <br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Datatypes.html#length"><span class="id" title="definition">length</span></a> (<a class="idref" href="Grandpa.Votes.html#voters_to_list"><span class="id" title="definition">voters_to_list</span></a> <a class="idref" href="Grandpa.Votes.html#voters:11"><span class="id" title="variable">voters</span></a>).<br/>

<br/>
<span class="id" title="keyword">Definition</span> <a id="voters_from_list" class="idref" href="#voters_from_list"><span class="id" title="definition">voters_from_list</span></a> (<a id="bizantiners_number:12" class="idref" href="#bizantiners_number:12"><span class="id" title="binder">bizantiners_number</span></a>:<a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a>) (<a id="voters:13" class="idref" href="#voters:13"><span class="id" title="binder">voters</span></a>:<a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Datatypes.html#list"><span class="id" title="inductive">list</span></a> <a class="idref" href="Grandpa.Votes.html#Voter"><span class="id" title="definition">Voter</span></a>)<br/>
&nbsp;&nbsp;: <a class="idref" href="Grandpa.Votes.html#Voters"><span class="id" title="inductive">Voters</span></a> <a class="idref" href="Grandpa.Votes.html#bizantiners_number:12"><span class="id" title="variable">bizantiners_number</span></a><br/>
&nbsp;&nbsp;:=<br/>
&nbsp;&nbsp;<a class="idref" href="Grandpa.Votes.html#VotersC"><span class="id" title="constructor">VotersC</span></a> <a class="idref" href="Grandpa.Votes.html#bizantiners_number:12"><span class="id" title="variable">bizantiners_number</span></a> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Grandpa.Dictionary.html#from_list"><span class="id" title="definition">Dictionary.from_list</span></a> <a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Nat.html#eqb"><span class="id" title="definition">Nat.eqb</span></a> (<a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Lists.List.html#map"><span class="id" title="definition">List.map</span></a> (<span class="id" title="keyword">fun</span> <a id="n:14" class="idref" href="#n:14"><span class="id" title="binder">n</span></a> ⇒ <a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="Grandpa.Votes.html#n:14"><span class="id" title="variable">n</span></a><a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a><a class="idref" href="Grandpa.Votes.html#UnitC"><span class="id" title="constructor">UnitC</span></a><a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a>) <a class="idref" href="Grandpa.Votes.html#voters:13"><span class="id" title="variable">voters</span></a>)).<br/>

<br/>
<span class="id" title="keyword">Definition</span> <a id="voters_eqb" class="idref" href="#voters_eqb"><span class="id" title="definition">voters_eqb</span></a> {<a id="bizantiners_number:15" class="idref" href="#bizantiners_number:15"><span class="id" title="binder">bizantiners_number</span></a>} <br/>
&nbsp;&nbsp;(<a id="v1:16" class="idref" href="#v1:16"><span class="id" title="binder">v1</span></a> <a id="v2:17" class="idref" href="#v2:17"><span class="id" title="binder">v2</span></a>:<a class="idref" href="Grandpa.Votes.html#Voters"><span class="id" title="inductive">Voters</span></a> <a class="idref" href="Grandpa.Votes.html#bizantiners_number:15"><span class="id" title="variable">bizantiners_number</span></a>)<br/>
&nbsp;&nbsp;: <a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Datatypes.html#bool"><span class="id" title="inductive">bool</span></a><br/>
&nbsp;&nbsp;:= <a class="idref" href="Grandpa.ListFacts.html#list_beq"><span class="id" title="definition">list_beq</span></a> <a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a> <a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Nat.html#eqb"><span class="id" title="definition">Nat.eqb</span></a> (<a class="idref" href="Grandpa.Votes.html#voters_to_list"><span class="id" title="definition">voters_to_list</span></a> <a class="idref" href="Grandpa.Votes.html#v1:16"><span class="id" title="variable">v1</span></a>) (<a class="idref" href="Grandpa.Votes.html#voters_to_list"><span class="id" title="definition">voters_to_list</span></a> <a class="idref" href="Grandpa.Votes.html#v2:17"><span class="id" title="variable">v2</span></a>).<br/>

<br/>
<span class="id" title="keyword">Definition</span> <a id="in_Voters" class="idref" href="#in_Voters"><span class="id" title="definition">in_Voters</span></a> {<a id="bizantiners_number:18" class="idref" href="#bizantiners_number:18"><span class="id" title="binder">bizantiners_number</span></a>} <br/>
&nbsp;&nbsp;(<a id="voter:19" class="idref" href="#voter:19"><span class="id" title="binder">voter</span></a> : <a class="idref" href="Grandpa.Votes.html#Voter"><span class="id" title="definition">Voter</span></a>) (<a id="voters:20" class="idref" href="#voters:20"><span class="id" title="binder">voters</span></a>:<a class="idref" href="Grandpa.Votes.html#Voters"><span class="id" title="inductive">Voters</span></a> <a class="idref" href="Grandpa.Votes.html#bizantiners_number:18"><span class="id" title="variable">bizantiners_number</span></a>) <br/>
&nbsp;&nbsp;:=<br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Lists.List.html#In"><span class="id" title="definition">List.In</span></a> <a class="idref" href="Grandpa.Votes.html#voter:19"><span class="id" title="variable">voter</span></a> (<a class="idref" href="Grandpa.Votes.html#voters_to_list"><span class="id" title="definition">voters_to_list</span></a> <a class="idref" href="Grandpa.Votes.html#voters:20"><span class="id" title="variable">voters</span></a>).<br/>

<br/>
<span class="id" title="keyword">Definition</span> <a id="in_Voters_bool" class="idref" href="#in_Voters_bool"><span class="id" title="definition">in_Voters_bool</span></a> {<a id="bizantiners_number:21" class="idref" href="#bizantiners_number:21"><span class="id" title="binder">bizantiners_number</span></a>} <br/>
&nbsp;&nbsp;(<a id="voter:22" class="idref" href="#voter:22"><span class="id" title="binder">voter</span></a> : <a class="idref" href="Grandpa.Votes.html#Voter"><span class="id" title="definition">Voter</span></a>) (<a id="voters:23" class="idref" href="#voters:23"><span class="id" title="binder">voters</span></a>:<a class="idref" href="Grandpa.Votes.html#Voters"><span class="id" title="inductive">Voters</span></a> <a class="idref" href="Grandpa.Votes.html#bizantiners_number:21"><span class="id" title="variable">bizantiners_number</span></a>) <br/>
&nbsp;&nbsp;:= 0 <a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Nat.html#6b7621b45fff0af5e2b2cbb2bc2d4e1d"><span class="id" title="notation">&lt;?</span></a> <a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Nat.html#6b7621b45fff0af5e2b2cbb2bc2d4e1d"><span class="id" title="notation">(</span></a><a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Lists.List.html#count_occ"><span class="id" title="definition">List.count_occ</span></a> <a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Arith.PeanoNat.html#Nat.eq_dec"><span class="id" title="lemma">PeanoNat.Nat.eq_dec</span></a> (<a class="idref" href="Grandpa.Votes.html#voters_to_list"><span class="id" title="definition">voters_to_list</span></a> <a class="idref" href="Grandpa.Votes.html#voters:23"><span class="id" title="variable">voters</span></a>) <a class="idref" href="Grandpa.Votes.html#voter:22"><span class="id" title="variable">voter</span></a><a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Nat.html#6b7621b45fff0af5e2b2cbb2bc2d4e1d"><span class="id" title="notation">)</span></a>.<br/>

<br/>
</div>

<div class="doc">
<a id="lab7"></a><h1 class="section">Votes</h1>


<div class="paragraph"> </div>

<a id="lab8"></a><h2 class="section">Vote</h2>


<div class="paragraph"> </div>

From the paper:

<div class="paragraph"> </div>

<pre>
  A vote is a block hash, together with some metadata such as round number 
  and the type of vote, such as prevote or precommit, all signed with a 
  voter’s private key
</pre>

<div class="paragraph"> </div>

Following the same approach as with the Blocks, we choose to replace the 
block hash with the real block. This makes proofs easier.

<div class="paragraph"> </div>

Round number would be added later when we add Time and Rounds, this 
  simplifies the work with a Vote.

<div class="paragraph"> </div>

We don't have types for votes, instead when needed, we distinguish
them by maintaining two different set of votes, one for precommits 
and other for previews.

<div class="paragraph"> </div>

However, we want to tie a Vote with a particular set of Voters 
and to ensure that the Vote is coherent.

<div class="paragraph"> </div>

Additionally a Vote depends on the <span class="inlinecode"><a class="idref" href="Grandpa.Votes.html#Some.last_block"><span class="id" title="variable">last_block</span></a></span>, this is 
we are only interested in the blocks that are children of 
<span class="inlinecode"><a class="idref" href="Grandpa.Votes.html#Some.last_block"><span class="id" title="variable">last_block</span></a></span>. 

<div class="paragraph"> </div>

This means that <span class="inlinecode"><a class="idref" href="Grandpa.Votes.html#Some.last_block"><span class="id" title="variable">last_block</span></a></span> can be often interpreter as the 
<i>last_block_finalized</i>.
However this may not be the case in particular situations.

</div>
<div class="code">

<br/>
<span class="id" title="keyword">Variant</span> <a id="Vote" class="idref" href="#Vote"><span class="id" title="inductive">Vote</span></a> {<a id="bizantiners_number:24" class="idref" href="#bizantiners_number:24"><span class="id" title="binder">bizantiners_number</span></a> <a id="last_block_number:25" class="idref" href="#last_block_number:25"><span class="id" title="binder">last_block_number</span></a>}<br/>
&nbsp;&nbsp;(<a id="voters:26" class="idref" href="#voters:26"><span class="id" title="binder">voters</span></a>: <a class="idref" href="Grandpa.Votes.html#Voters"><span class="id" title="inductive">Voters</span></a> <a class="idref" href="Grandpa.Votes.html#bizantiners_number:24"><span class="id" title="variable">bizantiners_number</span></a> )<br/>
&nbsp;&nbsp;(<a id="original_chain:27" class="idref" href="#original_chain:27"><span class="id" title="binder">original_chain</span></a>:<a class="idref" href="Grandpa.Blocks.html#Block"><span class="id" title="inductive">Block</span></a> <a class="idref" href="Grandpa.Votes.html#last_block_number:25"><span class="id" title="variable">last_block_number</span></a>)<br/>
&nbsp;&nbsp;:<span class="id" title="keyword">Type</span> <br/>
&nbsp;&nbsp;:= <br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a id="VoteC" class="idref" href="#VoteC"><span class="id" title="constructor">VoteC</span></a> {<a id="m:30" class="idref" href="#m:30"><span class="id" title="binder">m</span></a>}  (<a id="voter:31" class="idref" href="#voter:31"><span class="id" title="binder">voter</span></a> : <a class="idref" href="Grandpa.Votes.html#Voter"><span class="id" title="definition">Voter</span></a>) <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a id="is_voter:32" class="idref" href="#is_voter:32"><span class="id" title="binder">is_voter</span></a>: <a class="idref" href="Grandpa.Votes.html#in_Voters"><span class="id" title="definition">in_Voters</span></a> <a class="idref" href="Grandpa.Votes.html#voter:31"><span class="id" title="variable">voter</span></a> <a class="idref" href="Grandpa.Votes.html#voters:26"><span class="id" title="variable">voters</span></a> ) <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a id="block:33" class="idref" href="#block:33"><span class="id" title="binder">block</span></a>: <a class="idref" href="Grandpa.Blocks.html#Block"><span class="id" title="inductive">Block</span></a> <a class="idref" href="Grandpa.Votes.html#m:30"><span class="id" title="variable">m</span></a>) (<a id="is_prefix:34" class="idref" href="#is_prefix:34"><span class="id" title="binder">is_prefix</span></a>: <a class="idref" href="Grandpa.Votes.html#original_chain:27"><span class="id" title="variable">original_chain</span></a> <a class="idref" href="Grandpa.Blocks.html#504547c1b15cb9ae8a3c384c85ac7d6e"><span class="id" title="notation">≤</span></a> <a class="idref" href="Grandpa.Votes.html#block:33"><span class="id" title="variable">block</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <a class="idref" href="Grandpa.Votes.html#Vote:28"><span class="id" title="inductive">Vote</span></a> <a class="idref" href="Grandpa.Votes.html#voters:26"><span class="id" title="variable">voters</span></a> <a class="idref" href="Grandpa.Votes.html#original_chain:27"><span class="id" title="variable">original_chain</span></a>.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <a id="vote_to_voter" class="idref" href="#vote_to_voter"><span class="id" title="definition">vote_to_voter</span></a> {<a id="bizantiners_number:35" class="idref" href="#bizantiners_number:35"><span class="id" title="binder">bizantiners_number</span></a> <a id="last_block_number:36" class="idref" href="#last_block_number:36"><span class="id" title="binder">last_block_number</span></a>}<br/>
&nbsp;&nbsp;{<a id="voters:37" class="idref" href="#voters:37"><span class="id" title="binder">voters</span></a>: <a class="idref" href="Grandpa.Votes.html#Voters"><span class="id" title="inductive">Voters</span></a> <a class="idref" href="Grandpa.Votes.html#bizantiners_number:35"><span class="id" title="variable">bizantiners_number</span></a>}<br/>
&nbsp;&nbsp;{<a id="original_chain:38" class="idref" href="#original_chain:38"><span class="id" title="binder">original_chain</span></a>:<a class="idref" href="Grandpa.Blocks.html#Block"><span class="id" title="inductive">Block</span></a> <a class="idref" href="Grandpa.Votes.html#last_block_number:36"><span class="id" title="variable">last_block_number</span></a>}<br/>
&nbsp;&nbsp;(<a id="vote:39" class="idref" href="#vote:39"><span class="id" title="binder">vote</span></a>: <a class="idref" href="Grandpa.Votes.html#Vote"><span class="id" title="inductive">Vote</span></a> <a class="idref" href="Grandpa.Votes.html#voters:37"><span class="id" title="variable">voters</span></a> <a class="idref" href="Grandpa.Votes.html#original_chain:38"><span class="id" title="variable">original_chain</span></a>)<br/>
&nbsp;&nbsp;: <a class="idref" href="Grandpa.Votes.html#Voter"><span class="id" title="definition">Voter</span></a><br/>
&nbsp;&nbsp;:=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="Grandpa.Votes.html#vote:39"><span class="id" title="variable">vote</span></a> <span class="id" title="keyword">with</span> <br/>
&nbsp;&nbsp;| <a class="idref" href="Grandpa.Votes.html#VoteC"><span class="id" title="constructor">VoteC</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">voter</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> ⇒ <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">voter</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <a id="vote_to_pair" class="idref" href="#vote_to_pair"><span class="id" title="definition">vote_to_pair</span></a>  {<a id="bizantiners_number:41" class="idref" href="#bizantiners_number:41"><span class="id" title="binder">bizantiners_number</span></a> <a id="last_block_number:42" class="idref" href="#last_block_number:42"><span class="id" title="binder">last_block_number</span></a>}<br/>
&nbsp;&nbsp;{<a id="voters:43" class="idref" href="#voters:43"><span class="id" title="binder">voters</span></a>: <a class="idref" href="Grandpa.Votes.html#Voters"><span class="id" title="inductive">Voters</span></a> <a class="idref" href="Grandpa.Votes.html#bizantiners_number:41"><span class="id" title="variable">bizantiners_number</span></a>}<br/>
&nbsp;&nbsp;{<a id="original_chain:44" class="idref" href="#original_chain:44"><span class="id" title="binder">original_chain</span></a>:<a class="idref" href="Grandpa.Blocks.html#Block"><span class="id" title="inductive">Block</span></a> <a class="idref" href="Grandpa.Votes.html#last_block_number:42"><span class="id" title="variable">last_block_number</span></a>}<br/>
&nbsp;&nbsp;(<a id="vote:45" class="idref" href="#vote:45"><span class="id" title="binder">vote</span></a>: <a class="idref" href="Grandpa.Votes.html#Vote"><span class="id" title="inductive">Vote</span></a> <a class="idref" href="Grandpa.Votes.html#voters:43"><span class="id" title="variable">voters</span></a> <a class="idref" href="Grandpa.Votes.html#original_chain:44"><span class="id" title="variable">original_chain</span></a>)<br/>
&nbsp;&nbsp;: (<a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a> <a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Datatypes.html#11c698c8685bb8ab1cf725545c085ac4"><span class="id" title="notation">×</span></a> <a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Datatypes.html#11c698c8685bb8ab1cf725545c085ac4"><span class="id" title="notation">(</span></a><a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Specif.html#sigT"><span class="id" title="inductive">sigT</span></a> (<span class="id" title="keyword">fun</span> <a id="n:46" class="idref" href="#n:46"><span class="id" title="binder">n</span></a> ⇒ <a class="idref" href="Grandpa.Blocks.html#Block"><span class="id" title="inductive">Block</span></a> <a class="idref" href="Grandpa.Votes.html#n:46"><span class="id" title="variable">n</span></a>)<a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Datatypes.html#11c698c8685bb8ab1cf725545c085ac4"><span class="id" title="notation">)</span></a>)<br/>
&nbsp;&nbsp;:=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="Grandpa.Votes.html#vote:45"><span class="id" title="variable">vote</span></a> <span class="id" title="keyword">with</span> <br/>
&nbsp;&nbsp;| <a class="idref" href="Grandpa.Votes.html#VoteC"><span class="id" title="constructor">VoteC</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">voter</span> <span class="id" title="var">_</span> <span class="id" title="var">block</span> <span class="id" title="var">_</span> ⇒ <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><span class="id" title="var">voter</span> <a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Specif.html#existT"><span class="id" title="constructor">existT</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">block</span><a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <a id="vote_to_block" class="idref" href="#vote_to_block"><span class="id" title="definition">vote_to_block</span></a>  {<a id="bizantiners_number:48" class="idref" href="#bizantiners_number:48"><span class="id" title="binder">bizantiners_number</span></a> <a id="last_block_number:49" class="idref" href="#last_block_number:49"><span class="id" title="binder">last_block_number</span></a>}<br/>
&nbsp;&nbsp;{<a id="voters:50" class="idref" href="#voters:50"><span class="id" title="binder">voters</span></a>: <a class="idref" href="Grandpa.Votes.html#Voters"><span class="id" title="inductive">Voters</span></a> <a class="idref" href="Grandpa.Votes.html#bizantiners_number:48"><span class="id" title="variable">bizantiners_number</span></a>}<br/>
&nbsp;&nbsp;{<a id="original_chain:51" class="idref" href="#original_chain:51"><span class="id" title="binder">original_chain</span></a>:<a class="idref" href="Grandpa.Blocks.html#Block"><span class="id" title="inductive">Block</span></a> <a class="idref" href="Grandpa.Votes.html#last_block_number:49"><span class="id" title="variable">last_block_number</span></a>}<br/>
&nbsp;&nbsp;(<a id="vote:52" class="idref" href="#vote:52"><span class="id" title="binder">vote</span></a>: <a class="idref" href="Grandpa.Votes.html#Vote"><span class="id" title="inductive">Vote</span></a> <a class="idref" href="Grandpa.Votes.html#voters:50"><span class="id" title="variable">voters</span></a> <a class="idref" href="Grandpa.Votes.html#original_chain:51"><span class="id" title="variable">original_chain</span></a>)<br/>
&nbsp;&nbsp;: (<a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Specif.html#sigT"><span class="id" title="inductive">sigT</span></a> (<span class="id" title="keyword">fun</span> <a id="n:53" class="idref" href="#n:53"><span class="id" title="binder">n</span></a> ⇒ <a class="idref" href="Grandpa.Blocks.html#Block"><span class="id" title="inductive">Block</span></a> <a class="idref" href="Grandpa.Votes.html#n:53"><span class="id" title="variable">n</span></a>))<br/>
&nbsp;&nbsp;:=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="Grandpa.Votes.html#vote:52"><span class="id" title="variable">vote</span></a> <span class="id" title="keyword">with</span> <br/>
&nbsp;&nbsp;| <a class="idref" href="Grandpa.Votes.html#VoteC"><span class="id" title="constructor">VoteC</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">voter</span> <span class="id" title="var">_</span> <span class="id" title="var">block</span> <span class="id" title="var">_</span> ⇒ <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Specif.html#existT"><span class="id" title="constructor">existT</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">block</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <a id="vote_eqb" class="idref" href="#vote_eqb"><span class="id" title="definition">vote_eqb</span></a> {<a id="bizantiners_number:55" class="idref" href="#bizantiners_number:55"><span class="id" title="binder">bizantiners_number</span></a> <a id="last_block_number:56" class="idref" href="#last_block_number:56"><span class="id" title="binder">last_block_number</span></a>}<br/>
&nbsp;&nbsp;{<a id="voters:57" class="idref" href="#voters:57"><span class="id" title="binder">voters</span></a>: <a class="idref" href="Grandpa.Votes.html#Voters"><span class="id" title="inductive">Voters</span></a> <a class="idref" href="Grandpa.Votes.html#bizantiners_number:55"><span class="id" title="variable">bizantiners_number</span></a>}<br/>
&nbsp;&nbsp;{<a id="original_chain:58" class="idref" href="#original_chain:58"><span class="id" title="binder">original_chain</span></a>:<a class="idref" href="Grandpa.Blocks.html#Block"><span class="id" title="inductive">Block</span></a> <a class="idref" href="Grandpa.Votes.html#last_block_number:56"><span class="id" title="variable">last_block_number</span></a>}<br/>
&nbsp;&nbsp;(<a id="vote1:59" class="idref" href="#vote1:59"><span class="id" title="binder">vote1</span></a> <a id="vote2:60" class="idref" href="#vote2:60"><span class="id" title="binder">vote2</span></a>: <a class="idref" href="Grandpa.Votes.html#Vote"><span class="id" title="inductive">Vote</span></a> <a class="idref" href="Grandpa.Votes.html#voters:57"><span class="id" title="variable">voters</span></a> <a class="idref" href="Grandpa.Votes.html#original_chain:58"><span class="id" title="variable">original_chain</span></a>)<br/>
&nbsp;&nbsp;: <a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Datatypes.html#bool"><span class="id" title="inductive">bool</span></a><br/>
&nbsp;&nbsp;:=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="Grandpa.Votes.html#vote1:59"><span class="id" title="variable">vote1</span></a>,<a class="idref" href="Grandpa.Votes.html#vote2:60"><span class="id" title="variable">vote2</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| <a class="idref" href="Grandpa.Votes.html#VoteC"><span class="id" title="constructor">VoteC</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">voter1'</span> <span class="id" title="var">_</span> <span class="id" title="var">block1</span> <span class="id" title="var">_</span> , <a class="idref" href="Grandpa.Votes.html#VoteC"><span class="id" title="constructor">VoteC</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">voter2'</span> <span class="id" title="var">_</span> <span class="id" title="var">block2</span> <span class="id" title="var">_</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">voter1'</span> <a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Nat.html#ad2ec4e405f68c46c0a176e3e94ae2e3"><span class="id" title="notation">=?</span></a> <span class="id" title="var">voter2'</span>)%<span class="id" title="var">nat</span> <a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Datatypes.html#::bool_scope:x_'&amp;&amp;'_x"><span class="id" title="notation">&amp;&amp;</span></a> <a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Datatypes.html#::bool_scope:x_'&amp;&amp;'_x"><span class="id" title="notation">(</span></a><span class="id" title="var">block1</span> <a class="idref" href="Grandpa.Blocks.html#0e3637cbd3059518acde0851b17b4840"><span class="id" title="notation">=?</span></a> <span class="id" title="var">block2</span><a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Datatypes.html#::bool_scope:x_'&amp;&amp;'_x"><span class="id" title="notation">)</span></a><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
</div>

<div class="doc">
<a id="lab9"></a><h2 class="section">Votes</h2>

  As with <span class="inlinecode"><a class="idref" href="Grandpa.Votes.html#Voters"><span class="id" title="inductive">Voters</span></a></span>, we choose to use the newtype pattern here.

</div>
<div class="code">
<span class="id" title="keyword">Inductive</span> <a id="Votes" class="idref" href="#Votes"><span class="id" title="definition, inductive"><span id="Votes_rect" class="id"><span id="Votes_ind" class="id"><span id="Votes_rec" class="id"><span id="Votes_sind" class="id">Votes</span></span></span></span></span></a>  {<a id="bizantiners_number:63" class="idref" href="#bizantiners_number:63"><span class="id" title="binder">bizantiners_number</span></a> <a id="last_block_number:64" class="idref" href="#last_block_number:64"><span class="id" title="binder">last_block_number</span></a>}<br/>
&nbsp;&nbsp;(<a id="voters:65" class="idref" href="#voters:65"><span class="id" title="binder">voters</span></a>: <a class="idref" href="Grandpa.Votes.html#Voters"><span class="id" title="inductive">Voters</span></a> <a class="idref" href="Grandpa.Votes.html#bizantiners_number:63"><span class="id" title="variable">bizantiners_number</span></a>) (<a id="last_block:66" class="idref" href="#last_block:66"><span class="id" title="binder">last_block</span></a>:<a class="idref" href="Grandpa.Blocks.html#Block"><span class="id" title="inductive">Block</span></a> <a class="idref" href="Grandpa.Votes.html#last_block_number:64"><span class="id" title="variable">last_block_number</span></a>)<br/>
&nbsp;&nbsp;:<span class="id" title="keyword">Type</span> <br/>
&nbsp;&nbsp;:= <br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a id="VotesC" class="idref" href="#VotesC"><span class="id" title="constructor">VotesC</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a id="votes_list:69" class="idref" href="#votes_list:69"><span class="id" title="binder">votes_list</span></a>:<a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Datatypes.html#list"><span class="id" title="inductive">list</span></a> (<a class="idref" href="Grandpa.Votes.html#Vote"><span class="id" title="inductive">Vote</span></a> <a class="idref" href="Grandpa.Votes.html#voters:65"><span class="id" title="variable">voters</span></a> <a class="idref" href="Grandpa.Votes.html#last_block:66"><span class="id" title="variable">last_block</span></a>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <a class="idref" href="Grandpa.Votes.html#Votes:67"><span class="id" title="inductive">Votes</span></a> <a class="idref" href="Grandpa.Votes.html#voters:65"><span class="id" title="variable">voters</span></a> <a class="idref" href="Grandpa.Votes.html#last_block:66"><span class="id" title="variable">last_block</span></a>.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <a id="votes_to_list" class="idref" href="#votes_to_list"><span class="id" title="definition">votes_to_list</span></a> {<a id="bizantiners_number:70" class="idref" href="#bizantiners_number:70"><span class="id" title="binder">bizantiners_number</span></a> <a id="last_block_number:71" class="idref" href="#last_block_number:71"><span class="id" title="binder">last_block_number</span></a>}<br/>
&nbsp;&nbsp;{<a id="voters:72" class="idref" href="#voters:72"><span class="id" title="binder">voters</span></a>: <a class="idref" href="Grandpa.Votes.html#Voters"><span class="id" title="inductive">Voters</span></a> <a class="idref" href="Grandpa.Votes.html#bizantiners_number:70"><span class="id" title="variable">bizantiners_number</span></a>} {<a id="last_block:73" class="idref" href="#last_block:73"><span class="id" title="binder">last_block</span></a>:<a class="idref" href="Grandpa.Blocks.html#Block"><span class="id" title="inductive">Block</span></a> <a class="idref" href="Grandpa.Votes.html#last_block_number:71"><span class="id" title="variable">last_block_number</span></a>}<br/>
&nbsp;&nbsp;(<a id="votes:74" class="idref" href="#votes:74"><span class="id" title="binder">votes</span></a>: <a class="idref" href="Grandpa.Votes.html#Votes"><span class="id" title="inductive">Votes</span></a> <a class="idref" href="Grandpa.Votes.html#voters:72"><span class="id" title="variable">voters</span></a> <a class="idref" href="Grandpa.Votes.html#last_block:73"><span class="id" title="variable">last_block</span></a>)<br/>
&nbsp;&nbsp;: <a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Datatypes.html#list"><span class="id" title="inductive">list</span></a> (<a class="idref" href="Grandpa.Votes.html#Vote"><span class="id" title="inductive">Vote</span></a> <a class="idref" href="Grandpa.Votes.html#voters:72"><span class="id" title="variable">voters</span></a> <a class="idref" href="Grandpa.Votes.html#last_block:73"><span class="id" title="variable">last_block</span></a>)<br/>
&nbsp;&nbsp;:= <br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="Grandpa.Votes.html#votes:74"><span class="id" title="variable">votes</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| <a class="idref" href="Grandpa.Votes.html#VotesC"><span class="id" title="constructor">VotesC</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">l</span> ⇒ <span class="id" title="var">l</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <a id="votes_to_voters_list" class="idref" href="#votes_to_voters_list"><span class="id" title="definition">votes_to_voters_list</span></a> {<a id="bizantiners_number:76" class="idref" href="#bizantiners_number:76"><span class="id" title="binder">bizantiners_number</span></a> <a id="last_block_number:77" class="idref" href="#last_block_number:77"><span class="id" title="binder">last_block_number</span></a>}<br/>
&nbsp;&nbsp;{<a id="voters:78" class="idref" href="#voters:78"><span class="id" title="binder">voters</span></a>: <a class="idref" href="Grandpa.Votes.html#Voters"><span class="id" title="inductive">Voters</span></a> <a class="idref" href="Grandpa.Votes.html#bizantiners_number:76"><span class="id" title="variable">bizantiners_number</span></a>} {<a id="last_block:79" class="idref" href="#last_block:79"><span class="id" title="binder">last_block</span></a>:<a class="idref" href="Grandpa.Blocks.html#Block"><span class="id" title="inductive">Block</span></a> <a class="idref" href="Grandpa.Votes.html#last_block_number:77"><span class="id" title="variable">last_block_number</span></a>}<br/>
&nbsp;&nbsp;(<a id="votes:80" class="idref" href="#votes:80"><span class="id" title="binder">votes</span></a>: <a class="idref" href="Grandpa.Votes.html#Votes"><span class="id" title="inductive">Votes</span></a> <a class="idref" href="Grandpa.Votes.html#voters:78"><span class="id" title="variable">voters</span></a> <a class="idref" href="Grandpa.Votes.html#last_block:79"><span class="id" title="variable">last_block</span></a>)<br/>
&nbsp;&nbsp;: <a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Datatypes.html#list"><span class="id" title="inductive">list</span></a> <a class="idref" href="Grandpa.Votes.html#Voter"><span class="id" title="definition">Voter</span></a><br/>
&nbsp;&nbsp;:= <a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Lists.List.html#map"><span class="id" title="definition">List.map</span></a> <a class="idref" href="Grandpa.Votes.html#vote_to_voter"><span class="id" title="definition">vote_to_voter</span></a> (<a class="idref" href="Grandpa.Votes.html#votes_to_list"><span class="id" title="definition">votes_to_list</span></a> <a class="idref" href="Grandpa.Votes.html#votes:80"><span class="id" title="variable">votes</span></a>).<br/>

<br/>
<span class="id" title="keyword">Definition</span> <a id="votes_to_pair_list" class="idref" href="#votes_to_pair_list"><span class="id" title="definition">votes_to_pair_list</span></a> {<a id="bizantiners_number:81" class="idref" href="#bizantiners_number:81"><span class="id" title="binder">bizantiners_number</span></a> <a id="last_block_number:82" class="idref" href="#last_block_number:82"><span class="id" title="binder">last_block_number</span></a>}<br/>
&nbsp;&nbsp;{<a id="voters:83" class="idref" href="#voters:83"><span class="id" title="binder">voters</span></a>: <a class="idref" href="Grandpa.Votes.html#Voters"><span class="id" title="inductive">Voters</span></a> <a class="idref" href="Grandpa.Votes.html#bizantiners_number:81"><span class="id" title="variable">bizantiners_number</span></a>} {<a id="last_block:84" class="idref" href="#last_block:84"><span class="id" title="binder">last_block</span></a>:<a class="idref" href="Grandpa.Blocks.html#Block"><span class="id" title="inductive">Block</span></a> <a class="idref" href="Grandpa.Votes.html#last_block_number:82"><span class="id" title="variable">last_block_number</span></a>}<br/>
&nbsp;&nbsp;(<a id="votes:85" class="idref" href="#votes:85"><span class="id" title="binder">votes</span></a>: <a class="idref" href="Grandpa.Votes.html#Votes"><span class="id" title="inductive">Votes</span></a> <a class="idref" href="Grandpa.Votes.html#voters:83"><span class="id" title="variable">voters</span></a> <a class="idref" href="Grandpa.Votes.html#last_block:84"><span class="id" title="variable">last_block</span></a>)<br/>
&nbsp;&nbsp;: <a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Datatypes.html#list"><span class="id" title="inductive">list</span></a> (<a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a> <a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Datatypes.html#11c698c8685bb8ab1cf725545c085ac4"><span class="id" title="notation">×</span></a> <a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Datatypes.html#11c698c8685bb8ab1cf725545c085ac4"><span class="id" title="notation">(</span></a><a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Specif.html#sigT"><span class="id" title="inductive">sigT</span></a> (<span class="id" title="keyword">fun</span> <a id="n:86" class="idref" href="#n:86"><span class="id" title="binder">n</span></a> ⇒ <a class="idref" href="Grandpa.Blocks.html#Block"><span class="id" title="inductive">Block</span></a> <a class="idref" href="Grandpa.Votes.html#n:86"><span class="id" title="variable">n</span></a>)<a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Datatypes.html#11c698c8685bb8ab1cf725545c085ac4"><span class="id" title="notation">)</span></a>)<br/>
&nbsp;&nbsp;:= <a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Lists.List.html#map"><span class="id" title="definition">List.map</span></a> <a class="idref" href="Grandpa.Votes.html#vote_to_pair"><span class="id" title="definition">vote_to_pair</span></a> (<a class="idref" href="Grandpa.Votes.html#votes_to_list"><span class="id" title="definition">votes_to_list</span></a> <a class="idref" href="Grandpa.Votes.html#votes:85"><span class="id" title="variable">votes</span></a>).<br/>

<br/>
<span class="id" title="keyword">Definition</span> <a id="voter_voted_in_votes" class="idref" href="#voter_voted_in_votes"><span class="id" title="definition">voter_voted_in_votes</span></a> {<a id="bizantiners_number:87" class="idref" href="#bizantiners_number:87"><span class="id" title="binder">bizantiners_number</span></a> <a id="last_block_number:88" class="idref" href="#last_block_number:88"><span class="id" title="binder">last_block_number</span></a>}<br/>
&nbsp;&nbsp;{<a id="voters:89" class="idref" href="#voters:89"><span class="id" title="binder">voters</span></a>: <a class="idref" href="Grandpa.Votes.html#Voters"><span class="id" title="inductive">Voters</span></a> <a class="idref" href="Grandpa.Votes.html#bizantiners_number:87"><span class="id" title="variable">bizantiners_number</span></a>} {<a id="last_block:90" class="idref" href="#last_block:90"><span class="id" title="binder">last_block</span></a>:<a class="idref" href="Grandpa.Blocks.html#Block"><span class="id" title="inductive">Block</span></a> <a class="idref" href="Grandpa.Votes.html#last_block_number:88"><span class="id" title="variable">last_block_number</span></a>}<br/>
&nbsp;&nbsp;(<a id="voter:91" class="idref" href="#voter:91"><span class="id" title="binder">voter</span></a>: <a class="idref" href="Grandpa.Votes.html#Voter"><span class="id" title="definition">Voter</span></a>)<br/>
&nbsp;&nbsp;(<a id="votes:92" class="idref" href="#votes:92"><span class="id" title="binder">votes</span></a>: <a class="idref" href="Grandpa.Votes.html#Votes"><span class="id" title="inductive">Votes</span></a> <a class="idref" href="Grandpa.Votes.html#voters:89"><span class="id" title="variable">voters</span></a> <a class="idref" href="Grandpa.Votes.html#last_block:90"><span class="id" title="variable">last_block</span></a>)<br/>
&nbsp;&nbsp;:=<br/>
&nbsp;&nbsp;0 <a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Nat.html#6b7621b45fff0af5e2b2cbb2bc2d4e1d"><span class="id" title="notation">&lt;?</span></a> <a class="idref" href="Grandpa.ListFacts.html#count"><span class="id" title="definition">count</span></a> <a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Nat.html#eqb"><span class="id" title="definition">Nat.eqb</span></a> <a class="idref" href="Grandpa.Votes.html#voter:91"><span class="id" title="variable">voter</span></a> (<a class="idref" href="Grandpa.Votes.html#votes_to_voters_list"><span class="id" title="definition">votes_to_voters_list</span></a> <a class="idref" href="Grandpa.Votes.html#votes:92"><span class="id" title="variable">votes</span></a>).<br/>

<br/>
<span class="id" title="keyword">Definition</span> <a id="is_equivocate" class="idref" href="#is_equivocate"><span class="id" title="definition">is_equivocate</span></a> {<a id="bizantiners_number:93" class="idref" href="#bizantiners_number:93"><span class="id" title="binder">bizantiners_number</span></a> <a id="last_block_number:94" class="idref" href="#last_block_number:94"><span class="id" title="binder">last_block_number</span></a> } <br/>
&nbsp;&nbsp;{<a id="voters:95" class="idref" href="#voters:95"><span class="id" title="binder">voters</span></a>: <a class="idref" href="Grandpa.Votes.html#Voters"><span class="id" title="inductive">Voters</span></a> <a class="idref" href="Grandpa.Votes.html#bizantiners_number:93"><span class="id" title="variable">bizantiners_number</span></a>}<br/>
&nbsp;&nbsp;{<a id="last_block:96" class="idref" href="#last_block:96"><span class="id" title="binder">last_block</span></a> : <a class="idref" href="Grandpa.Blocks.html#Block"><span class="id" title="inductive">Block</span></a> <a class="idref" href="Grandpa.Votes.html#last_block_number:94"><span class="id" title="variable">last_block_number</span></a>}<br/>
&nbsp;&nbsp;(<a id="voter:97" class="idref" href="#voter:97"><span class="id" title="binder">voter</span></a>: <a class="idref" href="Grandpa.Votes.html#Voter"><span class="id" title="definition">Voter</span></a>)<br/>
&nbsp;&nbsp;(<a id="votes:98" class="idref" href="#votes:98"><span class="id" title="binder">votes</span></a>: <a class="idref" href="Grandpa.Votes.html#Votes"><span class="id" title="inductive">Votes</span></a> <a class="idref" href="Grandpa.Votes.html#voters:95"><span class="id" title="variable">voters</span></a> <a class="idref" href="Grandpa.Votes.html#last_block:96"><span class="id" title="variable">last_block</span></a>)<br/>
&nbsp;&nbsp;: <a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Datatypes.html#bool"><span class="id" title="inductive">bool</span></a><br/>
&nbsp;&nbsp;:= 1 <a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Nat.html#6b7621b45fff0af5e2b2cbb2bc2d4e1d"><span class="id" title="notation">&lt;?</span></a> <a class="idref" href="Grandpa.ListFacts.html#count"><span class="id" title="definition">count</span></a> <a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Nat.html#eqb"><span class="id" title="definition">Nat.eqb</span></a> <a class="idref" href="Grandpa.Votes.html#voter:97"><span class="id" title="variable">voter</span></a> ( <a class="idref" href="Grandpa.Votes.html#votes_to_voters_list"><span class="id" title="definition">votes_to_voters_list</span></a> <a class="idref" href="Grandpa.Votes.html#votes:98"><span class="id" title="variable">votes</span></a>).<br/>

<br/>
</div>

<div class="doc">
The first element are the equivocate voters 
and the second one are the voters that only voted once.

<div class="paragraph"> </div>

Why?

<div class="paragraph"> </div>

In Purescript the partition funtion returns a record like:

<div class="paragraph"> </div>

<pre>
  {success: _ , failures: _} 
</pre>

<div class="paragraph"> </div>

Then you can do <span class="inlinecode"><span class="id" title="var">out.success</span></span> and <span class="inlinecode"><span class="id" title="var">out.failures</span></span>. 

<div class="paragraph"> </div>

In coq that may be not worth the effort.

</div>
<div class="code">

<br/>
<span class="id" title="keyword">Definition</span> <a id="split_voters_by_equivocation" class="idref" href="#split_voters_by_equivocation"><span class="id" title="definition">split_voters_by_equivocation</span></a> {<a id="bizantiners_number:99" class="idref" href="#bizantiners_number:99"><span class="id" title="binder">bizantiners_number</span></a> <a id="last_block_number:100" class="idref" href="#last_block_number:100"><span class="id" title="binder">last_block_number</span></a> } <br/>
&nbsp;&nbsp;{<a id="voters:101" class="idref" href="#voters:101"><span class="id" title="binder">voters</span></a>: <a class="idref" href="Grandpa.Votes.html#Voters"><span class="id" title="inductive">Voters</span></a> <a class="idref" href="Grandpa.Votes.html#bizantiners_number:99"><span class="id" title="variable">bizantiners_number</span></a>}<br/>
&nbsp;&nbsp;{<a id="last_block:102" class="idref" href="#last_block:102"><span class="id" title="binder">last_block</span></a> : <a class="idref" href="Grandpa.Blocks.html#Block"><span class="id" title="inductive">Block</span></a> <a class="idref" href="Grandpa.Votes.html#last_block_number:100"><span class="id" title="variable">last_block_number</span></a>}<br/>
&nbsp;&nbsp;(<a id="votes:103" class="idref" href="#votes:103"><span class="id" title="binder">votes</span></a>: <a class="idref" href="Grandpa.Votes.html#Votes"><span class="id" title="inductive">Votes</span></a> <a class="idref" href="Grandpa.Votes.html#voters:101"><span class="id" title="variable">voters</span></a> <a class="idref" href="Grandpa.Votes.html#last_block:102"><span class="id" title="variable">last_block</span></a>)<br/>
&nbsp;&nbsp;: <a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Datatypes.html#list"><span class="id" title="inductive">list</span></a> <a class="idref" href="Grandpa.Votes.html#Voter"><span class="id" title="definition">Voter</span></a> <a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Datatypes.html#11c698c8685bb8ab1cf725545c085ac4"><span class="id" title="notation">×</span></a> <a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Datatypes.html#list"><span class="id" title="inductive">list</span></a> <a class="idref" href="Grandpa.Votes.html#Voter"><span class="id" title="definition">Voter</span></a><br/>
&nbsp;&nbsp;:=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="voters_list:104" class="idref" href="#voters_list:104"><span class="id" title="binder">voters_list</span></a> := <a class="idref" href="Grandpa.Votes.html#voters_to_list"><span class="id" title="definition">voters_to_list</span></a> <a class="idref" href="Grandpa.Votes.html#voters:101"><span class="id" title="variable">voters</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Lists.List.html#partition"><span class="id" title="definition">List.partition</span></a>  (<span class="id" title="keyword">fun</span> <a id="voter:105" class="idref" href="#voter:105"><span class="id" title="binder">voter</span></a> ⇒ <a class="idref" href="Grandpa.Votes.html#is_equivocate"><span class="id" title="definition">is_equivocate</span></a> <a class="idref" href="Grandpa.Votes.html#voter:105"><span class="id" title="variable">voter</span></a> <a class="idref" href="Grandpa.Votes.html#votes:103"><span class="id" title="variable">votes</span></a>) <a class="idref" href="Grandpa.Votes.html#voters_list:104"><span class="id" title="variable">voters_list</span></a>.<br/>

<br/>
<span class="id" title="keyword">Section</span> <a id="Some" class="idref" href="#Some"><span class="id" title="section">Some</span></a>.<br/>

<br/>
</div>

<div class="doc">

<div class="paragraph"> </div>

  Sections are really useful to declare local variables 
   to avoid having big predicates.
   But sometimes we may need to close a section since 
   coq interprets in a erroneous way what we write.
   We immediately open a section again when this happen.

</div>
<div class="code">
<span class="id" title="keyword">Context</span> {<a id="bizantiners_number:106" class="idref" href="#bizantiners_number:106"><span class="id" title="binder">bizantiners_number</span></a> <a id="last_block_number:107" class="idref" href="#last_block_number:107"><span class="id" title="binder">last_block_number</span></a> : <a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a>}.<br/>
<span class="id" title="keyword">Variable</span> <a id="Some.voters" class="idref" href="#Some.voters"><span class="id" title="variable">voters</span></a>: <a class="idref" href="Grandpa.Votes.html#Voters"><span class="id" title="inductive">Voters</span></a> <a class="idref" href="Grandpa.Votes.html#Some.bizantiners_number"><span class="id" title="variable">bizantiners_number</span></a>.<br/>
<span class="id" title="keyword">Variable</span> <a id="Some.last_block" class="idref" href="#Some.last_block"><span class="id" title="variable">last_block</span></a>  :<a class="idref" href="Grandpa.Blocks.html#Block"><span class="id" title="inductive">Block</span></a> <a class="idref" href="Grandpa.Votes.html#Some.last_block_number"><span class="id" title="variable">last_block_number</span></a>.<br/>
<span class="id" title="keyword">Variable</span> <a id="Some.votes" class="idref" href="#Some.votes"><span class="id" title="variable">votes</span></a>: <a class="idref" href="Grandpa.Votes.html#Votes"><span class="id" title="inductive">Votes</span></a> <a class="idref" href="Grandpa.Votes.html#Some.voters"><span class="id" title="variable">voters</span></a> <a class="idref" href="Grandpa.Votes.html#Some.last_block"><span class="id" title="variable">last_block</span></a>.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <a id="in_nat_list" class="idref" href="#in_nat_list"><span class="id" title="definition">in_nat_list</span></a> (<a id="n:111" class="idref" href="#n:111"><span class="id" title="binder">n</span></a>:<a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a>) (<a id="l:112" class="idref" href="#l:112"><span class="id" title="binder">l</span></a>:<a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Datatypes.html#list"><span class="id" title="inductive">list</span></a> <a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a>) :<a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Datatypes.html#bool"><span class="id" title="inductive">bool</span></a> := <br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Lists.List.html#find"><span class="id" title="definition">List.find</span></a> (<span class="id" title="keyword">fun</span> <a id="m:113" class="idref" href="#m:113"><span class="id" title="binder">m</span></a> ⇒ (<a class="idref" href="Grandpa.Votes.html#n:111"><span class="id" title="variable">n</span></a> <a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Nat.html#ad2ec4e405f68c46c0a176e3e94ae2e3"><span class="id" title="notation">=?</span></a> <a class="idref" href="Grandpa.Votes.html#m:113"><span class="id" title="variable">m</span></a>)%<span class="id" title="var">nat</span>) <a class="idref" href="Grandpa.Votes.html#l:112"><span class="id" title="variable">l</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Datatypes.html#None"><span class="id" title="constructor">None</span></a> ⇒ <a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Datatypes.html#false"><span class="id" title="constructor">false</span></a><br/>
&nbsp;&nbsp;| <span class="id" title="var">_</span> ⇒ <a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Datatypes.html#true"><span class="id" title="constructor">true</span></a><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <a id="filter_votes_by_voters_subset" class="idref" href="#filter_votes_by_voters_subset"><span class="id" title="definition">filter_votes_by_voters_subset</span></a> (<a id="subset:114" class="idref" href="#subset:114"><span class="id" title="binder">subset</span></a> : <a class="idref" href="Grandpa.Votes.html#Voters"><span class="id" title="inductive">Voters</span></a> <a class="idref" href="Grandpa.Votes.html#Some.bizantiners_number"><span class="id" title="variable">bizantiners_number</span></a> ) <br/>
&nbsp;&nbsp;: <a class="idref" href="Grandpa.Votes.html#Votes"><span class="id" title="inductive">Votes</span></a> <a class="idref" href="Grandpa.Votes.html#Some.voters"><span class="id" title="variable">voters</span></a> <a class="idref" href="Grandpa.Votes.html#Some.last_block"><span class="id" title="variable">last_block</span></a><br/>
&nbsp;&nbsp;:= <br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="votes_list:115" class="idref" href="#votes_list:115"><span class="id" title="binder">votes_list</span></a> := <a class="idref" href="Grandpa.Votes.html#votes_to_list"><span class="id" title="definition">votes_to_list</span></a> <a class="idref" href="Grandpa.Votes.html#Some.votes"><span class="id" title="variable">votes</span></a><br/>
&nbsp;&nbsp;<span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="voters_as_nat_list:116" class="idref" href="#voters_as_nat_list:116"><span class="id" title="binder">voters_as_nat_list</span></a> := <a class="idref" href="Grandpa.Votes.html#voters_to_list"><span class="id" title="definition">voters_to_list</span></a> <a class="idref" href="Grandpa.Votes.html#subset:114"><span class="id" title="variable">subset</span></a><br/>
&nbsp;&nbsp;<span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="vote_predicate:118" class="idref" href="#vote_predicate:118"><span class="id" title="binder">vote_predicate</span></a> <a id="vote:117" class="idref" href="#vote:117"><span class="id" title="binder">vote</span></a> := <a class="idref" href="Grandpa.Votes.html#in_nat_list"><span class="id" title="definition">in_nat_list</span></a> (<a class="idref" href="Grandpa.Votes.html#vote_to_voter"><span class="id" title="definition">vote_to_voter</span></a> <a class="idref" href="Grandpa.Votes.html#vote:117"><span class="id" title="variable">vote</span></a>) <a class="idref" href="Grandpa.Votes.html#voters_as_nat_list:116"><span class="id" title="variable">voters_as_nat_list</span></a><br/>
&nbsp;&nbsp;<span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Grandpa.Votes.html#VotesC"><span class="id" title="constructor">VotesC</span></a> <a class="idref" href="Grandpa.Votes.html#Some.voters"><span class="id" title="variable">voters</span></a> <a class="idref" href="Grandpa.Votes.html#Some.last_block"><span class="id" title="variable">last_block</span></a> (<a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Lists.List.html#filter"><span class="id" title="definition">List.filter</span></a> <a class="idref" href="Grandpa.Votes.html#vote_predicate:118"><span class="id" title="variable">vote_predicate</span></a>  <a class="idref" href="Grandpa.Votes.html#votes_list:115"><span class="id" title="variable">votes_list</span></a>).<br/>

<br/>
<span class="id" title="keyword">End</span> <a class="idref" href="Grandpa.Votes.html#Some"><span class="id" title="section">Some</span></a>.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <a id="is_safe" class="idref" href="#is_safe"><span class="id" title="definition">is_safe</span></a> {<a id="bizantiners_number:119" class="idref" href="#bizantiners_number:119"><span class="id" title="binder">bizantiners_number</span></a> <a id="last_block_number:120" class="idref" href="#last_block_number:120"><span class="id" title="binder">last_block_number</span></a> } <br/>
&nbsp;&nbsp;{<a id="voters:121" class="idref" href="#voters:121"><span class="id" title="binder">voters</span></a>: <a class="idref" href="Grandpa.Votes.html#Voters"><span class="id" title="inductive">Voters</span></a> <a class="idref" href="Grandpa.Votes.html#bizantiners_number:119"><span class="id" title="variable">bizantiners_number</span></a>}<br/>
&nbsp;&nbsp;{<a id="last_block:122" class="idref" href="#last_block:122"><span class="id" title="binder">last_block</span></a> : <a class="idref" href="Grandpa.Blocks.html#Block"><span class="id" title="inductive">Block</span></a> <a class="idref" href="Grandpa.Votes.html#last_block_number:120"><span class="id" title="variable">last_block_number</span></a>}<br/>
&nbsp;&nbsp;(<a id="votes:123" class="idref" href="#votes:123"><span class="id" title="binder">votes</span></a>: <a class="idref" href="Grandpa.Votes.html#Votes"><span class="id" title="inductive">Votes</span></a> <a class="idref" href="Grandpa.Votes.html#voters:121"><span class="id" title="variable">voters</span></a> <a class="idref" href="Grandpa.Votes.html#last_block:122"><span class="id" title="variable">last_block</span></a>)<br/>
&nbsp;&nbsp;:<a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Datatypes.html#bool"><span class="id" title="inductive">bool</span></a><br/>
&nbsp;&nbsp;:=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="Grandpa.Votes.html#split_voters_by_equivocation"><span class="id" title="definition">split_voters_by_equivocation</span></a> <a class="idref" href="Grandpa.Votes.html#votes:123"><span class="id" title="variable">votes</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><span class="id" title="var">equivocate_voters</span><a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <span class="id" title="var">non_equivocate_voters</span><a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Datatypes.html#length"><span class="id" title="definition">length</span></a> <span class="id" title="var">equivocate_voters</span> <a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Nat.html#0f31f5c1c6b6a21a3a187247222bc9e4"><span class="id" title="notation">&lt;=?</span></a> <a class="idref" href="Grandpa.Votes.html#bizantiners_number:119"><span class="id" title="variable">bizantiners_number</span></a><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <a id="BlockDictionary" class="idref" href="#BlockDictionary"><span class="id" title="definition">BlockDictionary</span></a> := <a class="idref" href="Grandpa.Dictionary.html#Dictionary"><span class="id" title="inductive">Dictionary.Dictionary</span></a> <a class="idref" href="Grandpa.Blocks.html#AnyBlock"><span class="id" title="definition">AnyBlock</span></a> <a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a>.<br/>

<br/>
</div>

<div class="doc">
<a id="lab10"></a><h2 class="section">Vote count</h2>


<div class="paragraph"> </div>

<ul class="doclist">
<li> First we split the set of votes in two, one of votes 
  made by equivocate voters and other made by 
   non equivocate voters

</li>
<li> We count the total votes for all the block that 
  were votes (that is, we don't count the 
   blocks b such that   b &lt; b'  and last_block &lt; b
   when some voter voted for b' but not for b)

</li>
<li> Then we do a "flatten" it means for every 
  voted block b, if b' &lt; b and last_block &lt; b
   then we add the votes for b to the votes for b'.

</li>
</ul>

</div>
<div class="code">

<br/>
<span class="id" title="keyword">Definition</span> <a id="aux_vote_update" class="idref" href="#aux_vote_update"><span class="id" title="definition">aux_vote_update</span></a> (<a id="old_votes:124" class="idref" href="#old_votes:124"><span class="id" title="binder">old_votes</span></a>: <a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Datatypes.html#option"><span class="id" title="inductive">option</span></a> <a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a>) (<a id="new_votes:125" class="idref" href="#new_votes:125"><span class="id" title="binder">new_votes</span></a>:<a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a>)<br/>
&nbsp;&nbsp;:= <br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="Grandpa.Votes.html#old_votes:124"><span class="id" title="variable">old_votes</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Datatypes.html#None"><span class="id" title="constructor">None</span></a> ⇒ <a class="idref" href="Grandpa.Votes.html#new_votes:125"><span class="id" title="variable">new_votes</span></a><br/>
&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <span class="id" title="var">v'</span> ⇒ <a class="idref" href="Grandpa.Votes.html#new_votes:125"><span class="id" title="variable">new_votes</span></a><a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Nat.html#0dacc1786c5ba797d47dd85006231633"><span class="id" title="notation">+</span></a><span class="id" title="var">v'</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <a id="update_with_vote_to_block" class="idref" href="#update_with_vote_to_block"><span class="id" title="definition">update_with_vote_to_block</span></a> (<a id="d:127" class="idref" href="#d:127"><span class="id" title="binder">d</span></a>:<a class="idref" href="Grandpa.Votes.html#BlockDictionary"><span class="id" title="definition">BlockDictionary</span></a>)<br/>
&nbsp;&nbsp;(<a id="block:128" class="idref" href="#block:128"><span class="id" title="binder">block</span></a>:<a class="idref" href="Grandpa.Blocks.html#AnyBlock"><span class="id" title="definition">AnyBlock</span></a>)<br/>
&nbsp;&nbsp;: <a class="idref" href="Grandpa.Votes.html#BlockDictionary"><span class="id" title="definition">BlockDictionary</span></a><br/>
&nbsp;&nbsp;:= <a class="idref" href="Grandpa.Dictionary.html#update_with"><span class="id" title="definition">Dictionary.update_with</span></a> <a class="idref" href="Grandpa.Blocks.html#anyblock_eqb"><span class="id" title="definition">anyblock_eqb</span></a> <a class="idref" href="Grandpa.Votes.html#block:128"><span class="id" title="variable">block</span></a> 1 <a class="idref" href="Grandpa.Votes.html#aux_vote_update"><span class="id" title="definition">aux_vote_update</span></a> <a class="idref" href="Grandpa.Votes.html#d:127"><span class="id" title="variable">d</span></a>.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <a id="make_votes_dictionary" class="idref" href="#make_votes_dictionary"><span class="id" title="definition">make_votes_dictionary</span></a><br/>
&nbsp;&nbsp;(<a id="votes:129" class="idref" href="#votes:129"><span class="id" title="binder">votes</span></a>:<a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Datatypes.html#list"><span class="id" title="inductive">list</span></a> <a class="idref" href="Grandpa.Blocks.html#AnyBlock"><span class="id" title="definition">AnyBlock</span></a>)(<a id="acc:130" class="idref" href="#acc:130"><span class="id" title="binder">acc</span></a>: <a class="idref" href="Grandpa.Votes.html#BlockDictionary"><span class="id" title="definition">BlockDictionary</span></a>)<br/>
&nbsp;&nbsp;: <a class="idref" href="Grandpa.Votes.html#BlockDictionary"><span class="id" title="definition">BlockDictionary</span></a><br/>
&nbsp;&nbsp;:=<br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Lists.List.html#fold_left"><span class="id" title="definition">List.fold_left</span></a> <br/>
&nbsp;&nbsp;<a class="idref" href="Grandpa.Votes.html#update_with_vote_to_block"><span class="id" title="definition">update_with_vote_to_block</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Grandpa.Votes.html#votes:129"><span class="id" title="variable">votes</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Grandpa.Votes.html#acc:130"><span class="id" title="variable">acc</span></a>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a id="make_votes_dictionary_step_empty" class="idref" href="#make_votes_dictionary_step_empty"><span class="id" title="lemma">make_votes_dictionary_step_empty</span></a><br/>
&nbsp;&nbsp;(<a id="votes:131" class="idref" href="#votes:131"><span class="id" title="binder">votes</span></a>:<a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Datatypes.html#list"><span class="id" title="inductive">list</span></a> <a class="idref" href="Grandpa.Blocks.html#AnyBlock"><span class="id" title="definition">AnyBlock</span></a>) <a id="block:132" class="idref" href="#block:132"><span class="id" title="binder">block</span></a><br/>
&nbsp;&nbsp;: <a class="idref" href="Grandpa.Votes.html#make_votes_dictionary"><span class="id" title="definition">make_votes_dictionary</span></a> (<a class="idref" href="Grandpa.Votes.html#block:132"><span class="id" title="variable">block</span></a><a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Datatypes.html#::list_scope:x_'::'_x"><span class="id" title="notation">::</span></a><a class="idref" href="Grandpa.Votes.html#votes:131"><span class="id" title="variable">votes</span></a>) <a class="idref" href="Grandpa.Dictionary.html#empty"><span class="id" title="definition">Dictionary.empty</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Grandpa.Votes.html#make_votes_dictionary"><span class="id" title="definition">make_votes_dictionary</span></a> <a class="idref" href="Grandpa.Votes.html#votes:131"><span class="id" title="variable">votes</span></a> (<a class="idref" href="Grandpa.Dictionary.html#from_list"><span class="id" title="definition">Dictionary.from_list</span></a> <a class="idref" href="Grandpa.Blocks.html#anyblock_eqb"><span class="id" title="definition">anyblock_eqb</span></a> (<a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="Grandpa.Votes.html#block:132"><span class="id" title="variable">block</span></a><a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a>1<a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a><a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Datatypes.html#::list_scope:x_'::'_x"><span class="id" title="notation">::</span></a><a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Datatypes.html#nil"><span class="id" title="constructor">nil</span></a>)%<span class="id" title="var">list</span>).<br/>

<br/>

<br/>
<span class="id" title="keyword">Definition</span> <a id="some_to_nat" class="idref" href="#some_to_nat"><span class="id" title="definition">some_to_nat</span></a> (<a id="x:133" class="idref" href="#x:133"><span class="id" title="binder">x</span></a>:<a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Datatypes.html#option"><span class="id" title="inductive">option</span></a> <a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a>)<br/>
&nbsp;&nbsp;:= <br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="Grandpa.Votes.html#x:133"><span class="id" title="variable">x</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <span class="id" title="var">y</span> ⇒ <span class="id" title="var">y</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Datatypes.html#None"><span class="id" title="constructor">None</span></a> ⇒ 0<br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a id="make_votes_dictionary_counts_right_aux" class="idref" href="#make_votes_dictionary_counts_right_aux"><span class="id" title="lemma">make_votes_dictionary_counts_right_aux</span></a> <br/>
&nbsp;&nbsp;(<a id="votes:135" class="idref" href="#votes:135"><span class="id" title="binder">votes</span></a>:<a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Datatypes.html#list"><span class="id" title="inductive">list</span></a> <a class="idref" href="Grandpa.Blocks.html#AnyBlock"><span class="id" title="definition">AnyBlock</span></a>)<br/>
&nbsp;&nbsp;: <span class="id" title="keyword">∀</span> <a id="block:136" class="idref" href="#block:136"><span class="id" title="binder">block</span></a> <a id="votes_value:137" class="idref" href="#votes_value:137"><span class="id" title="binder">votes_value</span></a> <a id="d:138" class="idref" href="#d:138"><span class="id" title="binder">d</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Grandpa.Dictionary.html#lookup"><span class="id" title="definition">Dictionary.lookup</span></a> <a class="idref" href="Grandpa.Blocks.html#anyblock_eqb"><span class="id" title="definition">anyblock_eqb</span></a> <a class="idref" href="Grandpa.Votes.html#block:136"><span class="id" title="variable">block</span></a> (<a class="idref" href="Grandpa.Votes.html#make_votes_dictionary"><span class="id" title="definition">make_votes_dictionary</span></a> <a class="idref" href="Grandpa.Votes.html#votes:135"><span class="id" title="variable">votes</span></a> <a class="idref" href="Grandpa.Votes.html#d:138"><span class="id" title="variable">d</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="Grandpa.Votes.html#votes_value:137"><span class="id" title="variable">votes_value</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="Grandpa.Votes.html#votes_value:137"><span class="id" title="variable">votes_value</span></a> <a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Grandpa.ListFacts.html#count"><span class="id" title="definition">count</span></a> <a class="idref" href="Grandpa.Blocks.html#anyblock_eqb"><span class="id" title="definition">anyblock_eqb</span></a> <a class="idref" href="Grandpa.Votes.html#block:136"><span class="id" title="variable">block</span></a> <a class="idref" href="Grandpa.Votes.html#votes:135"><span class="id" title="variable">votes</span></a> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Nat.html#0dacc1786c5ba797d47dd85006231633"><span class="id" title="notation">+</span></a> <a class="idref" href="Grandpa.Votes.html#some_to_nat"><span class="id" title="definition">some_to_nat</span></a> (<a class="idref" href="Grandpa.Dictionary.html#lookup"><span class="id" title="definition">Dictionary.lookup</span></a> <a class="idref" href="Grandpa.Blocks.html#anyblock_eqb"><span class="id" title="definition">anyblock_eqb</span></a> <a class="idref" href="Grandpa.Votes.html#block:136"><span class="id" title="variable">block</span></a> <a class="idref" href="Grandpa.Votes.html#d:138"><span class="id" title="variable">d</span></a>).<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a id="make_votes_dictionary_counts_right_aux2" class="idref" href="#make_votes_dictionary_counts_right_aux2"><span class="id" title="lemma">make_votes_dictionary_counts_right_aux2</span></a><br/>
&nbsp;&nbsp;(<a id="votes:139" class="idref" href="#votes:139"><span class="id" title="binder">votes</span></a>:<a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Datatypes.html#list"><span class="id" title="inductive">list</span></a> <a class="idref" href="Grandpa.Blocks.html#AnyBlock"><span class="id" title="definition">AnyBlock</span></a>)<br/>
&nbsp;&nbsp;: <span class="id" title="keyword">∀</span> <a id="block:140" class="idref" href="#block:140"><span class="id" title="binder">block</span></a> <a id="d:141" class="idref" href="#d:141"><span class="id" title="binder">d</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Grandpa.Votes.html#some_to_nat"><span class="id" title="definition">some_to_nat</span></a> (<a class="idref" href="Grandpa.Dictionary.html#lookup"><span class="id" title="definition">Dictionary.lookup</span></a> <a class="idref" href="Grandpa.Blocks.html#anyblock_eqb"><span class="id" title="definition">anyblock_eqb</span></a> <a class="idref" href="Grandpa.Votes.html#block:140"><span class="id" title="variable">block</span></a> (<a class="idref" href="Grandpa.Votes.html#make_votes_dictionary"><span class="id" title="definition">make_votes_dictionary</span></a> <a class="idref" href="Grandpa.Votes.html#votes:139"><span class="id" title="variable">votes</span></a> <a class="idref" href="Grandpa.Votes.html#d:141"><span class="id" title="variable">d</span></a>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Grandpa.ListFacts.html#count"><span class="id" title="definition">count</span></a> <a class="idref" href="Grandpa.Blocks.html#anyblock_eqb"><span class="id" title="definition">anyblock_eqb</span></a> <a class="idref" href="Grandpa.Votes.html#block:140"><span class="id" title="variable">block</span></a> <a class="idref" href="Grandpa.Votes.html#votes:139"><span class="id" title="variable">votes</span></a> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Nat.html#0dacc1786c5ba797d47dd85006231633"><span class="id" title="notation">+</span></a> <a class="idref" href="Grandpa.Votes.html#some_to_nat"><span class="id" title="definition">some_to_nat</span></a> (<a class="idref" href="Grandpa.Dictionary.html#lookup"><span class="id" title="definition">Dictionary.lookup</span></a> <a class="idref" href="Grandpa.Blocks.html#anyblock_eqb"><span class="id" title="definition">anyblock_eqb</span></a> <a class="idref" href="Grandpa.Votes.html#block:140"><span class="id" title="variable">block</span></a> <a class="idref" href="Grandpa.Votes.html#d:141"><span class="id" title="variable">d</span></a>).<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a id="make_votes_dictionary_counts_right" class="idref" href="#make_votes_dictionary_counts_right"><span class="id" title="lemma">make_votes_dictionary_counts_right</span></a><br/>
&nbsp;&nbsp;(<a id="votes:142" class="idref" href="#votes:142"><span class="id" title="binder">votes</span></a>:<a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Datatypes.html#list"><span class="id" title="inductive">list</span></a> <a class="idref" href="Grandpa.Blocks.html#AnyBlock"><span class="id" title="definition">AnyBlock</span></a>)<br/>
&nbsp;&nbsp;: <span class="id" title="keyword">∀</span> (<a id="block:143" class="idref" href="#block:143"><span class="id" title="binder">block</span></a>:<a class="idref" href="Grandpa.Blocks.html#AnyBlock"><span class="id" title="definition">AnyBlock</span></a>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Grandpa.Votes.html#some_to_nat"><span class="id" title="definition">some_to_nat</span></a> (<a class="idref" href="Grandpa.Dictionary.html#lookup"><span class="id" title="definition">Dictionary.lookup</span></a> <a class="idref" href="Grandpa.Blocks.html#anyblock_eqb"><span class="id" title="definition">anyblock_eqb</span></a> <a class="idref" href="Grandpa.Votes.html#block:143"><span class="id" title="variable">block</span></a> (<a class="idref" href="Grandpa.Votes.html#make_votes_dictionary"><span class="id" title="definition">make_votes_dictionary</span></a> <a class="idref" href="Grandpa.Votes.html#votes:142"><span class="id" title="variable">votes</span></a> <a class="idref" href="Grandpa.Dictionary.html#empty"><span class="id" title="definition">Dictionary.empty</span></a>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Grandpa.ListFacts.html#count"><span class="id" title="definition">count</span></a> <a class="idref" href="Grandpa.Blocks.html#anyblock_eqb"><span class="id" title="definition">anyblock_eqb</span></a> <a class="idref" href="Grandpa.Votes.html#block:143"><span class="id" title="variable">block</span></a> <a class="idref" href="Grandpa.Votes.html#votes:142"><span class="id" title="variable">votes</span></a>.<br/>

<br/>
</div>

<div class="doc">
  A vote for <span class="inlinecode"><span class="id" title="var">B</span>:</span> <span class="inlinecode"><a class="idref" href="Grandpa.Blocks.html#Block"><span class="id" title="inductive">Block</span></a></span> <span class="inlinecode"><span class="id" title="var">n</span></span> is also a vote for <span class="inlinecode"><span class="id" title="var">B'</span>:<a class="idref" href="Grandpa.Blocks.html#Block"><span class="id" title="inductive">Block</span></a></span> <span class="inlinecode"><span class="id" title="var">n'</span></span> 
   as long as <span class="inlinecode"><span class="id" title="var">B'</span></span> <span class="inlinecode">≤</span> <span class="inlinecode"><span class="id" title="var">B</span></span> and last_block &lt;= B'. 

</div>
<div class="code">
<span class="id" title="keyword">Fixpoint</span> <a id="flat_votes_aux" class="idref" href="#flat_votes_aux"><span class="id" title="definition">flat_votes_aux</span></a> {<a id="m:144" class="idref" href="#m:144"><span class="id" title="binder">m</span></a>}<br/>
&nbsp;&nbsp;(<a id="last_block_number:145" class="idref" href="#last_block_number:145"><span class="id" title="binder">last_block_number</span></a>:<a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a>) <br/>
&nbsp;&nbsp;(<a id="block:146" class="idref" href="#block:146"><span class="id" title="binder">block</span></a>:<a class="idref" href="Grandpa.Blocks.html#Block"><span class="id" title="inductive">Block</span></a> <a class="idref" href="Grandpa.Votes.html#m:144"><span class="id" title="variable">m</span></a>)<br/>
&nbsp;&nbsp;(<a id="voter_number:147" class="idref" href="#voter_number:147"><span class="id" title="binder">voter_number</span></a>:<a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a>)<br/>
&nbsp;&nbsp;(<a id="acc:148" class="idref" href="#acc:148"><span class="id" title="binder">acc</span></a>: <a class="idref" href="Grandpa.Votes.html#BlockDictionary"><span class="id" title="definition">BlockDictionary</span></a>): <a class="idref" href="Grandpa.Votes.html#BlockDictionary"><span class="id" title="definition">BlockDictionary</span></a><br/>
&nbsp;&nbsp;:=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">if</span> <a class="idref" href="Grandpa.Votes.html#last_block_number:145"><span class="id" title="variable">last_block_number</span></a> <a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Nat.html#6b7621b45fff0af5e2b2cbb2bc2d4e1d"><span class="id" title="notation">&lt;?</span></a> <a class="idref" href="Grandpa.Votes.html#m:144"><span class="id" title="variable">m</span></a> <br/>
&nbsp;&nbsp;<span class="id" title="keyword">then</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="Grandpa.Votes.html#block:146"><span class="id" title="variable">block</span></a> <span class="id" title="keyword">with</span>  <br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="Grandpa.Blocks.html#OriginBlock"><span class="id" title="constructor">OriginBlock</span></a> ⇒ <a class="idref" href="Grandpa.Votes.html#acc:148"><span class="id" title="variable">acc</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="Grandpa.Blocks.html#NewBlock"><span class="id" title="constructor">NewBlock</span></a> <span class="id" title="var">older_block</span> <span class="id" title="var">id</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="update_vote:154" class="idref" href="#update_vote:154"><span class="id" title="binder">update_vote</span></a> <a id="maybe_old_value:151" class="idref" href="#maybe_old_value:151"><span class="id" title="binder">maybe_old_value</span></a> <a id="v:152" class="idref" href="#v:152"><span class="id" title="binder">v</span></a> := <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="Grandpa.Votes.html#maybe_old_value:151"><span class="id" title="variable">maybe_old_value</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Datatypes.html#None"><span class="id" title="constructor">None</span></a> ⇒ <a class="idref" href="Grandpa.Votes.html#v:152"><span class="id" title="variable">v</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <span class="id" title="var">v2</span> ⇒ <a class="idref" href="Grandpa.Votes.html#v:152"><span class="id" title="variable">v</span></a><a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Nat.html#0dacc1786c5ba797d47dd85006231633"><span class="id" title="notation">+</span></a><span class="id" title="var">v2</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="updated_acc:155" class="idref" href="#updated_acc:155"><span class="id" title="binder">updated_acc</span></a> := <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Grandpa.Dictionary.html#update_with"><span class="id" title="definition">Dictionary.update_with</span></a> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Grandpa.Blocks.html#anyblock_eqb"><span class="id" title="definition">Blocks.anyblock_eqb</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Specif.html#existT"><span class="id" title="constructor">existT</span></a> <span class="id" title="var">_</span> <a class="idref" href="Grandpa.Votes.html#m:144"><span class="id" title="variable">m</span></a> <a class="idref" href="Grandpa.Votes.html#block:146"><span class="id" title="variable">block</span></a>) <a class="idref" href="Grandpa.Votes.html#voter_number:147"><span class="id" title="variable">voter_number</span></a> <a class="idref" href="Grandpa.Votes.html#update_vote:154"><span class="id" title="variable">update_vote</span></a> <a class="idref" href="Grandpa.Votes.html#acc:148"><span class="id" title="variable">acc</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">in</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Grandpa.Votes.html#flat_votes_aux:149"><span class="id" title="definition">flat_votes_aux</span></a> <a class="idref" href="Grandpa.Votes.html#last_block_number:145"><span class="id" title="variable">last_block_number</span></a> <span class="id" title="var">older_block</span> <a class="idref" href="Grandpa.Votes.html#voter_number:147"><span class="id" title="variable">voter_number</span></a> <a class="idref" href="Grandpa.Votes.html#updated_acc:155"><span class="id" title="variable">updated_acc</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">else</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Grandpa.Votes.html#acc:148"><span class="id" title="variable">acc</span></a>.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <a id="flat_votes_dictionary" class="idref" href="#flat_votes_dictionary"><span class="id" title="definition">flat_votes_dictionary</span></a> <br/>
&nbsp;&nbsp;(<a id="last_block_number:156" class="idref" href="#last_block_number:156"><span class="id" title="binder">last_block_number</span></a>:<a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a>) <br/>
&nbsp;&nbsp;(<a id="acc:157" class="idref" href="#acc:157"><span class="id" title="binder">acc</span></a>:<a class="idref" href="Grandpa.Votes.html#BlockDictionary"><span class="id" title="definition">BlockDictionary</span></a>) : <a class="idref" href="Grandpa.Votes.html#BlockDictionary"><span class="id" title="definition">BlockDictionary</span></a><br/>
&nbsp;&nbsp;:= <br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Lists.List.html#fold_right"><span class="id" title="definition">List.fold_right</span></a> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">fun</span> <a id="anyblock:158" class="idref" href="#anyblock:158"><span class="id" title="binder">anyblock</span></a> <a id="updated_dict:159" class="idref" href="#updated_dict:159"><span class="id" title="binder">updated_dict</span></a> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="Grandpa.Votes.html#anyblock:158"><span class="id" title="variable">anyblock</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><span class="id" title="var">block</span><a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a><span class="id" title="var">votes_for_block</span><a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;⇒ <a class="idref" href="Grandpa.Votes.html#flat_votes_aux"><span class="id" title="definition">flat_votes_aux</span></a> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Grandpa.Votes.html#last_block_number:156"><span class="id" title="variable">last_block_number</span></a> (<a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Specif.html#projT2"><span class="id" title="definition">projT2</span></a> <span class="id" title="var">block</span>) <span class="id" title="var">votes_for_block</span> <a class="idref" href="Grandpa.Votes.html#updated_dict:159"><span class="id" title="variable">updated_dict</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Grandpa.Dictionary.html#empty"><span class="id" title="definition">Dictionary.empty</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Grandpa.Dictionary.html#to_list"><span class="id" title="definition">Dictionary.to_list</span></a> <a class="idref" href="Grandpa.Votes.html#acc:157"><span class="id" title="variable">acc</span></a> ).<br/>

<br/>
</div>

<div class="doc">

<div class="paragraph"> </div>

  Takes a set of votes and returns a dictionary of blocks
   where the value for a block is the number of votes (already flattened)
   for that block.

<div class="paragraph"> </div>

  We have to use AnyBlock here since the Dictionary 
   contains blocks of different lengths.

</div>
<div class="code">
<span class="id" title="keyword">Definition</span> <a id="count_votes" class="idref" href="#count_votes"><span class="id" title="definition">count_votes</span></a> {<a id="bizantiners_number:161" class="idref" href="#bizantiners_number:161"><span class="id" title="binder">bizantiners_number</span></a> <a id="last_block_number:162" class="idref" href="#last_block_number:162"><span class="id" title="binder">last_block_number</span></a>}<br/>
&nbsp;&nbsp;{<a id="voters:163" class="idref" href="#voters:163"><span class="id" title="binder">voters</span></a>:<a class="idref" href="Grandpa.Votes.html#Voters"><span class="id" title="inductive">Voters</span></a> <a class="idref" href="Grandpa.Votes.html#bizantiners_number:161"><span class="id" title="variable">bizantiners_number</span></a>}<br/>
&nbsp;&nbsp;{<a id="last_block:164" class="idref" href="#last_block:164"><span class="id" title="binder">last_block</span></a> : <a class="idref" href="Grandpa.Blocks.html#Block"><span class="id" title="inductive">Block</span></a> <a class="idref" href="Grandpa.Votes.html#last_block_number:162"><span class="id" title="variable">last_block_number</span></a>}<br/>
&nbsp;&nbsp;(<a id="votes:165" class="idref" href="#votes:165"><span class="id" title="binder">votes</span></a>: <a class="idref" href="Grandpa.Votes.html#Votes"><span class="id" title="inductive">Votes</span></a> <a class="idref" href="Grandpa.Votes.html#voters:163"><span class="id" title="variable">voters</span></a> <a class="idref" href="Grandpa.Votes.html#last_block:164"><span class="id" title="variable">last_block</span></a>): <a class="idref" href="Grandpa.Votes.html#BlockDictionary"><span class="id" title="definition">BlockDictionary</span></a><br/>
&nbsp;&nbsp;:=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="Grandpa.Votes.html#make_votes_dictionary"><span class="id" title="definition">make_votes_dictionary</span></a> (<a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Lists.List.html#map"><span class="id" title="definition">List.map</span></a> <a class="idref" href="Grandpa.Votes.html#vote_to_block"><span class="id" title="definition">vote_to_block</span></a> (<a class="idref" href="Grandpa.Votes.html#votes_to_list"><span class="id" title="definition">votes_to_list</span></a> <a class="idref" href="Grandpa.Votes.html#votes:165"><span class="id" title="variable">votes</span></a>)) <a class="idref" href="Grandpa.Dictionary.html#empty"><span class="id" title="definition">Dictionary.empty</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">out</span> ⇒ <a class="idref" href="Grandpa.Votes.html#flat_votes_dictionary"><span class="id" title="definition">flat_votes_dictionary</span></a> <a class="idref" href="Grandpa.Votes.html#last_block_number:162"><span class="id" title="variable">last_block_number</span></a> <span class="id" title="var">out</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a id="count_votes_nil_is_zero" class="idref" href="#count_votes_nil_is_zero"><span class="id" title="lemma">count_votes_nil_is_zero</span></a> {<a id="bizantiners_number:166" class="idref" href="#bizantiners_number:166"><span class="id" title="binder">bizantiners_number</span></a> <a id="last_block_number:167" class="idref" href="#last_block_number:167"><span class="id" title="binder">last_block_number</span></a>}<br/>
&nbsp;&nbsp;{<a id="voters:168" class="idref" href="#voters:168"><span class="id" title="binder">voters</span></a>:<a class="idref" href="Grandpa.Votes.html#Voters"><span class="id" title="inductive">Voters</span></a> <a class="idref" href="Grandpa.Votes.html#bizantiners_number:166"><span class="id" title="variable">bizantiners_number</span></a>}<br/>
&nbsp;&nbsp;{<a id="last_block:169" class="idref" href="#last_block:169"><span class="id" title="binder">last_block</span></a> : <a class="idref" href="Grandpa.Blocks.html#Block"><span class="id" title="inductive">Block</span></a> <a class="idref" href="Grandpa.Votes.html#last_block_number:167"><span class="id" title="variable">last_block_number</span></a>}<br/>
&nbsp;&nbsp;(<a id="votes:170" class="idref" href="#votes:170"><span class="id" title="binder">votes</span></a>: <a class="idref" href="Grandpa.Votes.html#Votes"><span class="id" title="inductive">Votes</span></a> <a class="idref" href="Grandpa.Votes.html#voters:168"><span class="id" title="variable">voters</span></a> <a class="idref" href="Grandpa.Votes.html#last_block:169"><span class="id" title="variable">last_block</span></a>)<br/>
&nbsp;&nbsp;: <a class="idref" href="Grandpa.Votes.html#votes_to_list"><span class="id" title="definition">votes_to_list</span></a> <a class="idref" href="Grandpa.Votes.html#votes:170"><span class="id" title="variable">votes</span></a> <a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Datatypes.html#nil"><span class="id" title="constructor">nil</span></a> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="Grandpa.Dictionary.html#to_list"><span class="id" title="definition">Dictionary.to_list</span></a> (<a class="idref" href="Grandpa.Votes.html#count_votes"><span class="id" title="definition">count_votes</span></a> <a class="idref" href="Grandpa.Votes.html#votes:170"><span class="id" title="variable">votes</span></a>) <a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Datatypes.html#nil"><span class="id" title="constructor">nil</span></a>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a id="count_votes_works" class="idref" href="#count_votes_works"><span class="id" title="lemma">count_votes_works</span></a> {<a id="bizantiners_number:171" class="idref" href="#bizantiners_number:171"><span class="id" title="binder">bizantiners_number</span></a> <a id="last_block_number:172" class="idref" href="#last_block_number:172"><span class="id" title="binder">last_block_number</span></a>}<br/>
&nbsp;&nbsp;{<a id="block_number:173" class="idref" href="#block_number:173"><span class="id" title="binder">block_number</span></a>:<a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a>}<br/>
&nbsp;&nbsp;(<a id="block:174" class="idref" href="#block:174"><span class="id" title="binder">block</span></a>: <a class="idref" href="Grandpa.Blocks.html#Block"><span class="id" title="inductive">Block</span></a> <a class="idref" href="Grandpa.Votes.html#block_number:173"><span class="id" title="variable">block_number</span></a>)<br/>
&nbsp;&nbsp;{<a id="voters:175" class="idref" href="#voters:175"><span class="id" title="binder">voters</span></a>:<a class="idref" href="Grandpa.Votes.html#Voters"><span class="id" title="inductive">Voters</span></a> <a class="idref" href="Grandpa.Votes.html#bizantiners_number:171"><span class="id" title="variable">bizantiners_number</span></a>}<br/>
&nbsp;&nbsp;{<a id="last_block:176" class="idref" href="#last_block:176"><span class="id" title="binder">last_block</span></a> : <a class="idref" href="Grandpa.Blocks.html#Block"><span class="id" title="inductive">Block</span></a> <a class="idref" href="Grandpa.Votes.html#last_block_number:172"><span class="id" title="variable">last_block_number</span></a>}<br/>
&nbsp;&nbsp;(<a id="votes:177" class="idref" href="#votes:177"><span class="id" title="binder">votes</span></a>:<a class="idref" href="Grandpa.Votes.html#Votes"><span class="id" title="inductive">Votes</span></a> <a class="idref" href="Grandpa.Votes.html#voters:175"><span class="id" title="variable">voters</span></a> <a class="idref" href="Grandpa.Votes.html#last_block:176"><span class="id" title="variable">last_block</span></a>)<br/>
&nbsp;&nbsp;:<br/>
&nbsp;&nbsp;<a class="idref" href="Grandpa.Votes.html#some_to_nat"><span class="id" title="definition">some_to_nat</span></a>(<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Grandpa.Dictionary.html#lookup"><span class="id" title="definition">Dictionary.lookup</span></a> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Grandpa.Blocks.html#anyblock_eqb"><span class="id" title="definition">anyblock_eqb</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Specif.html#existT"><span class="id" title="constructor">existT</span></a> <span class="id" title="var">_</span> <a class="idref" href="Grandpa.Votes.html#block_number:173"><span class="id" title="variable">block_number</span></a> <a class="idref" href="Grandpa.Votes.html#block:174"><span class="id" title="variable">block</span></a>) <br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Grandpa.Votes.html#count_votes"><span class="id" title="definition">count_votes</span></a> <a class="idref" href="Grandpa.Votes.html#votes:177"><span class="id" title="variable">votes</span></a>)<br/>
&nbsp;&nbsp;)<br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a><a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Datatypes.html#length"><span class="id" title="definition">length</span></a> (<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Lists.List.html#filter"><span class="id" title="definition">List.filter</span></a> (<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">fun</span> <a id="vote:178" class="idref" href="#vote:178"><span class="id" title="binder">vote</span></a> ⇒ <a class="idref" href="Grandpa.Blocks.html#is_prefix"><span class="id" title="definition">is_prefix</span></a> <a class="idref" href="Grandpa.Votes.html#block:174"><span class="id" title="variable">block</span></a> (<a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Specif.html#projT2"><span class="id" title="definition">projT2</span></a> (<a class="idref" href="Grandpa.Votes.html#vote_to_block"><span class="id" title="definition">vote_to_block</span></a> <a class="idref" href="Grandpa.Votes.html#vote:178"><span class="id" title="variable">vote</span></a>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Grandpa.Votes.html#votes_to_list"><span class="id" title="definition">votes_to_list</span></a> <a class="idref" href="Grandpa.Votes.html#votes:177"><span class="id" title="variable">votes</span></a>) <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;).<br/>

<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a id="voted_block_in_count_votes" class="idref" href="#voted_block_in_count_votes"><span class="id" title="lemma">voted_block_in_count_votes</span></a> {<a id="bizantiners_number:179" class="idref" href="#bizantiners_number:179"><span class="id" title="binder">bizantiners_number</span></a> <a id="last_block_number:180" class="idref" href="#last_block_number:180"><span class="id" title="binder">last_block_number</span></a>}<br/>
&nbsp;&nbsp;{<a id="voters:181" class="idref" href="#voters:181"><span class="id" title="binder">voters</span></a>:<a class="idref" href="Grandpa.Votes.html#Voters"><span class="id" title="inductive">Voters</span></a> <a class="idref" href="Grandpa.Votes.html#bizantiners_number:179"><span class="id" title="variable">bizantiners_number</span></a>}<br/>
&nbsp;&nbsp;{<a id="last_block:182" class="idref" href="#last_block:182"><span class="id" title="binder">last_block</span></a> : <a class="idref" href="Grandpa.Blocks.html#Block"><span class="id" title="inductive">Block</span></a> <a class="idref" href="Grandpa.Votes.html#last_block_number:180"><span class="id" title="variable">last_block_number</span></a>}<br/>
&nbsp;&nbsp;(<a id="votes:183" class="idref" href="#votes:183"><span class="id" title="binder">votes</span></a>: <a class="idref" href="Grandpa.Votes.html#Votes"><span class="id" title="inductive">Votes</span></a> <a class="idref" href="Grandpa.Votes.html#voters:181"><span class="id" title="variable">voters</span></a> <a class="idref" href="Grandpa.Votes.html#last_block:182"><span class="id" title="variable">last_block</span></a>)<br/>
&nbsp;&nbsp;{<a id="voter:184" class="idref" href="#voter:184"><span class="id" title="binder">voter</span></a>:<a class="idref" href="Grandpa.Votes.html#Voter"><span class="id" title="definition">Voter</span></a> }<br/>
&nbsp;&nbsp;{<a id="is_voter:185" class="idref" href="#is_voter:185"><span class="id" title="binder">is_voter</span></a>: <a class="idref" href="Grandpa.Votes.html#in_Voters"><span class="id" title="definition">in_Voters</span></a> <a class="idref" href="Grandpa.Votes.html#voter:184"><span class="id" title="variable">voter</span></a> <a class="idref" href="Grandpa.Votes.html#voters:181"><span class="id" title="variable">voters</span></a>}<br/>
&nbsp;&nbsp;{<a id="block_number:186" class="idref" href="#block_number:186"><span class="id" title="binder">block_number</span></a>:<a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a>}<br/>
&nbsp;&nbsp;{<a id="block:187" class="idref" href="#block:187"><span class="id" title="binder">block</span></a>: <a class="idref" href="Grandpa.Blocks.html#Block"><span class="id" title="inductive">Block</span></a> <a class="idref" href="Grandpa.Votes.html#block_number:186"><span class="id" title="variable">block_number</span></a>}<br/>
&nbsp;&nbsp;{<a id="is_prefix_proof:188" class="idref" href="#is_prefix_proof:188"><span class="id" title="binder">is_prefix_proof</span></a>: <a class="idref" href="Grandpa.Votes.html#last_block:182"><span class="id" title="variable">last_block</span></a> <a class="idref" href="Grandpa.Blocks.html#504547c1b15cb9ae8a3c384c85ac7d6e"><span class="id" title="notation">≤</span></a> <a class="idref" href="Grandpa.Votes.html#block:187"><span class="id" title="variable">block</span></a>}<br/>
&nbsp;&nbsp;(<a id="vote:189" class="idref" href="#vote:189"><span class="id" title="binder">vote</span></a>: <a class="idref" href="Grandpa.Votes.html#Vote"><span class="id" title="inductive">Vote</span></a> <a class="idref" href="Grandpa.Votes.html#voters:181"><span class="id" title="variable">voters</span></a> <a class="idref" href="Grandpa.Votes.html#last_block:182"><span class="id" title="variable">last_block</span></a>)<br/>
&nbsp;&nbsp;{<a id="vote_is:190" class="idref" href="#vote_is:190"><span class="id" title="binder">vote_is</span></a>: <a class="idref" href="Grandpa.Votes.html#vote:189"><span class="id" title="variable">vote</span></a> <a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Grandpa.Votes.html#VoteC"><span class="id" title="constructor">VoteC</span></a> <a class="idref" href="Grandpa.Votes.html#voters:181"><span class="id" title="variable">voters</span></a> <a class="idref" href="Grandpa.Votes.html#last_block:182"><span class="id" title="variable">last_block</span></a> <a class="idref" href="Grandpa.Votes.html#voter:184"><span class="id" title="variable">voter</span></a> <a class="idref" href="Grandpa.Votes.html#is_voter:185"><span class="id" title="variable">is_voter</span></a> <a class="idref" href="Grandpa.Votes.html#block:187"><span class="id" title="variable">block</span></a> <a class="idref" href="Grandpa.Votes.html#is_prefix_proof:188"><span class="id" title="variable">is_prefix_proof</span></a>}<br/>
&nbsp;&nbsp;(<a id="is_vote:191" class="idref" href="#is_vote:191"><span class="id" title="binder">is_vote</span></a> : <a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Lists.List.html#In"><span class="id" title="definition">List.In</span></a> <a class="idref" href="Grandpa.Votes.html#vote:189"><span class="id" title="variable">vote</span></a> (<a class="idref" href="Grandpa.Votes.html#votes_to_list"><span class="id" title="definition">votes_to_list</span></a> <a class="idref" href="Grandpa.Votes.html#votes:183"><span class="id" title="variable">votes</span></a>))<br/>
&nbsp;&nbsp;: <a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">∃</span></a> <a id="v:192" class="idref" href="#v:192"><span class="id" title="binder">v</span></a>:<a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">,</span></a> <a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Lists.List.html#In"><span class="id" title="definition">List.In</span></a> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Specif.html#existT"><span class="id" title="constructor">existT</span></a> <span class="id" title="var">_</span> <a class="idref" href="Grandpa.Votes.html#block_number:186"><span class="id" title="variable">block_number</span></a> <a class="idref" href="Grandpa.Votes.html#block:187"><span class="id" title="variable">block</span></a><a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a><a class="idref" href="Grandpa.Votes.html#v:192"><span class="id" title="variable">v</span></a><a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Grandpa.Dictionary.html#to_list"><span class="id" title="definition">Dictionary.to_list</span></a> (<a class="idref" href="Grandpa.Votes.html#count_votes"><span class="id" title="definition">count_votes</span></a> <a class="idref" href="Grandpa.Votes.html#votes:183"><span class="id" title="variable">votes</span></a>)).<br/>

<br/>
</div>

<div class="doc">
  This is the core function implementing supermajority.

<div class="paragraph"> </div>

   From the paper: 

<div class="paragraph"> </div>

<pre>
A voter equivocates in a set of votes [S] if they have cast multiple different 
votes in [S] . We call a set [S] of votes safe if the number of voters 
who equivocate in [S] is at most [f] . We say that [S] has a [supermajority]
for a block [B] if the set of voters who either have a vote for 
blocks [&gt;= B] or equivocate in [S] has size at least [(n+f + 1)/2]. 
We count equivocations as votes for everything so that observing a vote 
is monotonic, meaning that if [S ⊂ T] then if [S] has a supermajority 
for [B] so does [T] , while being able to ignore yet more equivocating votes
from an equivocating voter.
</pre>

<div class="paragraph"> </div>

Our implementation aproach is as follows:

<div class="paragraph"> </div>

<ul class="doclist">
<li> Find the equivocate votes and the ones that aren't equivocate.

</li>
<li> Count the non equivocate votes for every block.

</li>
<li> Remove blocks that don't have at least <span class="inlinecode">(<span class="id" title="var">n</span>+<span class="id" title="var">f</span>+1)/2</span> votes.
      In this case <span class="inlinecode"><span class="id" title="var">n</span>:=<a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Datatypes.html#length"><span class="id" title="definition">length</span></a></span> <span class="inlinecode"><a class="idref" href="Grandpa.Votes.html#Some.voters"><span class="id" title="variable">voters</span></a></span> and <span class="inlinecode"><span class="id" title="var">f</span>:=</span> <span class="inlinecode"><span class="id" title="var">bizantiners_number</span></span>

</li>
</ul>

</div>
<div class="code">

<br/>
<span class="id" title="keyword">Definition</span> <a id="has_supermajority_predicate" class="idref" href="#has_supermajority_predicate"><span class="id" title="definition">has_supermajority_predicate</span></a> {<a id="bizantiners_number:193" class="idref" href="#bizantiners_number:193"><span class="id" title="binder">bizantiners_number</span></a>}<br/>
&nbsp;&nbsp;(<a id="voters:194" class="idref" href="#voters:194"><span class="id" title="binder">voters</span></a>:<a class="idref" href="Grandpa.Votes.html#Voters"><span class="id" title="inductive">Voters</span></a> <a class="idref" href="Grandpa.Votes.html#bizantiners_number:193"><span class="id" title="variable">bizantiners_number</span></a>)<br/>
&nbsp;&nbsp;(<a id="number_of_equivocates:195" class="idref" href="#number_of_equivocates:195"><span class="id" title="binder">number_of_equivocates</span></a>:<a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a>)<br/>
&nbsp;&nbsp;(<a id="block_and_vote:196" class="idref" href="#block_and_vote:196"><span class="id" title="binder">block_and_vote</span></a>:<a class="idref" href="Grandpa.Blocks.html#AnyBlock"><span class="id" title="definition">AnyBlock</span></a><a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Datatypes.html#11c698c8685bb8ab1cf725545c085ac4"><span class="id" title="notation">×</span></a><a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a>) : <a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Datatypes.html#bool"><span class="id" title="inductive">bool</span></a>:= <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="Grandpa.Votes.html#block_and_vote:196"><span class="id" title="variable">block_and_vote</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><span class="id" title="var">_</span><a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <span class="id" title="var">number_of_votes</span><a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;⇒ <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Grandpa.Votes.html#voters_length"><span class="id" title="definition">voters_length</span></a> <a class="idref" href="Grandpa.Votes.html#voters:194"><span class="id" title="variable">voters</span></a> <a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Nat.html#0dacc1786c5ba797d47dd85006231633"><span class="id" title="notation">+</span></a> <a class="idref" href="Grandpa.Votes.html#bizantiners_number:193"><span class="id" title="variable">bizantiners_number</span></a> <a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Nat.html#0dacc1786c5ba797d47dd85006231633"><span class="id" title="notation">+</span></a>1 <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Nat.html#6b7621b45fff0af5e2b2cbb2bc2d4e1d"><span class="id" title="notation">&lt;?</span></a> 2 <a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Nat.html#ea2ff3d561159081cea6fb2e8113cc54"><span class="id" title="notation">×</span></a> <a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Nat.html#ea2ff3d561159081cea6fb2e8113cc54"><span class="id" title="notation">(</span></a><span class="id" title="var">number_of_votes</span> <a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Nat.html#0dacc1786c5ba797d47dd85006231633"><span class="id" title="notation">+</span></a> <a class="idref" href="Grandpa.Votes.html#number_of_equivocates:195"><span class="id" title="variable">number_of_equivocates</span></a><a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Nat.html#ea2ff3d561159081cea6fb2e8113cc54"><span class="id" title="notation">)</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <a id="get_supermajority_blocks" class="idref" href="#get_supermajority_blocks"><span class="id" title="definition">get_supermajority_blocks</span></a> {<a id="bizantiners_number:198" class="idref" href="#bizantiners_number:198"><span class="id" title="binder">bizantiners_number</span></a> <a id="last_block_number:199" class="idref" href="#last_block_number:199"><span class="id" title="binder">last_block_number</span></a>}<br/>
&nbsp;&nbsp;{<a id="voters:200" class="idref" href="#voters:200"><span class="id" title="binder">voters</span></a>:<a class="idref" href="Grandpa.Votes.html#Voters"><span class="id" title="inductive">Voters</span></a> <a class="idref" href="Grandpa.Votes.html#bizantiners_number:198"><span class="id" title="variable">bizantiners_number</span></a>}<br/>
&nbsp;&nbsp;{<a id="last_block:201" class="idref" href="#last_block:201"><span class="id" title="binder">last_block</span></a> : <a class="idref" href="Grandpa.Blocks.html#Block"><span class="id" title="inductive">Block</span></a> <a class="idref" href="Grandpa.Votes.html#last_block_number:199"><span class="id" title="variable">last_block_number</span></a>}<br/>
&nbsp;&nbsp;(<a id="T:202" class="idref" href="#T:202"><span class="id" title="binder">T</span></a> : <a class="idref" href="Grandpa.Votes.html#Votes"><span class="id" title="inductive">Votes</span></a> <a class="idref" href="Grandpa.Votes.html#voters:200"><span class="id" title="variable">voters</span></a> <a class="idref" href="Grandpa.Votes.html#last_block:201"><span class="id" title="variable">last_block</span></a>) <br/>
&nbsp;&nbsp;: <a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Datatypes.html#list"><span class="id" title="inductive">list</span></a> (<a class="idref" href="Grandpa.Blocks.html#AnyBlock"><span class="id" title="definition">AnyBlock</span></a> <a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Datatypes.html#11c698c8685bb8ab1cf725545c085ac4"><span class="id" title="notation">×</span></a> <a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a>)<br/>
&nbsp;&nbsp;:= <br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> (<a id="equivocate_voters:203" class="idref" href="#equivocate_voters:203"><span class="id" title="binder">equivocate_voters</span></a>, <a id="non_equivocate_voters:204" class="idref" href="#non_equivocate_voters:204"><span class="id" title="binder">non_equivocate_voters</span></a>) <br/>
&nbsp;&nbsp;&nbsp;&nbsp;:= <a class="idref" href="Grandpa.Votes.html#split_voters_by_equivocation"><span class="id" title="definition">split_voters_by_equivocation</span></a> <a class="idref" href="Grandpa.Votes.html#T:202"><span class="id" title="variable">T</span></a><br/>
&nbsp;&nbsp;<span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="number_of_equivocates:205" class="idref" href="#number_of_equivocates:205"><span class="id" title="binder">number_of_equivocates</span></a> := <a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Datatypes.html#length"><span class="id" title="definition">length</span></a> <a class="idref" href="Grandpa.Votes.html#equivocate_voters:203"><span class="id" title="variable">equivocate_voters</span></a><br/>
&nbsp;&nbsp;<span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="count:206" class="idref" href="#count:206"><span class="id" title="binder">count</span></a>  <br/>
&nbsp;&nbsp;&nbsp;&nbsp;:= <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Grandpa.Votes.html#count_votes"><span class="id" title="definition">count_votes</span></a>  <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Grandpa.Votes.html#filter_votes_by_voters_subset"><span class="id" title="definition">filter_votes_by_voters_subset</span></a> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Grandpa.Votes.html#voters:200"><span class="id" title="variable">voters</span></a> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Grandpa.Votes.html#last_block:201"><span class="id" title="variable">last_block</span></a> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Grandpa.Votes.html#T:202"><span class="id" title="variable">T</span></a> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Grandpa.Votes.html#voters_from_list"><span class="id" title="definition">voters_from_list</span></a> <a class="idref" href="Grandpa.Votes.html#bizantiners_number:198"><span class="id" title="variable">bizantiners_number</span></a> <a class="idref" href="Grandpa.Votes.html#non_equivocate_voters:204"><span class="id" title="variable">non_equivocate_voters</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>
&nbsp;&nbsp;<span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="blocks_with_super_majority:207" class="idref" href="#blocks_with_super_majority:207"><span class="id" title="binder">blocks_with_super_majority</span></a> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;:= <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Lists.List.html#filter"><span class="id" title="definition">List.filter</span></a> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Grandpa.Votes.html#has_supermajority_predicate"><span class="id" title="definition">has_supermajority_predicate</span></a> <a class="idref" href="Grandpa.Votes.html#voters:200"><span class="id" title="variable">voters</span></a> <a class="idref" href="Grandpa.Votes.html#number_of_equivocates:205"><span class="id" title="variable">number_of_equivocates</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Grandpa.Dictionary.html#to_list"><span class="id" title="definition">Dictionary.to_list</span></a> <a class="idref" href="Grandpa.Votes.html#count:206"><span class="id" title="variable">count</span></a>)<br/>
&nbsp;&nbsp;<span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Grandpa.Votes.html#blocks_with_super_majority:207"><span class="id" title="variable">blocks_with_super_majority</span></a>.<br/>

<br/>
</div>

<div class="doc">
This definition doesn't take in account the repetitions of elements

</div>
<div class="code">

<br/>
<span class="id" title="keyword">Definition</span> <a id="IsSubset" class="idref" href="#IsSubset"><span class="id" title="definition">IsSubset</span></a> {<a id="bizantiners_number:208" class="idref" href="#bizantiners_number:208"><span class="id" title="binder">bizantiners_number</span></a> <a id="last_block_number:209" class="idref" href="#last_block_number:209"><span class="id" title="binder">last_block_number</span></a>} <br/>
&nbsp;&nbsp;{<a id="voters:210" class="idref" href="#voters:210"><span class="id" title="binder">voters</span></a>:<a class="idref" href="Grandpa.Votes.html#Voters"><span class="id" title="inductive">Voters</span></a> <a class="idref" href="Grandpa.Votes.html#bizantiners_number:208"><span class="id" title="variable">bizantiners_number</span></a>}<br/>
&nbsp;&nbsp;{<a id="last_block:211" class="idref" href="#last_block:211"><span class="id" title="binder">last_block</span></a> : <a class="idref" href="Grandpa.Blocks.html#Block"><span class="id" title="inductive">Block</span></a> <a class="idref" href="Grandpa.Votes.html#last_block_number:209"><span class="id" title="variable">last_block_number</span></a>}<br/>
&nbsp;&nbsp;(<a id="S:212" class="idref" href="#S:212"><span class="id" title="binder">S</span></a> : <a class="idref" href="Grandpa.Votes.html#Votes"><span class="id" title="inductive">Votes</span></a> <a class="idref" href="Grandpa.Votes.html#voters:210"><span class="id" title="variable">voters</span></a> <a class="idref" href="Grandpa.Votes.html#last_block:211"><span class="id" title="variable">last_block</span></a>)<br/>
&nbsp;&nbsp;(<a id="T:213" class="idref" href="#T:213"><span class="id" title="binder">T</span></a> : <a class="idref" href="Grandpa.Votes.html#Votes"><span class="id" title="inductive">Votes</span></a> <a class="idref" href="Grandpa.Votes.html#voters:210"><span class="id" title="variable">voters</span></a> <a class="idref" href="Grandpa.Votes.html#last_block:211"><span class="id" title="variable">last_block</span></a>) <br/>
&nbsp;&nbsp;:<span class="id" title="keyword">Prop</span><br/>
&nbsp;&nbsp;:=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">∀</span> (<a id="vote:214" class="idref" href="#vote:214"><span class="id" title="binder">vote</span></a>: <a class="idref" href="Grandpa.Votes.html#Vote"><span class="id" title="inductive">Vote</span></a> <a class="idref" href="Grandpa.Votes.html#voters:210"><span class="id" title="variable">voters</span></a> <a class="idref" href="Grandpa.Votes.html#last_block:211"><span class="id" title="variable">last_block</span></a>), <br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Grandpa.ListFacts.html#count"><span class="id" title="definition">count</span></a> <a class="idref" href="Grandpa.Votes.html#vote_eqb"><span class="id" title="definition">vote_eqb</span></a> <a class="idref" href="Grandpa.Votes.html#vote:214"><span class="id" title="variable">vote</span></a>  (<a class="idref" href="Grandpa.Votes.html#votes_to_list"><span class="id" title="definition">votes_to_list</span></a> <a class="idref" href="Grandpa.Votes.html#S:212"><span class="id" title="variable">S</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Peano.html#cb53cf0ee22c036a03b4a9281c68b5a3"><span class="id" title="notation">≤</span></a> <a class="idref" href="Grandpa.ListFacts.html#count"><span class="id" title="definition">count</span></a> <a class="idref" href="Grandpa.Votes.html#vote_eqb"><span class="id" title="definition">vote_eqb</span></a> <a class="idref" href="Grandpa.Votes.html#vote:214"><span class="id" title="variable">vote</span></a> (<a class="idref" href="Grandpa.Votes.html#votes_to_list"><span class="id" title="definition">votes_to_list</span></a> <a class="idref" href="Grandpa.Votes.html#T:213"><span class="id" title="variable">T</span></a>))%<span class="id" title="var">nat</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a id="equivocates_are_voters_aux" class="idref" href="#equivocates_are_voters_aux"><span class="id" title="lemma">equivocates_are_voters_aux</span></a> {<a id="A:215" class="idref" href="#A:215"><span class="id" title="binder">A</span></a>} (<a id="l:216" class="idref" href="#l:216"><span class="id" title="binder">l</span></a> <a id="l1:217" class="idref" href="#l1:217"><span class="id" title="binder">l1</span></a> <a id="l2:218" class="idref" href="#l2:218"><span class="id" title="binder">l2</span></a>:<a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Datatypes.html#list"><span class="id" title="inductive">list</span></a> <a class="idref" href="Grandpa.Votes.html#A:215"><span class="id" title="variable">A</span></a>) <a id="p:219" class="idref" href="#p:219"><span class="id" title="binder">p</span></a> <br/>
&nbsp;&nbsp;: <br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Lists.List.html#partition"><span class="id" title="definition">List.partition</span></a> <a class="idref" href="Grandpa.Votes.html#p:219"><span class="id" title="variable">p</span></a> <a class="idref" href="Grandpa.Votes.html#l:216"><span class="id" title="variable">l</span></a> <a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="Grandpa.Votes.html#l1:217"><span class="id" title="variable">l1</span></a><a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a><a class="idref" href="Grandpa.Votes.html#l2:218"><span class="id" title="variable">l2</span></a><a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a> <span class="id" title="keyword">∀</span> <a id="x:220" class="idref" href="#x:220"><span class="id" title="binder">x</span></a>, <a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Lists.List.html#In"><span class="id" title="definition">List.In</span></a> <a class="idref" href="Grandpa.Votes.html#x:220"><span class="id" title="variable">x</span></a> <a class="idref" href="Grandpa.Votes.html#l1:217"><span class="id" title="variable">l1</span></a> <br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="Grandpa.Votes.html#p:219"><span class="id" title="variable">p</span></a> <a class="idref" href="Grandpa.Votes.html#x:220"><span class="id" title="variable">x</span></a> <a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Datatypes.html#true"><span class="id" title="constructor">true</span></a>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a id="equivocates_are_voters" class="idref" href="#equivocates_are_voters"><span class="id" title="lemma">equivocates_are_voters</span></a> {<a id="bizantiners_number:221" class="idref" href="#bizantiners_number:221"><span class="id" title="binder">bizantiners_number</span></a> <a id="last_block_number:222" class="idref" href="#last_block_number:222"><span class="id" title="binder">last_block_number</span></a>}<br/>
&nbsp;&nbsp;{<a id="voters:223" class="idref" href="#voters:223"><span class="id" title="binder">voters</span></a>:<a class="idref" href="Grandpa.Votes.html#Voters"><span class="id" title="inductive">Voters</span></a> <a class="idref" href="Grandpa.Votes.html#bizantiners_number:221"><span class="id" title="variable">bizantiners_number</span></a>}<br/>
&nbsp;&nbsp;{<a id="last_block:224" class="idref" href="#last_block:224"><span class="id" title="binder">last_block</span></a> : <a class="idref" href="Grandpa.Blocks.html#Block"><span class="id" title="inductive">Block</span></a> <a class="idref" href="Grandpa.Votes.html#last_block_number:222"><span class="id" title="variable">last_block_number</span></a>}<br/>
&nbsp;&nbsp;(<a id="T:225" class="idref" href="#T:225"><span class="id" title="binder">T</span></a> : <a class="idref" href="Grandpa.Votes.html#Votes"><span class="id" title="inductive">Votes</span></a> <a class="idref" href="Grandpa.Votes.html#voters:223"><span class="id" title="variable">voters</span></a> <a class="idref" href="Grandpa.Votes.html#last_block:224"><span class="id" title="variable">last_block</span></a>) <br/>
&nbsp;&nbsp;{<a id="equivocate_voters:226" class="idref" href="#equivocate_voters:226"><span class="id" title="binder">equivocate_voters</span></a> <a id="non_equivocate_voters:227" class="idref" href="#non_equivocate_voters:227"><span class="id" title="binder">non_equivocate_voters</span></a>: <a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Datatypes.html#list"><span class="id" title="inductive">list</span></a> <a class="idref" href="Grandpa.Votes.html#Voter"><span class="id" title="definition">Voter</span></a>}<br/>
&nbsp;&nbsp;{<a id="split_result:228" class="idref" href="#split_result:228"><span class="id" title="binder">split_result</span></a>: <a class="idref" href="Grandpa.Votes.html#split_voters_by_equivocation"><span class="id" title="definition">split_voters_by_equivocation</span></a> <a class="idref" href="Grandpa.Votes.html#T:225"><span class="id" title="variable">T</span></a> <a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="Grandpa.Votes.html#equivocate_voters:226"><span class="id" title="variable">equivocate_voters</span></a><a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a><a class="idref" href="Grandpa.Votes.html#non_equivocate_voters:227"><span class="id" title="variable">non_equivocate_voters</span></a><a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a>}<br/>
&nbsp;&nbsp;: <span class="id" title="keyword">∀</span> (<a id="voter:229" class="idref" href="#voter:229"><span class="id" title="binder">voter</span></a>:<a class="idref" href="Grandpa.Votes.html#Voter"><span class="id" title="definition">Voter</span></a>), <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Lists.List.html#In"><span class="id" title="definition">List.In</span></a> <a class="idref" href="Grandpa.Votes.html#voter:229"><span class="id" title="variable">voter</span></a> <a class="idref" href="Grandpa.Votes.html#equivocate_voters:226"><span class="id" title="variable">equivocate_voters</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Lists.List.html#In"><span class="id" title="definition">List.In</span></a> <a class="idref" href="Grandpa.Votes.html#voter:229"><span class="id" title="variable">voter</span></a> (<a class="idref" href="Grandpa.Votes.html#votes_to_voters_list"><span class="id" title="definition">votes_to_voters_list</span></a> <a class="idref" href="Grandpa.Votes.html#T:225"><span class="id" title="variable">T</span></a>).<br/>

<br/>
</div>

<div class="doc">
   S ⊂ T =&gt; eqivocates_in_S ⊂ equivocates_in_T

</div>
<div class="code">

<br/>
</div>

<div class="doc">
From the paper:

<div class="paragraph"> </div>

<pre>
We count equivocations as votes for everything so that observing a vote is 
monotonic, meaning that if [S ⊂ T] then if [S] has a supermajority 
for [B] so does [T] , while being able to ignore yet more equivocating votes 
from an equivocating voter.
</pre>

<div class="paragraph"> </div>


</div>
<div class="code">
<span class="id" title="keyword">Lemma</span> <a id="blocks_with_super_majority_are_related" class="idref" href="#blocks_with_super_majority_are_related"><span class="id" title="lemma">blocks_with_super_majority_are_related</span></a> {<a id="bizantiners_number:234" class="idref" href="#bizantiners_number:234"><span class="id" title="binder">bizantiners_number</span></a> <a id="last_block_number:235" class="idref" href="#last_block_number:235"><span class="id" title="binder">last_block_number</span></a>}<br/>
&nbsp;&nbsp;{<a id="voters:236" class="idref" href="#voters:236"><span class="id" title="binder">voters</span></a>:<a class="idref" href="Grandpa.Votes.html#Voters"><span class="id" title="inductive">Voters</span></a> <a class="idref" href="Grandpa.Votes.html#bizantiners_number:234"><span class="id" title="variable">bizantiners_number</span></a>}<br/>
&nbsp;&nbsp;{<a id="last_block:237" class="idref" href="#last_block:237"><span class="id" title="binder">last_block</span></a> : <a class="idref" href="Grandpa.Blocks.html#Block"><span class="id" title="inductive">Block</span></a> <a class="idref" href="Grandpa.Votes.html#last_block_number:235"><span class="id" title="variable">last_block_number</span></a>}<br/>
&nbsp;&nbsp;(<a id="T:238" class="idref" href="#T:238"><span class="id" title="binder">T</span></a> : <a class="idref" href="Grandpa.Votes.html#Votes"><span class="id" title="inductive">Votes</span></a> <a class="idref" href="Grandpa.Votes.html#voters:236"><span class="id" title="variable">voters</span></a> <a class="idref" href="Grandpa.Votes.html#last_block:237"><span class="id" title="variable">last_block</span></a>) <br/>
&nbsp;&nbsp;(<a id="is_safe_t:239" class="idref" href="#is_safe_t:239"><span class="id" title="binder">is_safe_t</span></a>: <a class="idref" href="Grandpa.Votes.html#is_safe"><span class="id" title="definition">is_safe</span></a> <a class="idref" href="Grandpa.Votes.html#T:238"><span class="id" title="variable">T</span></a> <a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Datatypes.html#true"><span class="id" title="constructor">true</span></a>)<br/>
&nbsp;&nbsp;: <span class="id" title="keyword">∀</span> (<a id="block1:240" class="idref" href="#block1:240"><span class="id" title="binder">block1</span></a> <a id="block2:241" class="idref" href="#block2:241"><span class="id" title="binder">block2</span></a>:<a class="idref" href="Grandpa.Blocks.html#AnyBlock"><span class="id" title="definition">AnyBlock</span></a>) (<a id="v1:242" class="idref" href="#v1:242"><span class="id" title="binder">v1</span></a> <a id="v2:243" class="idref" href="#v2:243"><span class="id" title="binder">v2</span></a>:<a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a>), <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Lists.List.html#In"><span class="id" title="definition">List.In</span></a> <a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="Grandpa.Votes.html#block1:240"><span class="id" title="variable">block1</span></a><a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a><a class="idref" href="Grandpa.Votes.html#v1:242"><span class="id" title="variable">v1</span></a><a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> (<a class="idref" href="Grandpa.Votes.html#get_supermajority_blocks"><span class="id" title="definition">get_supermajority_blocks</span></a> <a class="idref" href="Grandpa.Votes.html#T:238"><span class="id" title="variable">T</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Lists.List.html#In"><span class="id" title="definition">List.In</span></a> <a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="Grandpa.Votes.html#block2:241"><span class="id" title="variable">block2</span></a><a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a><a class="idref" href="Grandpa.Votes.html#v2:243"><span class="id" title="variable">v2</span></a><a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> (<a class="idref" href="Grandpa.Votes.html#get_supermajority_blocks"><span class="id" title="definition">get_supermajority_blocks</span></a> <a class="idref" href="Grandpa.Votes.html#T:238"><span class="id" title="variable">T</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="Grandpa.Blocks.html#81e660aade3f2d7ad6d955d42883c466"><span class="id" title="notation">(</span></a><a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Specif.html#projT2"><span class="id" title="definition">projT2</span></a> <a class="idref" href="Grandpa.Votes.html#block1:240"><span class="id" title="variable">block1</span></a><a class="idref" href="Grandpa.Blocks.html#81e660aade3f2d7ad6d955d42883c466"><span class="id" title="notation">)</span></a> <a class="idref" href="Grandpa.Blocks.html#81e660aade3f2d7ad6d955d42883c466"><span class="id" title="notation">¬</span></a> <a class="idref" href="Grandpa.Blocks.html#81e660aade3f2d7ad6d955d42883c466"><span class="id" title="notation">(</span></a><a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Specif.html#projT2"><span class="id" title="definition">projT2</span></a> <a class="idref" href="Grandpa.Votes.html#block2:241"><span class="id" title="variable">block2</span></a><a class="idref" href="Grandpa.Blocks.html#81e660aade3f2d7ad6d955d42883c466"><span class="id" title="notation">)</span></a>.<br/>

<br/>
<span class="id" title="keyword">Open</span> <span class="id" title="keyword">Scope</span> <span class="id" title="var">list</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a id="list_in_location" class="idref" href="#list_in_location"><span class="id" title="lemma">list_in_location</span></a> {<a id="A:244" class="idref" href="#A:244"><span class="id" title="binder">A</span></a>} (<a id="x:245" class="idref" href="#x:245"><span class="id" title="binder">x</span></a>:<a class="idref" href="Grandpa.Votes.html#A:244"><span class="id" title="variable">A</span></a>) <a id="l:246" class="idref" href="#l:246"><span class="id" title="binder">l</span></a> : <br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Lists.List.html#In"><span class="id" title="definition">List.In</span></a> <a class="idref" href="Grandpa.Votes.html#x:245"><span class="id" title="variable">x</span></a> <a class="idref" href="Grandpa.Votes.html#l:246"><span class="id" title="variable">l</span></a> <a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'&lt;-&gt;'_x"><span class="id" title="notation">↔</span></a> <a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">∃</span></a> <a id="l1:247" class="idref" href="#l1:247"><span class="id" title="binder">l1</span></a> <a id="l2:248" class="idref" href="#l2:248"><span class="id" title="binder">l2</span></a><a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">,</span></a> <a class="idref" href="Grandpa.Votes.html#l:246"><span class="id" title="variable">l</span></a> <a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Grandpa.Votes.html#l1:247"><span class="id" title="variable">l1</span></a> <a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Datatypes.html#bc347c51eaf667706ae54503b26d52c6"><span class="id" title="notation">++</span></a> <a class="idref" href="Grandpa.Votes.html#x:245"><span class="id" title="variable">x</span></a><a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Datatypes.html#::list_scope:x_'::'_x"><span class="id" title="notation">::</span></a><a class="idref" href="Grandpa.Votes.html#l2:248"><span class="id" title="variable">l2</span></a>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a id="superset_has_subset_majority_blocks_aux1" class="idref" href="#superset_has_subset_majority_blocks_aux1"><span class="id" title="lemma">superset_has_subset_majority_blocks_aux1</span></a>  <a id="l:249" class="idref" href="#l:249"><span class="id" title="binder">l</span></a> <a id="p:250" class="idref" href="#p:250"><span class="id" title="binder">p</span></a> (<a id="b:251" class="idref" href="#b:251"><span class="id" title="binder">b</span></a>:<a class="idref" href="Grandpa.Blocks.html#AnyBlock"><span class="id" title="definition">AnyBlock</span></a>) : <br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">(</span></a><a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">∃</span></a> <a id="v:252" class="idref" href="#v:252"><span class="id" title="binder">v</span></a>:<a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a><a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">,</span></a> <a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Lists.List.html#In"><span class="id" title="definition">List.In</span></a> <a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="Grandpa.Votes.html#b:251"><span class="id" title="variable">b</span></a><a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a><a class="idref" href="Grandpa.Votes.html#v:252"><span class="id" title="variable">v</span></a><a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <a class="idref" href="Grandpa.Votes.html#l:249"><span class="id" title="variable">l</span></a> <a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">∧</span></a> <a class="idref" href="Grandpa.Votes.html#p:250"><span class="id" title="variable">p</span></a> <a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="Grandpa.Votes.html#b:251"><span class="id" title="variable">b</span></a><a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a><a class="idref" href="Grandpa.Votes.html#v:252"><span class="id" title="variable">v</span></a><a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a><a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Datatypes.html#true"><span class="id" title="constructor">true</span></a> <a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">)</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">∃</span></a> <a id="v:253" class="idref" href="#v:253"><span class="id" title="binder">v</span></a>:<a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a><a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">,</span></a> <a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Lists.List.html#In"><span class="id" title="definition">List.In</span></a> <a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="Grandpa.Votes.html#b:251"><span class="id" title="variable">b</span></a><a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a><a class="idref" href="Grandpa.Votes.html#v:253"><span class="id" title="variable">v</span></a><a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> (<a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Lists.List.html#filter"><span class="id" title="definition">List.filter</span></a> <a class="idref" href="Grandpa.Votes.html#p:250"><span class="id" title="variable">p</span></a> <a class="idref" href="Grandpa.Votes.html#l:249"><span class="id" title="variable">l</span></a>).<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a id="superset_has_subset_majority_blocks" class="idref" href="#superset_has_subset_majority_blocks"><span class="id" title="lemma">superset_has_subset_majority_blocks</span></a> {<a id="bizantiners_number:254" class="idref" href="#bizantiners_number:254"><span class="id" title="binder">bizantiners_number</span></a> <a id="last_block_number:255" class="idref" href="#last_block_number:255"><span class="id" title="binder">last_block_number</span></a>}<br/>
&nbsp;&nbsp;{<a id="voters:256" class="idref" href="#voters:256"><span class="id" title="binder">voters</span></a>:<a class="idref" href="Grandpa.Votes.html#Voters"><span class="id" title="inductive">Voters</span></a> <a class="idref" href="Grandpa.Votes.html#bizantiners_number:254"><span class="id" title="variable">bizantiners_number</span></a>}<br/>
&nbsp;&nbsp;{<a id="last_block:257" class="idref" href="#last_block:257"><span class="id" title="binder">last_block</span></a> : <a class="idref" href="Grandpa.Blocks.html#Block"><span class="id" title="inductive">Block</span></a> <a class="idref" href="Grandpa.Votes.html#last_block_number:255"><span class="id" title="variable">last_block_number</span></a>}<br/>
&nbsp;&nbsp;(<a id="S:258" class="idref" href="#S:258"><span class="id" title="binder">S</span></a> : <a class="idref" href="Grandpa.Votes.html#Votes"><span class="id" title="inductive">Votes</span></a> <a class="idref" href="Grandpa.Votes.html#voters:256"><span class="id" title="variable">voters</span></a> <a class="idref" href="Grandpa.Votes.html#last_block:257"><span class="id" title="variable">last_block</span></a>) <br/>
&nbsp;&nbsp;(<a id="T:259" class="idref" href="#T:259"><span class="id" title="binder">T</span></a> : <a class="idref" href="Grandpa.Votes.html#Votes"><span class="id" title="inductive">Votes</span></a> <a class="idref" href="Grandpa.Votes.html#voters:256"><span class="id" title="variable">voters</span></a> <a class="idref" href="Grandpa.Votes.html#last_block:257"><span class="id" title="variable">last_block</span></a>) <br/>
&nbsp;&nbsp;(<a id="safe_proof:260" class="idref" href="#safe_proof:260"><span class="id" title="binder">safe_proof</span></a>: <a class="idref" href="Grandpa.Votes.html#is_safe"><span class="id" title="definition">is_safe</span></a> <a class="idref" href="Grandpa.Votes.html#T:259"><span class="id" title="variable">T</span></a><a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a><a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Datatypes.html#true"><span class="id" title="constructor">true</span></a>)<br/>
&nbsp;&nbsp;(<a id="is_subset:261" class="idref" href="#is_subset:261"><span class="id" title="binder">is_subset</span></a>: <a class="idref" href="Grandpa.Votes.html#IsSubset"><span class="id" title="definition">IsSubset</span></a> <a class="idref" href="Grandpa.Votes.html#S:258"><span class="id" title="variable">S</span></a> <a class="idref" href="Grandpa.Votes.html#T:259"><span class="id" title="variable">T</span></a>)<br/>
&nbsp;&nbsp;: <span class="id" title="keyword">∀</span> <a id="anyblock:262" class="idref" href="#anyblock:262"><span class="id" title="binder">anyblock</span></a> <a id="anyblock_votes:263" class="idref" href="#anyblock_votes:263"><span class="id" title="binder">anyblock_votes</span></a>, <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Lists.List.html#In"><span class="id" title="definition">List.In</span></a> <a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="Grandpa.Votes.html#anyblock:262"><span class="id" title="variable">anyblock</span></a><a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a><a class="idref" href="Grandpa.Votes.html#anyblock_votes:263"><span class="id" title="variable">anyblock_votes</span></a><a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> (<a class="idref" href="Grandpa.Votes.html#get_supermajority_blocks"><span class="id" title="definition">get_supermajority_blocks</span></a> <a class="idref" href="Grandpa.Votes.html#S:258"><span class="id" title="variable">S</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Specif.html#e6a434cae860987d1c5f61b342cc9e57"><span class="id" title="notation">{</span></a><a id="anyblock_votes_in_t:264" class="idref" href="#anyblock_votes_in_t:264"><span class="id" title="binder">anyblock_votes_in_t</span></a> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Specif.html#e6a434cae860987d1c5f61b342cc9e57"><span class="id" title="notation">&amp;</span></a> <a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Lists.List.html#In"><span class="id" title="definition">List.In</span></a> <a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="Grandpa.Votes.html#anyblock:262"><span class="id" title="variable">anyblock</span></a><a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a><a class="idref" href="Grandpa.Votes.html#anyblock_votes_in_t:264"><span class="id" title="variable">anyblock_votes_in_t</span></a><a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> (<a class="idref" href="Grandpa.Votes.html#get_supermajority_blocks"><span class="id" title="definition">get_supermajority_blocks</span></a> <a class="idref" href="Grandpa.Votes.html#T:259"><span class="id" title="variable">T</span></a>)<a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Specif.html#e6a434cae860987d1c5f61b342cc9e57"><span class="id" title="notation">}</span></a>.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <a id="has_supermajority" class="idref" href="#has_supermajority"><span class="id" title="definition">has_supermajority</span></a>  {<a id="bizantiners_number:265" class="idref" href="#bizantiners_number:265"><span class="id" title="binder">bizantiners_number</span></a> <a id="last_block_number:266" class="idref" href="#last_block_number:266"><span class="id" title="binder">last_block_number</span></a>}<br/>
&nbsp;&nbsp;{<a id="voters:267" class="idref" href="#voters:267"><span class="id" title="binder">voters</span></a>:<a class="idref" href="Grandpa.Votes.html#Voters"><span class="id" title="inductive">Voters</span></a> <a class="idref" href="Grandpa.Votes.html#bizantiners_number:265"><span class="id" title="variable">bizantiners_number</span></a>}<br/>
&nbsp;&nbsp;{<a id="last_block:268" class="idref" href="#last_block:268"><span class="id" title="binder">last_block</span></a> : <a class="idref" href="Grandpa.Blocks.html#Block"><span class="id" title="inductive">Block</span></a> <a class="idref" href="Grandpa.Votes.html#last_block_number:266"><span class="id" title="variable">last_block_number</span></a>}<br/>
&nbsp;&nbsp;(<a id="S:269" class="idref" href="#S:269"><span class="id" title="binder">S</span></a> : <a class="idref" href="Grandpa.Votes.html#Votes"><span class="id" title="inductive">Votes</span></a> <a class="idref" href="Grandpa.Votes.html#voters:267"><span class="id" title="variable">voters</span></a> <a class="idref" href="Grandpa.Votes.html#last_block:268"><span class="id" title="variable">last_block</span></a>) <br/>
&nbsp;&nbsp;: <a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Datatypes.html#bool"><span class="id" title="inductive">bool</span></a><br/>
&nbsp;&nbsp;:= <br/>
&nbsp;&nbsp;0 <a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Nat.html#6b7621b45fff0af5e2b2cbb2bc2d4e1d"><span class="id" title="notation">&lt;?</span></a> <a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Datatypes.html#length"><span class="id" title="definition">length</span></a> (<a class="idref" href="Grandpa.Votes.html#get_supermajority_blocks"><span class="id" title="definition">get_supermajority_blocks</span></a> <a class="idref" href="Grandpa.Votes.html#S:269"><span class="id" title="variable">S</span></a>) .<br/>

<br/>
</div>

<div class="doc">
   Since Votes is a wrap around a list, this function wraps <span class="inlinecode">++</span>.

</div>
<div class="code">
<span class="id" title="keyword">Definition</span> <a id="mergeVotes" class="idref" href="#mergeVotes"><span class="id" title="definition">mergeVotes</span></a> {<a id="bizantiners_number:270" class="idref" href="#bizantiners_number:270"><span class="id" title="binder">bizantiners_number</span></a> <a id="last_block_number:271" class="idref" href="#last_block_number:271"><span class="id" title="binder">last_block_number</span></a>}<br/>
&nbsp;&nbsp;{<a id="voters:272" class="idref" href="#voters:272"><span class="id" title="binder">voters</span></a>:<a class="idref" href="Grandpa.Votes.html#Voters"><span class="id" title="inductive">Voters</span></a> <a class="idref" href="Grandpa.Votes.html#bizantiners_number:270"><span class="id" title="variable">bizantiners_number</span></a>}<br/>
&nbsp;&nbsp;{<a id="last_block:273" class="idref" href="#last_block:273"><span class="id" title="binder">last_block</span></a> : <a class="idref" href="Grandpa.Blocks.html#Block"><span class="id" title="inductive">Block</span></a> <a class="idref" href="Grandpa.Votes.html#last_block_number:271"><span class="id" title="variable">last_block_number</span></a>}<br/>
&nbsp;&nbsp;(<a id="votes1:274" class="idref" href="#votes1:274"><span class="id" title="binder">votes1</span></a> :<a class="idref" href="Grandpa.Votes.html#Votes"><span class="id" title="inductive">Votes</span></a> <a class="idref" href="Grandpa.Votes.html#voters:272"><span class="id" title="variable">voters</span></a> <a class="idref" href="Grandpa.Votes.html#last_block:273"><span class="id" title="variable">last_block</span></a>)<br/>
&nbsp;&nbsp;(<a id="votes2:275" class="idref" href="#votes2:275"><span class="id" title="binder">votes2</span></a> :<a class="idref" href="Grandpa.Votes.html#Votes"><span class="id" title="inductive">Votes</span></a> <a class="idref" href="Grandpa.Votes.html#voters:272"><span class="id" title="variable">voters</span></a> <a class="idref" href="Grandpa.Votes.html#last_block:273"><span class="id" title="variable">last_block</span></a>)<br/>
&nbsp;&nbsp;: <a class="idref" href="Grandpa.Votes.html#Votes"><span class="id" title="inductive">Votes</span></a> <a class="idref" href="Grandpa.Votes.html#voters:272"><span class="id" title="variable">voters</span></a> <a class="idref" href="Grandpa.Votes.html#last_block:273"><span class="id" title="variable">last_block</span></a><br/>
&nbsp;&nbsp;:=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="Grandpa.Votes.html#votes1:274"><span class="id" title="variable">votes1</span></a>, <a class="idref" href="Grandpa.Votes.html#votes2:275"><span class="id" title="variable">votes2</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="Grandpa.Votes.html#VotesC"><span class="id" title="constructor">VotesC</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">list1</span>, <a class="idref" href="Grandpa.Votes.html#VotesC"><span class="id" title="constructor">VotesC</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">list2</span> ⇒ <a class="idref" href="Grandpa.Votes.html#VotesC"><span class="id" title="constructor">VotesC</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> (<span class="id" title="var">list1</span> <a class="idref" href="http://coq.inria.fr/doc/V8.19.1/stdlib//Coq.Init.Datatypes.html#bc347c51eaf667706ae54503b26d52c6"><span class="id" title="notation">++</span></a> <span class="id" title="var">list2</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">Close</span> <span class="id" title="keyword">Scope</span> <span class="id" title="var">blocks_scope</span>.<br/>
</div>
</div>

<div id="footer">
<hr/><a href="index.html">Index</a><hr/>This page has been generated by <a href="http://coq.inria.fr/">coqdoc</a>
</div>

</div>

</body>
</html>