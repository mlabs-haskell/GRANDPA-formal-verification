<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link href="coqdoc.css" rel="stylesheet" type="text/css" />
<title>Grandpa.VoterState</title>
</head>

<body>

<div id="page">

<div id="header">
</div>

<div id="main">

<h1 class="libtitle">Library Grandpa.VoterState</h1>

<div class="code">
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <a class="idref" href="Grandpa.Blocks.AnyBlock.html#"><span class="id" title="library">Blocks.AnyBlock</span></a>.<br/>
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <a class="idref" href="Grandpa.Votes.html#"><span class="id" title="library">Votes</span></a>.<br/>
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <a class="idref" href="Grandpa.Voters.html#"><span class="id" title="library">Voters</span></a>.<br/>
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <a class="idref" href="Grandpa.Round.html#"><span class="id" title="library">Round</span></a>.<br/>
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <a class="idref" href="Grandpa.OpaqueRound.html#"><span class="id" title="library">OpaqueRound</span></a>.<br/>
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <a class="idref" href="Grandpa.Message.html#"><span class="id" title="library">Message</span></a>.<br/>
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <a class="idref" href="Grandpa.RoundNumber.html#"><span class="id" title="library">RoundNumber</span></a>.<br/>
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <a class="idref" href="Grandpa.Time.html#"><span class="id" title="library">Time</span></a>.<br/>
<span class="id" title="keyword">Require</span> <a class="idref" href="Grandpa.Instances.List.html#"><span class="id" title="library">List</span></a>.<br/>

<br/>
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <a class="idref" href="Grandpa.Classes.Functor.html#"><span class="id" title="library">Classes.Functor</span></a>.<br/>
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <a class="idref" href="Grandpa.Classes.Eqb.html#"><span class="id" title="library">Classes.Eqb</span></a>.<br/>
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <a class="idref" href="Grandpa.Instances.List.html#"><span class="id" title="library">Instances.List</span></a>.<br/>

<br/>
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <a class="idref" href="Grandpa.DataTypes.Vectors.html#"><span class="id" title="library">Vectors</span></a>.<br/>

<br/>
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Arith.PeanoNat.html#"><span class="id" title="library">PeanoNat</span></a>.<br/>

<br/>
<span class="id" title="keyword">Open</span> <span class="id" title="keyword">Scope</span> <span class="id" title="var">list</span>.<br/>

<br/>
<span class="id" title="keyword">Variant</span> <a id="VoterCategory" class="idref" href="#VoterCategory"><span class="id" title="inductive">VoterCategory</span></a>  :=<br/>
&nbsp;&nbsp;| <a id="Bizantine" class="idref" href="#Bizantine"><span class="id" title="constructor">Bizantine</span></a><br/>
&nbsp;&nbsp;| <a id="Honest" class="idref" href="#Honest"><span class="id" title="constructor">Honest</span></a>.<br/>

<br/>
<span class="id" title="keyword">Variant</span> <a id="VoterVoteRight" class="idref" href="#VoterVoteRight"><span class="id" title="inductive">VoterVoteRight</span></a> := <br/>
&nbsp;&nbsp;| <a id="VotePrevote" class="idref" href="#VotePrevote"><span class="id" title="constructor">VotePrevote</span></a><br/>
&nbsp;&nbsp;| <a id="VotePrecommit" class="idref" href="#VotePrecommit"><span class="id" title="constructor">VotePrecommit</span></a><br/>
&nbsp;&nbsp;| <a id="VoteBoth" class="idref" href="#VoteBoth"><span class="id" title="constructor">VoteBoth</span></a>.<br/>

<br/>
<span class="id" title="keyword">Variant</span> <a id="VoterKind" class="idref" href="#VoterKind"><span class="id" title="inductive">VoterKind</span></a> : <span class="id" title="keyword">Type</span> := <br/>
&nbsp;&nbsp;| <a id="VoterKindC" class="idref" href="#VoterKindC"><span class="id" title="constructor">VoterKindC</span></a> (<a id="category:7" class="idref" href="#category:7"><span class="id" title="binder">category</span></a>:<a class="idref" href="Grandpa.VoterState.html#VoterCategory"><span class="id" title="inductive">VoterCategory</span></a>) (<a id="right:8" class="idref" href="#right:8"><span class="id" title="binder">right</span></a>: <a class="idref" href="Grandpa.VoterState.html#VoterVoteRight"><span class="id" title="inductive">VoterVoteRight</span></a>).<br/>

<br/>
</div>

<div class="doc">
A voter has 3 states:
<ul class="doclist">
<li> Waiting to emit prevote  <span class="inlinecode"><a class="idref" href="Grandpa.VoterState.html#prevoted_block"><span class="id" title="projection">prevoted_block</span></a></span> <span class="inlinecode">=</span> <span class="inlinecode"><a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Init.Datatypes.html#None"><span class="id" title="constructor">None</span></a></span> <span class="inlinecode"><a class="idref" href="Grandpa.VoterState.html#precommited_block"><span class="id" title="projection">precommited_block</span></a>=<a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Init.Datatypes.html#None"><span class="id" title="constructor">None</span></a></span>
<ul class="doclist">
<li> Waiting to emit precommit  <span class="inlinecode"><a class="idref" href="Grandpa.VoterState.html#precommited_block"><span class="id" title="projection">precommited_block</span></a></span> <span class="inlinecode">=</span> <span class="inlinecode"><a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Init.Datatypes.html#None"><span class="id" title="constructor">None</span></a></span>

</li>
<li> Waiting to start a new round <span class="inlinecode"><a class="idref" href="Grandpa.VoterState.html#prevoted_block"><span class="id" title="projection">prevoted_block</span></a></span> and <span class="inlinecode"><a class="idref" href="Grandpa.VoterState.html#precommited_block"><span class="id" title="projection">precommited_block</span></a></span> can be anything

</li>
</ul>

</li>
</ul>
We use the VoterKind to know the state.

<div class="paragraph"> </div>

Additionally the primary has to handle the broadcast of a 
finalized block, but this is done separately in the simulation

<div class="paragraph"> </div>

If a message for a future round arrives while we are in another round
we store it in pending_messages 

<div class="paragraph"> </div>

Later when we enter in the round, the first action of a voter 
should be to process the pending messages for the round

</div>
<div class="code">

<br/>
<span class="id" title="keyword">Record</span> <a id="VoterState" class="idref" href="#VoterState"><span class="id" title="record">VoterState</span></a> := {<br/>
&nbsp;&nbsp;<a id="round_number" class="idref" href="#round_number"><span class="id" title="projection">round_number</span></a> : <a class="idref" href="Grandpa.RoundNumber.html#RoundNumber"><span class="id" title="definition">RoundNumber</span></a><br/>
&nbsp;&nbsp;;<a id="prevoted_block" class="idref" href="#prevoted_block"><span class="id" title="projection">prevoted_block</span></a> : <a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Init.Datatypes.html#option"><span class="id" title="inductive">option</span></a> <a class="idref" href="Grandpa.Blocks.AnyBlock.html#AnyBlock"><span class="id" title="record">AnyBlock</span></a><br/>
&nbsp;&nbsp;;<a id="precommited_block" class="idref" href="#precommited_block"><span class="id" title="projection">precommited_block</span></a> : <a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Init.Datatypes.html#option"><span class="id" title="inductive">option</span></a> <a class="idref" href="Grandpa.Blocks.AnyBlock.html#AnyBlock"><span class="id" title="record">AnyBlock</span></a><br/>
&nbsp;&nbsp;</div>

<div class="doc">
We only store the last block received from a primary and we only keep the highest and latest (in that order)
</div>
<div class="code">
&nbsp;&nbsp;;<a id="last_brodcasted_block" class="idref" href="#last_brodcasted_block"><span class="id" title="projection">last_brodcasted_block</span></a> : <a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Init.Datatypes.html#option"><span class="id" title="inductive">option</span></a> <a class="idref" href="Grandpa.Blocks.AnyBlock.html#AnyBlock"><span class="id" title="record">AnyBlock</span></a> <br/>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;;<a id="rounds" class="idref" href="#rounds"><span class="id" title="projection">rounds</span></a> : <a class="idref" href="Grandpa.DataTypes.Vectors.html#Vec"><span class="id" title="definition">Vec</span></a> <a class="idref" href="Grandpa.OpaqueRound.html#OpaqueRoundState"><span class="id" title="inductive">OpaqueRoundState</span></a> (<a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Init.Datatypes.html#S"><span class="id" title="constructor">S</span></a> (<a class="idref" href="Grandpa.RoundNumber.html#to_nat"><span class="id" title="definition">RoundNumber.to_nat</span></a> <a class="idref" href="Grandpa.VoterState.html#round_number:10"><span class="id" title="method">round_number</span></a>))<br/>
&nbsp;&nbsp;;<a id="pending_messages" class="idref" href="#pending_messages"><span class="id" title="projection">pending_messages</span></a> : <a class="idref" href="Grandpa.DataTypes.Dictionary.html#Dictionary"><span class="id" title="inductive">Dictionary.Dictionary</span></a> <a class="idref" href="Grandpa.RoundNumber.html#RoundNumber"><span class="id" title="definition">RoundNumber</span></a> (<a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Init.Datatypes.html#list"><span class="id" title="inductive">list</span></a> <a class="idref" href="Grandpa.Message.html#Message"><span class="id" title="record">Message</span></a>)<br/>
&nbsp;&nbsp;;<a id="finalized_blocks" class="idref" href="#finalized_blocks"><span class="id" title="projection">finalized_blocks</span></a> : <a class="idref" href="Grandpa.DataTypes.Sets.html#DictionarySet"><span class="id" title="inductive">Sets.DictionarySet</span></a> <a class="idref" href="Grandpa.Blocks.AnyBlock.html#AnyBlock"><span class="id" title="record">AnyBlock</span></a><br/>
&nbsp;&nbsp;}.<br/>

<br/>
<span class="id" title="keyword">Local Open</span> <span class="id" title="keyword">Scope</span> <span class="id" title="var">vector_scope</span>.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <a id="make_state_zero" class="idref" href="#make_state_zero"><span class="id" title="definition">make_state_zero</span></a><br/>
&nbsp;&nbsp;(<a id="prevote_voters:17" class="idref" href="#prevote_voters:17"><span class="id" title="binder">prevote_voters</span></a>:<a class="idref" href="Grandpa.Voters.html#Voters"><span class="id" title="record">Voters</span></a>) <br/>
&nbsp;&nbsp;(<a id="preview_voters:18" class="idref" href="#preview_voters:18"><span class="id" title="binder">preview_voters</span></a>:<a class="idref" href="Grandpa.Voters.html#Voters"><span class="id" title="record">Voters</span></a>)<br/>
&nbsp;&nbsp;: <a class="idref" href="Grandpa.VoterState.html#VoterState"><span class="id" title="record">VoterState</span></a><br/>
&nbsp;&nbsp;:=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a id="round_zero:19" class="idref" href="#round_zero:19"><span class="id" title="binder">round_zero</span></a>  :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Grandpa.Round.html#InitialRoundState"><span class="id" title="constructor">InitialRoundState</span></a> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0 <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Grandpa.VoterState.html#prevote_voters:17"><span class="id" title="variable">prevote_voters</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Grandpa.VoterState.html#preview_voters:18"><span class="id" title="variable">preview_voters</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Grandpa.Time.html#from_nat"><span class="id" title="definition">Time.from_nat</span></a> 0)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Grandpa.RoundNumber.html#from_nat"><span class="id" title="definition">RoundNumber.from_nat</span></a> 0)<br/>
&nbsp;&nbsp;<span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;{|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Grandpa.VoterState.html#round_number"><span class="id" title="projection">round_number</span></a>:= (<a class="idref" href="Grandpa.RoundNumber.html#from_nat"><span class="id" title="definition">RoundNumber.from_nat</span></a> 0) <br/>
&nbsp;&nbsp;&nbsp;&nbsp;;<a class="idref" href="Grandpa.VoterState.html#prevoted_block"><span class="id" title="projection">prevoted_block</span></a> := <a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Init.Datatypes.html#None"><span class="id" title="constructor">None</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;;<a class="idref" href="Grandpa.VoterState.html#precommited_block"><span class="id" title="projection">precommited_block</span></a> := <a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Init.Datatypes.html#None"><span class="id" title="constructor">None</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;;<a class="idref" href="Grandpa.VoterState.html#last_brodcasted_block"><span class="id" title="projection">last_brodcasted_block</span></a> := <a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Init.Datatypes.html#None"><span class="id" title="constructor">None</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;;<a class="idref" href="Grandpa.VoterState.html#rounds"><span class="id" title="projection">rounds</span></a> := <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Vectors.Vector.html#cons"><span class="id" title="constructor">Vector.cons</span></a> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">_</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Grandpa.OpaqueRound.html#OpaqueRoundStateC"><span class="id" title="constructor">OpaqueRound.OpaqueRoundStateC</span></a> <a class="idref" href="Grandpa.VoterState.html#round_zero:19"><span class="id" title="variable">round_zero</span></a>) <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">_</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Vectors.Vector.html#nil"><span class="id" title="constructor">Vector.nil</span></a> <span class="id" title="var">_</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;;<a class="idref" href="Grandpa.VoterState.html#pending_messages"><span class="id" title="projection">pending_messages</span></a> := <a class="idref" href="Grandpa.DataTypes.Dictionary.html#empty"><span class="id" title="definition">Dictionary.empty</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;;<a class="idref" href="Grandpa.VoterState.html#finalized_blocks"><span class="id" title="projection">finalized_blocks</span></a> := <a class="idref" href="Grandpa.DataTypes.Sets.html#empty"><span class="id" title="definition">Sets.empty</span></a><br/>
&nbsp;&nbsp;|}.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <a id="update_last_block" class="idref" href="#update_last_block"><span class="id" title="definition">update_last_block</span></a>  (<a id="vs:20" class="idref" href="#vs:20"><span class="id" title="binder">vs</span></a>:<a class="idref" href="Grandpa.VoterState.html#VoterState"><span class="id" title="record">VoterState</span></a>) (<a id="block:21" class="idref" href="#block:21"><span class="id" title="binder">block</span></a>:<a class="idref" href="Grandpa.Blocks.AnyBlock.html#AnyBlock"><span class="id" title="record">AnyBlock</span></a>)<br/>
&nbsp;&nbsp;: <a class="idref" href="Grandpa.VoterState.html#VoterState"><span class="id" title="record">VoterState</span></a><br/>
&nbsp;&nbsp;:= <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> (<a id="block_level:22" class="idref" href="#block_level:22"><span class="id" title="binder">block_level</span></a>,<span class="id" title="var">_</span>) := <a class="idref" href="Grandpa.VoterState.html#block:21"><span class="id" title="variable">block</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="new_block:24" class="idref" href="#new_block:24"><span class="id" title="binder">new_block</span></a> := <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="Grandpa.VoterState.html#vs:20"><span class="id" title="variable">vs</span></a>.(<a class="idref" href="Grandpa.VoterState.html#last_brodcasted_block"><span class="id" title="projection">last_brodcasted_block</span></a>) <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <span class="id" title="var">old_block</span> ⇒ <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> (<a id="old_level:23" class="idref" href="#old_level:23"><span class="id" title="binder">old_level</span></a>,<span class="id" title="var">_</span>) := <span class="id" title="var">old_block</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">if</span> <a class="idref" href="Grandpa.VoterState.html#old_level:23"><span class="id" title="variable">old_level</span></a> <a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Arith.PeanoNat.html#6b7621b45fff0af5e2b2cbb2bc2d4e1d"><span class="id" title="notation">&lt;?</span></a> <a class="idref" href="Grandpa.VoterState.html#block_level:22"><span class="id" title="variable">block_level</span></a> <span class="id" title="keyword">then</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Grandpa.VoterState.html#block:21"><span class="id" title="variable">block</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">else</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">old_block</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Init.Datatypes.html#None"><span class="id" title="constructor">None</span></a> ⇒ <a class="idref" href="Grandpa.VoterState.html#block:21"><span class="id" title="variable">block</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;{|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Grandpa.VoterState.html#round_number"><span class="id" title="projection">round_number</span></a> := <a class="idref" href="Grandpa.VoterState.html#vs:20"><span class="id" title="variable">vs</span></a>.(<a class="idref" href="Grandpa.VoterState.html#round_number"><span class="id" title="projection">round_number</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;<a class="idref" href="Grandpa.VoterState.html#prevoted_block"><span class="id" title="projection">prevoted_block</span></a> := <a class="idref" href="Grandpa.VoterState.html#vs:20"><span class="id" title="variable">vs</span></a>.(<a class="idref" href="Grandpa.VoterState.html#prevoted_block"><span class="id" title="projection">prevoted_block</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;<a class="idref" href="Grandpa.VoterState.html#precommited_block"><span class="id" title="projection">precommited_block</span></a> := <a class="idref" href="Grandpa.VoterState.html#vs:20"><span class="id" title="variable">vs</span></a>.(<a class="idref" href="Grandpa.VoterState.html#precommited_block"><span class="id" title="projection">precommited_block</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;<a class="idref" href="Grandpa.VoterState.html#last_brodcasted_block"><span class="id" title="projection">last_brodcasted_block</span></a> := <a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="Grandpa.VoterState.html#new_block:24"><span class="id" title="variable">new_block</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;<a class="idref" href="Grandpa.VoterState.html#rounds"><span class="id" title="projection">rounds</span></a> := <a class="idref" href="Grandpa.VoterState.html#vs:20"><span class="id" title="variable">vs</span></a>.(<a class="idref" href="Grandpa.VoterState.html#rounds"><span class="id" title="projection">rounds</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;<a class="idref" href="Grandpa.VoterState.html#pending_messages"><span class="id" title="projection">pending_messages</span></a> := <a class="idref" href="Grandpa.VoterState.html#vs:20"><span class="id" title="variable">vs</span></a>.(<a class="idref" href="Grandpa.VoterState.html#pending_messages"><span class="id" title="projection">pending_messages</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;<a class="idref" href="Grandpa.VoterState.html#finalized_blocks"><span class="id" title="projection">finalized_blocks</span></a>:= <a class="idref" href="Grandpa.VoterState.html#vs:20"><span class="id" title="variable">vs</span></a>.(<a class="idref" href="Grandpa.VoterState.html#finalized_blocks"><span class="id" title="projection">finalized_blocks</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|}.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <a id="update_add_finalized_block" class="idref" href="#update_add_finalized_block"><span class="id" title="definition">update_add_finalized_block</span></a>  (<a id="vs:25" class="idref" href="#vs:25"><span class="id" title="binder">vs</span></a>:<a class="idref" href="Grandpa.VoterState.html#VoterState"><span class="id" title="record">VoterState</span></a>) (<a id="block:26" class="idref" href="#block:26"><span class="id" title="binder">block</span></a>:<a class="idref" href="Grandpa.Blocks.AnyBlock.html#AnyBlock"><span class="id" title="record">AnyBlock</span></a>)<br/>
&nbsp;&nbsp;: <a class="idref" href="Grandpa.VoterState.html#VoterState"><span class="id" title="record">VoterState</span></a><br/>
&nbsp;&nbsp;:= <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> (<a id="block_level:27" class="idref" href="#block_level:27"><span class="id" title="binder">block_level</span></a>,<span class="id" title="var">_</span>) := <a class="idref" href="Grandpa.VoterState.html#block:26"><span class="id" title="variable">block</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="new_block:29" class="idref" href="#new_block:29"><span class="id" title="binder">new_block</span></a> := <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="Grandpa.VoterState.html#vs:25"><span class="id" title="variable">vs</span></a>.(<a class="idref" href="Grandpa.VoterState.html#last_brodcasted_block"><span class="id" title="projection">last_brodcasted_block</span></a>) <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <span class="id" title="var">old_block</span> ⇒ <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> (<a id="old_level:28" class="idref" href="#old_level:28"><span class="id" title="binder">old_level</span></a>,<span class="id" title="var">_</span>) := <span class="id" title="var">old_block</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">if</span> <a class="idref" href="Grandpa.VoterState.html#old_level:28"><span class="id" title="variable">old_level</span></a> <a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Arith.PeanoNat.html#6b7621b45fff0af5e2b2cbb2bc2d4e1d"><span class="id" title="notation">&lt;?</span></a> <a class="idref" href="Grandpa.VoterState.html#block_level:27"><span class="id" title="variable">block_level</span></a> <span class="id" title="keyword">then</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Grandpa.VoterState.html#block:26"><span class="id" title="variable">block</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">else</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">old_block</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Init.Datatypes.html#None"><span class="id" title="constructor">None</span></a> ⇒ <a class="idref" href="Grandpa.VoterState.html#block:26"><span class="id" title="variable">block</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;{|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Grandpa.VoterState.html#round_number"><span class="id" title="projection">round_number</span></a> := <a class="idref" href="Grandpa.VoterState.html#vs:25"><span class="id" title="variable">vs</span></a>.(<a class="idref" href="Grandpa.VoterState.html#round_number"><span class="id" title="projection">round_number</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;<a class="idref" href="Grandpa.VoterState.html#prevoted_block"><span class="id" title="projection">prevoted_block</span></a> := <a class="idref" href="Grandpa.VoterState.html#vs:25"><span class="id" title="variable">vs</span></a>.(<a class="idref" href="Grandpa.VoterState.html#prevoted_block"><span class="id" title="projection">prevoted_block</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;<a class="idref" href="Grandpa.VoterState.html#precommited_block"><span class="id" title="projection">precommited_block</span></a> := <a class="idref" href="Grandpa.VoterState.html#vs:25"><span class="id" title="variable">vs</span></a>.(<a class="idref" href="Grandpa.VoterState.html#precommited_block"><span class="id" title="projection">precommited_block</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;<a class="idref" href="Grandpa.VoterState.html#last_brodcasted_block"><span class="id" title="projection">last_brodcasted_block</span></a> := <a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="Grandpa.VoterState.html#new_block:29"><span class="id" title="variable">new_block</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;<a class="idref" href="Grandpa.VoterState.html#rounds"><span class="id" title="projection">rounds</span></a> := <a class="idref" href="Grandpa.VoterState.html#vs:25"><span class="id" title="variable">vs</span></a>.(<a class="idref" href="Grandpa.VoterState.html#rounds"><span class="id" title="projection">rounds</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;<a class="idref" href="Grandpa.VoterState.html#pending_messages"><span class="id" title="projection">pending_messages</span></a> := <a class="idref" href="Grandpa.VoterState.html#vs:25"><span class="id" title="variable">vs</span></a>.(<a class="idref" href="Grandpa.VoterState.html#pending_messages"><span class="id" title="projection">pending_messages</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;<a class="idref" href="Grandpa.VoterState.html#finalized_blocks"><span class="id" title="projection">finalized_blocks</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Grandpa.DataTypes.Sets.html#add"><span class="id" title="definition">Sets.add</span></a> <a class="idref" href="Grandpa.VoterState.html#block:26"><span class="id" title="variable">block</span></a> <a class="idref" href="Grandpa.VoterState.html#vs:25"><span class="id" title="variable">vs</span></a>.(<a class="idref" href="Grandpa.VoterState.html#finalized_blocks"><span class="id" title="projection">finalized_blocks</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|}.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <a id="update_prevoted" class="idref" href="#update_prevoted"><span class="id" title="definition">update_prevoted</span></a>  (<a id="vs:30" class="idref" href="#vs:30"><span class="id" title="binder">vs</span></a>:<a class="idref" href="Grandpa.VoterState.html#VoterState"><span class="id" title="record">VoterState</span></a>) (<a id="maybe_block:31" class="idref" href="#maybe_block:31"><span class="id" title="binder">maybe_block</span></a>: <a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Init.Datatypes.html#option"><span class="id" title="inductive">option</span></a> <a class="idref" href="Grandpa.Blocks.AnyBlock.html#AnyBlock"><span class="id" title="record">AnyBlock</span></a>)<br/>
&nbsp;&nbsp;: <a class="idref" href="Grandpa.VoterState.html#VoterState"><span class="id" title="record">VoterState</span></a><br/>
&nbsp;&nbsp;:= <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Grandpa.VoterState.html#round_number"><span class="id" title="projection">round_number</span></a> := <a class="idref" href="Grandpa.VoterState.html#vs:30"><span class="id" title="variable">vs</span></a>.(<a class="idref" href="Grandpa.VoterState.html#round_number"><span class="id" title="projection">round_number</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;<a class="idref" href="Grandpa.VoterState.html#prevoted_block"><span class="id" title="projection">prevoted_block</span></a> := <a class="idref" href="Grandpa.VoterState.html#maybe_block:31"><span class="id" title="variable">maybe_block</span></a> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;<a class="idref" href="Grandpa.VoterState.html#precommited_block"><span class="id" title="projection">precommited_block</span></a> := <a class="idref" href="Grandpa.VoterState.html#vs:30"><span class="id" title="variable">vs</span></a>.(<a class="idref" href="Grandpa.VoterState.html#precommited_block"><span class="id" title="projection">precommited_block</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;<a class="idref" href="Grandpa.VoterState.html#last_brodcasted_block"><span class="id" title="projection">last_brodcasted_block</span></a> := <a class="idref" href="Grandpa.VoterState.html#vs:30"><span class="id" title="variable">vs</span></a>.(<a class="idref" href="Grandpa.VoterState.html#last_brodcasted_block"><span class="id" title="projection">last_brodcasted_block</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;<a class="idref" href="Grandpa.VoterState.html#rounds"><span class="id" title="projection">rounds</span></a> := <a class="idref" href="Grandpa.VoterState.html#vs:30"><span class="id" title="variable">vs</span></a>.(<a class="idref" href="Grandpa.VoterState.html#rounds"><span class="id" title="projection">rounds</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;<a class="idref" href="Grandpa.VoterState.html#pending_messages"><span class="id" title="projection">pending_messages</span></a> := <a class="idref" href="Grandpa.VoterState.html#vs:30"><span class="id" title="variable">vs</span></a>.(<a class="idref" href="Grandpa.VoterState.html#pending_messages"><span class="id" title="projection">pending_messages</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;<a class="idref" href="Grandpa.VoterState.html#finalized_blocks"><span class="id" title="projection">finalized_blocks</span></a>:= <a class="idref" href="Grandpa.VoterState.html#vs:30"><span class="id" title="variable">vs</span></a>.(<a class="idref" href="Grandpa.VoterState.html#finalized_blocks"><span class="id" title="projection">finalized_blocks</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|}.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <a id="update_precommit" class="idref" href="#update_precommit"><span class="id" title="definition">update_precommit</span></a>  (<a id="vs:32" class="idref" href="#vs:32"><span class="id" title="binder">vs</span></a>:<a class="idref" href="Grandpa.VoterState.html#VoterState"><span class="id" title="record">VoterState</span></a>) (<a id="block:33" class="idref" href="#block:33"><span class="id" title="binder">block</span></a>: <a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Init.Datatypes.html#option"><span class="id" title="inductive">option</span></a> <a class="idref" href="Grandpa.Blocks.AnyBlock.html#AnyBlock"><span class="id" title="record">AnyBlock</span></a>)<br/>
&nbsp;&nbsp;: <a class="idref" href="Grandpa.VoterState.html#VoterState"><span class="id" title="record">VoterState</span></a><br/>
&nbsp;&nbsp;:= <br/>
&nbsp;&nbsp;&nbsp;&nbsp;{|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Grandpa.VoterState.html#round_number"><span class="id" title="projection">round_number</span></a> := <a class="idref" href="Grandpa.VoterState.html#vs:32"><span class="id" title="variable">vs</span></a>.(<a class="idref" href="Grandpa.VoterState.html#round_number"><span class="id" title="projection">round_number</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;<a class="idref" href="Grandpa.VoterState.html#prevoted_block"><span class="id" title="projection">prevoted_block</span></a> := <a class="idref" href="Grandpa.VoterState.html#vs:32"><span class="id" title="variable">vs</span></a>.(<a class="idref" href="Grandpa.VoterState.html#prevoted_block"><span class="id" title="projection">prevoted_block</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;<a class="idref" href="Grandpa.VoterState.html#precommited_block"><span class="id" title="projection">precommited_block</span></a> := <a class="idref" href="Grandpa.VoterState.html#block:33"><span class="id" title="variable">block</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;<a class="idref" href="Grandpa.VoterState.html#last_brodcasted_block"><span class="id" title="projection">last_brodcasted_block</span></a> := <a class="idref" href="Grandpa.VoterState.html#vs:32"><span class="id" title="variable">vs</span></a>.(<a class="idref" href="Grandpa.VoterState.html#last_brodcasted_block"><span class="id" title="projection">last_brodcasted_block</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;<a class="idref" href="Grandpa.VoterState.html#rounds"><span class="id" title="projection">rounds</span></a> := <a class="idref" href="Grandpa.VoterState.html#vs:32"><span class="id" title="variable">vs</span></a>.(<a class="idref" href="Grandpa.VoterState.html#rounds"><span class="id" title="projection">rounds</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;<a class="idref" href="Grandpa.VoterState.html#pending_messages"><span class="id" title="projection">pending_messages</span></a> := <a class="idref" href="Grandpa.VoterState.html#vs:32"><span class="id" title="variable">vs</span></a>.(<a class="idref" href="Grandpa.VoterState.html#pending_messages"><span class="id" title="projection">pending_messages</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;<a class="idref" href="Grandpa.VoterState.html#finalized_blocks"><span class="id" title="projection">finalized_blocks</span></a>:= <a class="idref" href="Grandpa.VoterState.html#vs:32"><span class="id" title="variable">vs</span></a>.(<a class="idref" href="Grandpa.VoterState.html#finalized_blocks"><span class="id" title="projection">finalized_blocks</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;|}.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <a id="update_rounds" class="idref" href="#update_rounds"><span class="id" title="definition">update_rounds</span></a>  (<a id="vs:34" class="idref" href="#vs:34"><span class="id" title="binder">vs</span></a>:<a class="idref" href="Grandpa.VoterState.html#VoterState"><span class="id" title="record">VoterState</span></a>) {<a id="tower_number:35" class="idref" href="#tower_number:35"><span class="id" title="binder">tower_number</span></a>:<a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a>} <br/>
&nbsp;&nbsp;(<a id="new_rounds:36" class="idref" href="#new_rounds:36"><span class="id" title="binder">new_rounds</span></a>: <a class="idref" href="Grandpa.DataTypes.Vectors.html#Vec"><span class="id" title="definition">Vec</span></a> <a class="idref" href="Grandpa.OpaqueRound.html#OpaqueRoundState"><span class="id" title="inductive">OpaqueRoundState</span></a> (<a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Init.Datatypes.html#S"><span class="id" title="constructor">S</span></a> <a class="idref" href="Grandpa.VoterState.html#tower_number:35"><span class="id" title="variable">tower_number</span></a>))<br/>
&nbsp;&nbsp;: <a class="idref" href="Grandpa.VoterState.html#VoterState"><span class="id" title="record">VoterState</span></a><br/>
&nbsp;&nbsp;:= <br/>
&nbsp;&nbsp;&nbsp;&nbsp;{|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Grandpa.VoterState.html#round_number"><span class="id" title="projection">round_number</span></a> := <a class="idref" href="Grandpa.RoundNumber.html#from_nat"><span class="id" title="definition">RoundNumber.from_nat</span></a> <a class="idref" href="Grandpa.VoterState.html#tower_number:35"><span class="id" title="variable">tower_number</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;<a class="idref" href="Grandpa.VoterState.html#prevoted_block"><span class="id" title="projection">prevoted_block</span></a> := <a class="idref" href="Grandpa.VoterState.html#vs:34"><span class="id" title="variable">vs</span></a>.(<a class="idref" href="Grandpa.VoterState.html#prevoted_block"><span class="id" title="projection">prevoted_block</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;<a class="idref" href="Grandpa.VoterState.html#precommited_block"><span class="id" title="projection">precommited_block</span></a> := <a class="idref" href="Grandpa.VoterState.html#vs:34"><span class="id" title="variable">vs</span></a>.(<a class="idref" href="Grandpa.VoterState.html#precommited_block"><span class="id" title="projection">precommited_block</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;<a class="idref" href="Grandpa.VoterState.html#last_brodcasted_block"><span class="id" title="projection">last_brodcasted_block</span></a> := <a class="idref" href="Grandpa.VoterState.html#vs:34"><span class="id" title="variable">vs</span></a>.(<a class="idref" href="Grandpa.VoterState.html#last_brodcasted_block"><span class="id" title="projection">last_brodcasted_block</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;<a class="idref" href="Grandpa.VoterState.html#rounds"><span class="id" title="projection">rounds</span></a> := <a class="idref" href="Grandpa.VoterState.html#new_rounds:36"><span class="id" title="variable">new_rounds</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;<a class="idref" href="Grandpa.VoterState.html#pending_messages"><span class="id" title="projection">pending_messages</span></a> := <a class="idref" href="Grandpa.VoterState.html#vs:34"><span class="id" title="variable">vs</span></a>.(<a class="idref" href="Grandpa.VoterState.html#pending_messages"><span class="id" title="projection">pending_messages</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;<a class="idref" href="Grandpa.VoterState.html#finalized_blocks"><span class="id" title="projection">finalized_blocks</span></a>:= <a class="idref" href="Grandpa.VoterState.html#vs:34"><span class="id" title="variable">vs</span></a>.(<a class="idref" href="Grandpa.VoterState.html#finalized_blocks"><span class="id" title="projection">finalized_blocks</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;|}.<br/>

<br/>
<span class="id" title="keyword">Open</span> <span class="id" title="keyword">Scope</span> <span class="id" title="var">eqb</span>.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <a id="delete_pending_msg" class="idref" href="#delete_pending_msg"><span class="id" title="definition">delete_pending_msg</span></a> (<a id="vs:37" class="idref" href="#vs:37"><span class="id" title="binder">vs</span></a>:<a class="idref" href="Grandpa.VoterState.html#VoterState"><span class="id" title="record">VoterState</span></a>) (<a id="msg:38" class="idref" href="#msg:38"><span class="id" title="binder">msg</span></a>:<a class="idref" href="Grandpa.Message.html#Message"><span class="id" title="record">Message</span></a>)<br/>
&nbsp;&nbsp;:<a class="idref" href="Grandpa.VoterState.html#VoterState"><span class="id" title="record">VoterState</span></a><br/>
&nbsp;&nbsp;:=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Grandpa.VoterState.html#round_number"><span class="id" title="projection">round_number</span></a> := <a class="idref" href="Grandpa.VoterState.html#vs:37"><span class="id" title="variable">vs</span></a>.(<a class="idref" href="Grandpa.VoterState.html#round_number"><span class="id" title="projection">round_number</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;<a class="idref" href="Grandpa.VoterState.html#prevoted_block"><span class="id" title="projection">prevoted_block</span></a> := <a class="idref" href="Grandpa.VoterState.html#vs:37"><span class="id" title="variable">vs</span></a>.(<a class="idref" href="Grandpa.VoterState.html#prevoted_block"><span class="id" title="projection">prevoted_block</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;<a class="idref" href="Grandpa.VoterState.html#precommited_block"><span class="id" title="projection">precommited_block</span></a> := <a class="idref" href="Grandpa.VoterState.html#vs:37"><span class="id" title="variable">vs</span></a>.(<a class="idref" href="Grandpa.VoterState.html#precommited_block"><span class="id" title="projection">precommited_block</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;<a class="idref" href="Grandpa.VoterState.html#last_brodcasted_block"><span class="id" title="projection">last_brodcasted_block</span></a> := <a class="idref" href="Grandpa.VoterState.html#vs:37"><span class="id" title="variable">vs</span></a>.(<a class="idref" href="Grandpa.VoterState.html#last_brodcasted_block"><span class="id" title="projection">last_brodcasted_block</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;<a class="idref" href="Grandpa.VoterState.html#rounds"><span class="id" title="projection">rounds</span></a> := <a class="idref" href="Grandpa.VoterState.html#vs:37"><span class="id" title="variable">vs</span></a>.(<a class="idref" href="Grandpa.VoterState.html#rounds"><span class="id" title="projection">rounds</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;<a class="idref" href="Grandpa.VoterState.html#pending_messages"><span class="id" title="projection">pending_messages</span></a> := <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="prune_message:42" class="idref" href="#prune_message:42"><span class="id" title="binder">prune_message</span></a> <a id="l:39" class="idref" href="#l:39"><span class="id" title="binder"><span id="l:41" class="id">l</span></span></a> : <a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Init.Datatypes.html#list"><span class="id" title="inductive">list</span></a> <a class="idref" href="Grandpa.Message.html#Message"><span class="id" title="record">Message</span></a> := <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Lists.List.html#filter"><span class="id" title="definition">List.filter</span></a> (<span class="id" title="keyword">fun</span> <a id="msg2:40" class="idref" href="#msg2:40"><span class="id" title="binder">msg2</span></a> ⇒ <a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Init.Datatypes.html#negb"><span class="id" title="definition">negb</span></a> (<a class="idref" href="Grandpa.VoterState.html#msg:38"><span class="id" title="variable">msg</span></a>.(<a class="idref" href="Grandpa.Message.html#id"><span class="id" title="projection">Message.id</span></a>) <a class="idref" href="Grandpa.Classes.Eqb.html#d1e236ec039c134a0512d70204e70cbc"><span class="id" title="notation">=?</span></a> <a class="idref" href="Grandpa.VoterState.html#msg2:40"><span class="id" title="variable">msg2</span></a>.(<a class="idref" href="Grandpa.Message.html#id"><span class="id" title="projection">Message.id</span></a>))) <a class="idref" href="Grandpa.VoterState.html#l:39"><span class="id" title="variable">l</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Grandpa.DataTypes.Dictionary.html#from_list"><span class="id" title="definition">Dictionary.from_list</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Grandpa.Classes.Functor.html#map"><span class="id" title="method">map</span></a>  <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">fun</span> <a id="x:43" class="idref" href="#x:43"><span class="id" title="binder">x</span></a> ⇒ <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="Grandpa.VoterState.html#x:43"><span class="id" title="variable">x</span></a> <span class="id" title="keyword">with</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><span class="id" title="var">rn</span><a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <span class="id" title="var">l</span><a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;⇒ <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">rn</span><a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Grandpa.VoterState.html#prune_message:42"><span class="id" title="variable">prune_message</span></a> <span class="id" title="var">l</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Grandpa.DataTypes.Dictionary.html#to_list"><span class="id" title="definition">Dictionary.to_list</span></a> <a class="idref" href="Grandpa.VoterState.html#vs:37"><span class="id" title="variable">vs</span></a>.(<a class="idref" href="Grandpa.VoterState.html#pending_messages"><span class="id" title="projection">pending_messages</span></a>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;<a class="idref" href="Grandpa.VoterState.html#finalized_blocks"><span class="id" title="projection">finalized_blocks</span></a>:= <a class="idref" href="Grandpa.VoterState.html#vs:37"><span class="id" title="variable">vs</span></a>.(<a class="idref" href="Grandpa.VoterState.html#finalized_blocks"><span class="id" title="projection">finalized_blocks</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;|}.<br/>

<br/>
</div>

<div class="doc">
  If message is for a round bigger than the current one
  state is unchanged.

</div>
<div class="code">
<span class="id" title="keyword">Definition</span> <a id="update_votes_with_msg" class="idref" href="#update_votes_with_msg"><span class="id" title="definition">update_votes_with_msg</span></a>  (<a id="vs:45" class="idref" href="#vs:45"><span class="id" title="binder">vs</span></a>: <a class="idref" href="Grandpa.VoterState.html#VoterState"><span class="id" title="record">VoterState</span></a>) (<a id="msg:46" class="idref" href="#msg:46"><span class="id" title="binder">msg</span></a>:<a class="idref" href="Grandpa.Message.html#Message"><span class="id" title="record">Message</span></a>)<br/>
&nbsp;&nbsp;: <a class="idref" href="Grandpa.VoterState.html#VoterState"><span class="id" title="record">VoterState</span></a><br/>
&nbsp;&nbsp;:=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="maybe_round:47" class="idref" href="#maybe_round:47"><span class="id" title="binder">maybe_round</span></a> :<a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Init.Datatypes.html#option"><span class="id" title="inductive">option</span></a> <a class="idref" href="Grandpa.OpaqueRound.html#OpaqueRoundState"><span class="id" title="inductive">OpaqueRoundState</span></a> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:= <a class="idref" href="Grandpa.DataTypes.Vectors.html#get"><span class="id" title="definition">Vectors.get</span></a> <a class="idref" href="Grandpa.VoterState.html#vs:45"><span class="id" title="variable">vs</span></a>.(<a class="idref" href="Grandpa.VoterState.html#rounds"><span class="id" title="projection">rounds</span></a>) (<a class="idref" href="Grandpa.RoundNumber.html#to_nat"><span class="id" title="definition">RoundNumber.to_nat</span></a> <a class="idref" href="Grandpa.VoterState.html#msg:46"><span class="id" title="variable">msg</span></a>.(<a class="idref" href="Grandpa.Message.html#round"><span class="id" title="projection">round</span></a>))<br/>
&nbsp;&nbsp;<span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a id="maybe_updated:49" class="idref" href="#maybe_updated:49"><span class="id" title="binder">maybe_updated</span></a> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;: <a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Init.Datatypes.html#option"><span class="id" title="inductive">option</span></a> <a class="idref" href="Grandpa.OpaqueRound.html#OpaqueRoundState"><span class="id" title="inductive">OpaqueRoundState</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;:=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Grandpa.Classes.Functor.html#map"><span class="id" title="method">map</span></a> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">fun</span> <a id="r:48" class="idref" href="#r:48"><span class="id" title="binder">r</span></a> ⇒ <a class="idref" href="Grandpa.OpaqueRound.html#update_votes_with_msg"><span class="id" title="definition">OpaqueRound.update_votes_with_msg</span></a> <a class="idref" href="Grandpa.VoterState.html#r:48"><span class="id" title="variable">r</span></a> <a class="idref" href="Grandpa.VoterState.html#msg:46"><span class="id" title="variable">msg</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Grandpa.VoterState.html#maybe_round:47"><span class="id" title="variable">maybe_round</span></a><br/>
&nbsp;&nbsp;<span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="maybe_tower:50" class="idref" href="#maybe_tower:50"><span class="id" title="binder">maybe_tower</span></a> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;:= <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Grandpa.Classes.Functor.html#map"><span class="id" title="method">map</span></a> (<a class="idref" href="Grandpa.DataTypes.Vectors.html#update"><span class="id" title="definition">Vectors.update</span></a> <a class="idref" href="Grandpa.VoterState.html#vs:45"><span class="id" title="variable">vs</span></a>.(<a class="idref" href="Grandpa.VoterState.html#rounds"><span class="id" title="projection">rounds</span></a>) (<a class="idref" href="Grandpa.RoundNumber.html#to_nat"><span class="id" title="definition">RoundNumber.to_nat</span></a> <a class="idref" href="Grandpa.VoterState.html#msg:46"><span class="id" title="variable">msg</span></a>.(<a class="idref" href="Grandpa.Message.html#round"><span class="id" title="projection">round</span></a>))) <a class="idref" href="Grandpa.VoterState.html#maybe_updated:49"><span class="id" title="variable">maybe_updated</span></a><br/>
&nbsp;&nbsp;<span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="Grandpa.VoterState.html#maybe_tower:50"><span class="id" title="variable">maybe_tower</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <span class="id" title="var">new_tower</span> ⇒ <a class="idref" href="Grandpa.VoterState.html#update_rounds"><span class="id" title="definition">update_rounds</span></a> <a class="idref" href="Grandpa.VoterState.html#vs:45"><span class="id" title="variable">vs</span></a> <span class="id" title="var">new_tower</span><br/>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Init.Datatypes.html#None"><span class="id" title="constructor">None</span></a> ⇒ <a class="idref" href="Grandpa.VoterState.html#vs:45"><span class="id" title="variable">vs</span></a><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
</div>

<div class="doc">
  If message came from a bigger round than the current one 
   we store it in pending_messages instead of processing it.

</div>
<div class="code">
<span class="id" title="keyword">Definition</span> <a id="update_with_msg" class="idref" href="#update_with_msg"><span class="id" title="definition">update_with_msg</span></a> (<a id="vs:52" class="idref" href="#vs:52"><span class="id" title="binder">vs</span></a>:<a class="idref" href="Grandpa.VoterState.html#VoterState"><span class="id" title="record">VoterState</span></a>) (<a id="msg:53" class="idref" href="#msg:53"><span class="id" title="binder">msg</span></a>:<a class="idref" href="Grandpa.Message.html#Message"><span class="id" title="record">Message</span></a>)<br/>
&nbsp;&nbsp;: <a class="idref" href="Grandpa.VoterState.html#VoterState"><span class="id" title="record">VoterState</span></a><br/>
&nbsp;&nbsp;:= <br/>
&nbsp;&nbsp;<span class="id" title="keyword">if</span>   (<a class="idref" href="Grandpa.VoterState.html#msg:53"><span class="id" title="variable">msg</span></a>.(<a class="idref" href="Grandpa.Message.html#round"><span class="id" title="projection">Message.round</span></a>) <a class="idref" href="Grandpa.DataTypes.NatWrapper.html#d44469564eec84e813491d96446c355e"><span class="id" title="notation">&lt;=?</span></a> <a class="idref" href="Grandpa.VoterState.html#vs:52"><span class="id" title="variable">vs</span></a>.(<a class="idref" href="Grandpa.VoterState.html#round_number"><span class="id" title="projection">round_number</span></a>))%<span class="id" title="var">natWrapper</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">then</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="updated_state:58" class="idref" href="#updated_state:58"><span class="id" title="binder">updated_state</span></a> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:= <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="Grandpa.VoterState.html#msg:53"><span class="id" title="variable">msg</span></a>.(<a class="idref" href="Grandpa.Message.html#kind"><span class="id" title="projection">Message.kind</span></a>) <span class="id" title="keyword">with</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="Grandpa.Message.html#PreCommitMessage"><span class="id" title="constructor">PreCommitMessage</span></a> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;⇒ <a class="idref" href="Grandpa.VoterState.html#update_votes_with_msg"><span class="id" title="definition">update_votes_with_msg</span></a> <a class="idref" href="Grandpa.VoterState.html#vs:52"><span class="id" title="variable">vs</span></a> <a class="idref" href="Grandpa.VoterState.html#msg:53"><span class="id" title="variable">msg</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="Grandpa.Message.html#PreVoteMessage"><span class="id" title="constructor">PreVoteMessage</span></a> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;⇒ <a class="idref" href="Grandpa.VoterState.html#update_votes_with_msg"><span class="id" title="definition">update_votes_with_msg</span></a> <a class="idref" href="Grandpa.VoterState.html#vs:52"><span class="id" title="variable">vs</span></a> <a class="idref" href="Grandpa.VoterState.html#msg:53"><span class="id" title="variable">msg</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="Grandpa.Message.html#EstimateMessage"><span class="id" title="constructor">EstimateMessage</span></a> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;⇒ <a class="idref" href="Grandpa.VoterState.html#update_last_block"><span class="id" title="definition">update_last_block</span></a> <a class="idref" href="Grandpa.VoterState.html#vs:52"><span class="id" title="variable">vs</span></a> <a class="idref" href="Grandpa.VoterState.html#msg:53"><span class="id" title="variable">msg</span></a>.(<a class="idref" href="Grandpa.Message.html#block"><span class="id" title="projection">Message.block</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="Grandpa.Message.html#FinalizationMessage"><span class="id" title="constructor">FinalizationMessage</span></a> <span class="id" title="var">_</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;⇒ <a class="idref" href="Grandpa.VoterState.html#update_add_finalized_block"><span class="id" title="definition">update_add_finalized_block</span></a> <a class="idref" href="Grandpa.VoterState.html#vs:52"><span class="id" title="variable">vs</span></a> <a class="idref" href="Grandpa.VoterState.html#msg:53"><span class="id" title="variable">msg</span></a>.(<a class="idref" href="Grandpa.Message.html#block"><span class="id" title="projection">Message.block</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Grandpa.VoterState.html#delete_pending_msg"><span class="id" title="definition">delete_pending_msg</span></a> <a class="idref" href="Grandpa.VoterState.html#updated_state:58"><span class="id" title="variable">updated_state</span></a> <a class="idref" href="Grandpa.VoterState.html#msg:53"><span class="id" title="variable">msg</span></a><br/>
&nbsp;&nbsp;<span class="id" title="keyword">else</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="update:57" class="idref" href="#update:57"><span class="id" title="binder">update</span></a> <a id="previous:54" class="idref" href="#previous:54"><span class="id" title="binder">previous</span></a> <a id="new:55" class="idref" href="#new:55"><span class="id" title="binder">new</span></a> := <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="Grandpa.VoterState.html#previous:54"><span class="id" title="variable">previous</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <span class="id" title="var">prev</span> ⇒  <span class="id" title="var">prev</span> <a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Init.Datatypes.html#bc347c51eaf667706ae54503b26d52c6"><span class="id" title="notation">++</span></a> <a class="idref" href="Grandpa.VoterState.html#new:55"><span class="id" title="variable">new</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Init.Datatypes.html#None"><span class="id" title="constructor">None</span></a> ⇒ <a class="idref" href="Grandpa.VoterState.html#new:55"><span class="id" title="variable">new</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Grandpa.VoterState.html#round_number"><span class="id" title="projection">round_number</span></a> := <a class="idref" href="Grandpa.VoterState.html#vs:52"><span class="id" title="variable">vs</span></a>.(<a class="idref" href="Grandpa.VoterState.html#round_number"><span class="id" title="projection">round_number</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;<a class="idref" href="Grandpa.VoterState.html#prevoted_block"><span class="id" title="projection">prevoted_block</span></a> := <a class="idref" href="Grandpa.VoterState.html#vs:52"><span class="id" title="variable">vs</span></a>.(<a class="idref" href="Grandpa.VoterState.html#prevoted_block"><span class="id" title="projection">prevoted_block</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;<a class="idref" href="Grandpa.VoterState.html#precommited_block"><span class="id" title="projection">precommited_block</span></a> := <a class="idref" href="Grandpa.VoterState.html#vs:52"><span class="id" title="variable">vs</span></a>.(<a class="idref" href="Grandpa.VoterState.html#precommited_block"><span class="id" title="projection">precommited_block</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;<a class="idref" href="Grandpa.VoterState.html#last_brodcasted_block"><span class="id" title="projection">last_brodcasted_block</span></a> := <a class="idref" href="Grandpa.VoterState.html#vs:52"><span class="id" title="variable">vs</span></a>.(<a class="idref" href="Grandpa.VoterState.html#last_brodcasted_block"><span class="id" title="projection">last_brodcasted_block</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;<a class="idref" href="Grandpa.VoterState.html#rounds"><span class="id" title="projection">rounds</span></a> := <a class="idref" href="Grandpa.VoterState.html#vs:52"><span class="id" title="variable">vs</span></a>.(<a class="idref" href="Grandpa.VoterState.html#rounds"><span class="id" title="projection">rounds</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;<a class="idref" href="Grandpa.VoterState.html#pending_messages"><span class="id" title="projection">pending_messages</span></a> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:= <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Grandpa.DataTypes.Dictionary.html#update_with"><span class="id" title="definition">Dictionary.update_with</span></a> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Grandpa.VoterState.html#vs:52"><span class="id" title="variable">vs</span></a>.(<a class="idref" href="Grandpa.VoterState.html#round_number"><span class="id" title="projection">round_number</span></a>) <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Lists.List.html#cons"><span class="id" title="abbreviation">List.cons</span></a> <a class="idref" href="Grandpa.VoterState.html#msg:53"><span class="id" title="variable">msg</span></a> <a class="idref" href="http://coq.inria.fr/doc/V8.19.2/stdlib//Coq.Lists.List.html#nil"><span class="id" title="abbreviation">List.nil</span></a>) <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Grandpa.VoterState.html#update:57"><span class="id" title="variable">update</span></a>  <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Grandpa.VoterState.html#vs:52"><span class="id" title="variable">vs</span></a>.(<a class="idref" href="Grandpa.VoterState.html#pending_messages"><span class="id" title="projection">pending_messages</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;<a class="idref" href="Grandpa.VoterState.html#finalized_blocks"><span class="id" title="projection">finalized_blocks</span></a>:= <a class="idref" href="Grandpa.VoterState.html#vs:52"><span class="id" title="variable">vs</span></a>.(<a class="idref" href="Grandpa.VoterState.html#finalized_blocks"><span class="id" title="projection">finalized_blocks</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|}.<br/>

<br/>
<span class="id" title="keyword">Close</span> <span class="id" title="keyword">Scope</span> <span class="id" title="var">list</span>.<br/>
</div>
</div>

<div id="footer">
<hr/><a href="index.html">Index</a><hr/>This page has been generated by <a href="http://coq.inria.fr/">coqdoc</a>
</div>

</div>

</body>
</html>